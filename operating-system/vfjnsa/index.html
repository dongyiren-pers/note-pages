<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第4章 文件管理 | 后端技术栈笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/jquery/3.4.0/jquery.min.js"></script>
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" href="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">
    <meta name="description" content="BackEnd Notes">
    
    <link rel="preload" href="/note-pages/assets/css/0.styles.167a34c7.css" as="style"><link rel="preload" href="/note-pages/assets/js/app.05dcbd87.js" as="script"><link rel="preload" href="/note-pages/assets/js/3.4a2f67fd.js" as="script"><link rel="preload" href="/note-pages/assets/js/2.ab82720e.js" as="script"><link rel="preload" href="/note-pages/assets/js/5.869d288f.js" as="script"><link rel="prefetch" href="/note-pages/assets/js/10.e11a80d9.js"><link rel="prefetch" href="/note-pages/assets/js/100.489cf69a.js"><link rel="prefetch" href="/note-pages/assets/js/101.560e37ea.js"><link rel="prefetch" href="/note-pages/assets/js/102.baaa4f6a.js"><link rel="prefetch" href="/note-pages/assets/js/103.262b6423.js"><link rel="prefetch" href="/note-pages/assets/js/104.ac33d7ce.js"><link rel="prefetch" href="/note-pages/assets/js/105.5e6ce18f.js"><link rel="prefetch" href="/note-pages/assets/js/106.a69322ef.js"><link rel="prefetch" href="/note-pages/assets/js/107.6cdb78ee.js"><link rel="prefetch" href="/note-pages/assets/js/108.1d720289.js"><link rel="prefetch" href="/note-pages/assets/js/109.58f7297c.js"><link rel="prefetch" href="/note-pages/assets/js/11.241a46da.js"><link rel="prefetch" href="/note-pages/assets/js/110.9cef761d.js"><link rel="prefetch" href="/note-pages/assets/js/111.c782138c.js"><link rel="prefetch" href="/note-pages/assets/js/112.40cb3b1a.js"><link rel="prefetch" href="/note-pages/assets/js/113.c367e40a.js"><link rel="prefetch" href="/note-pages/assets/js/114.a4a75db5.js"><link rel="prefetch" href="/note-pages/assets/js/115.a73cd469.js"><link rel="prefetch" href="/note-pages/assets/js/116.ad853155.js"><link rel="prefetch" href="/note-pages/assets/js/117.a82b2649.js"><link rel="prefetch" href="/note-pages/assets/js/118.8f896dd0.js"><link rel="prefetch" href="/note-pages/assets/js/119.374482b1.js"><link rel="prefetch" href="/note-pages/assets/js/12.ebe220d5.js"><link rel="prefetch" href="/note-pages/assets/js/120.89698284.js"><link rel="prefetch" href="/note-pages/assets/js/121.cbe50685.js"><link rel="prefetch" href="/note-pages/assets/js/122.7de2ac51.js"><link rel="prefetch" href="/note-pages/assets/js/123.a2d16009.js"><link rel="prefetch" href="/note-pages/assets/js/124.e1ba7cbe.js"><link rel="prefetch" href="/note-pages/assets/js/125.4e1e6d6a.js"><link rel="prefetch" href="/note-pages/assets/js/126.3db22af3.js"><link rel="prefetch" href="/note-pages/assets/js/127.937f4ffc.js"><link rel="prefetch" href="/note-pages/assets/js/128.0bad2e20.js"><link rel="prefetch" href="/note-pages/assets/js/129.75a99d25.js"><link rel="prefetch" href="/note-pages/assets/js/13.5ee7bef5.js"><link rel="prefetch" href="/note-pages/assets/js/130.599b6d3d.js"><link rel="prefetch" href="/note-pages/assets/js/131.687214bf.js"><link rel="prefetch" href="/note-pages/assets/js/132.8295c067.js"><link rel="prefetch" href="/note-pages/assets/js/133.854d61c0.js"><link rel="prefetch" href="/note-pages/assets/js/134.f3fc20e1.js"><link rel="prefetch" href="/note-pages/assets/js/135.2a5a690d.js"><link rel="prefetch" href="/note-pages/assets/js/136.6ba30378.js"><link rel="prefetch" href="/note-pages/assets/js/137.80d7c511.js"><link rel="prefetch" href="/note-pages/assets/js/138.0a25898e.js"><link rel="prefetch" href="/note-pages/assets/js/139.fb3c377f.js"><link rel="prefetch" href="/note-pages/assets/js/14.a561f8b3.js"><link rel="prefetch" href="/note-pages/assets/js/140.cbfdbe32.js"><link rel="prefetch" href="/note-pages/assets/js/141.c09f054f.js"><link rel="prefetch" href="/note-pages/assets/js/142.723bd973.js"><link rel="prefetch" href="/note-pages/assets/js/143.b31785f9.js"><link rel="prefetch" href="/note-pages/assets/js/144.69d3d121.js"><link rel="prefetch" href="/note-pages/assets/js/145.c4ee6aa0.js"><link rel="prefetch" href="/note-pages/assets/js/146.7f836a1c.js"><link rel="prefetch" href="/note-pages/assets/js/147.d4a57976.js"><link rel="prefetch" href="/note-pages/assets/js/148.b15e75eb.js"><link rel="prefetch" href="/note-pages/assets/js/149.94085ddc.js"><link rel="prefetch" href="/note-pages/assets/js/15.4ed118f1.js"><link rel="prefetch" href="/note-pages/assets/js/150.6751d41b.js"><link rel="prefetch" href="/note-pages/assets/js/151.bd60e322.js"><link rel="prefetch" href="/note-pages/assets/js/152.15caf78f.js"><link rel="prefetch" href="/note-pages/assets/js/153.131128fc.js"><link rel="prefetch" href="/note-pages/assets/js/154.b8ee2e7d.js"><link rel="prefetch" href="/note-pages/assets/js/155.8fa1e2e0.js"><link rel="prefetch" href="/note-pages/assets/js/156.25e2a796.js"><link rel="prefetch" href="/note-pages/assets/js/157.7137c9c3.js"><link rel="prefetch" href="/note-pages/assets/js/158.fdc18c40.js"><link rel="prefetch" href="/note-pages/assets/js/159.0dadb745.js"><link rel="prefetch" href="/note-pages/assets/js/16.818fc8bf.js"><link rel="prefetch" href="/note-pages/assets/js/160.05f7541c.js"><link rel="prefetch" href="/note-pages/assets/js/161.2a8c62a2.js"><link rel="prefetch" href="/note-pages/assets/js/162.5b9983b7.js"><link rel="prefetch" href="/note-pages/assets/js/163.b51a5538.js"><link rel="prefetch" href="/note-pages/assets/js/164.06c9f20a.js"><link rel="prefetch" href="/note-pages/assets/js/165.c25063f4.js"><link rel="prefetch" href="/note-pages/assets/js/166.6c570da5.js"><link rel="prefetch" href="/note-pages/assets/js/167.12fb6fb6.js"><link rel="prefetch" href="/note-pages/assets/js/168.d7dd27bc.js"><link rel="prefetch" href="/note-pages/assets/js/169.27f575fe.js"><link rel="prefetch" href="/note-pages/assets/js/17.9daf0c47.js"><link rel="prefetch" href="/note-pages/assets/js/170.ba4295ef.js"><link rel="prefetch" href="/note-pages/assets/js/171.3fb54078.js"><link rel="prefetch" href="/note-pages/assets/js/18.086ed162.js"><link rel="prefetch" href="/note-pages/assets/js/19.adca670c.js"><link rel="prefetch" href="/note-pages/assets/js/20.2e9ff004.js"><link rel="prefetch" href="/note-pages/assets/js/21.07830947.js"><link rel="prefetch" href="/note-pages/assets/js/22.609929cb.js"><link rel="prefetch" href="/note-pages/assets/js/23.d83b832f.js"><link rel="prefetch" href="/note-pages/assets/js/24.592e8014.js"><link rel="prefetch" href="/note-pages/assets/js/25.9d28bb6f.js"><link rel="prefetch" href="/note-pages/assets/js/26.fd4195d5.js"><link rel="prefetch" href="/note-pages/assets/js/27.ca60e875.js"><link rel="prefetch" href="/note-pages/assets/js/28.c2cd75e6.js"><link rel="prefetch" href="/note-pages/assets/js/29.4213d132.js"><link rel="prefetch" href="/note-pages/assets/js/30.c6ee0ead.js"><link rel="prefetch" href="/note-pages/assets/js/31.eea6a542.js"><link rel="prefetch" href="/note-pages/assets/js/32.1ffdceaf.js"><link rel="prefetch" href="/note-pages/assets/js/33.0425748b.js"><link rel="prefetch" href="/note-pages/assets/js/34.5dd0d81d.js"><link rel="prefetch" href="/note-pages/assets/js/35.773df14e.js"><link rel="prefetch" href="/note-pages/assets/js/36.5db32ea2.js"><link rel="prefetch" href="/note-pages/assets/js/37.1106162c.js"><link rel="prefetch" href="/note-pages/assets/js/38.793ba7d0.js"><link rel="prefetch" href="/note-pages/assets/js/39.488fb9a5.js"><link rel="prefetch" href="/note-pages/assets/js/4.550e6883.js"><link rel="prefetch" href="/note-pages/assets/js/40.9c05b0ae.js"><link rel="prefetch" href="/note-pages/assets/js/41.ae198526.js"><link rel="prefetch" href="/note-pages/assets/js/42.d815456e.js"><link rel="prefetch" href="/note-pages/assets/js/43.1808aff8.js"><link rel="prefetch" href="/note-pages/assets/js/44.c26d9bde.js"><link rel="prefetch" href="/note-pages/assets/js/45.fae5f755.js"><link rel="prefetch" href="/note-pages/assets/js/46.703057c9.js"><link rel="prefetch" href="/note-pages/assets/js/47.ed3a23ce.js"><link rel="prefetch" href="/note-pages/assets/js/48.c5a46ee8.js"><link rel="prefetch" href="/note-pages/assets/js/49.b04c1681.js"><link rel="prefetch" href="/note-pages/assets/js/50.249fc2a7.js"><link rel="prefetch" href="/note-pages/assets/js/51.cab74632.js"><link rel="prefetch" href="/note-pages/assets/js/52.e2f231b3.js"><link rel="prefetch" href="/note-pages/assets/js/53.6241e308.js"><link rel="prefetch" href="/note-pages/assets/js/54.7d29c5c0.js"><link rel="prefetch" href="/note-pages/assets/js/55.a9050f95.js"><link rel="prefetch" href="/note-pages/assets/js/56.75828a09.js"><link rel="prefetch" href="/note-pages/assets/js/57.b3f75d67.js"><link rel="prefetch" href="/note-pages/assets/js/58.0cf3bd1c.js"><link rel="prefetch" href="/note-pages/assets/js/59.19f18f1f.js"><link rel="prefetch" href="/note-pages/assets/js/6.d879438f.js"><link rel="prefetch" href="/note-pages/assets/js/60.61940d92.js"><link rel="prefetch" href="/note-pages/assets/js/61.bc890bb0.js"><link rel="prefetch" href="/note-pages/assets/js/62.f487437c.js"><link rel="prefetch" href="/note-pages/assets/js/63.4a91369b.js"><link rel="prefetch" href="/note-pages/assets/js/64.1b0770e4.js"><link rel="prefetch" href="/note-pages/assets/js/65.b56e2b22.js"><link rel="prefetch" href="/note-pages/assets/js/66.dd49594c.js"><link rel="prefetch" href="/note-pages/assets/js/67.22efede4.js"><link rel="prefetch" href="/note-pages/assets/js/68.0d22a8a4.js"><link rel="prefetch" href="/note-pages/assets/js/69.aec9bfeb.js"><link rel="prefetch" href="/note-pages/assets/js/7.e3626849.js"><link rel="prefetch" href="/note-pages/assets/js/70.0c53c20d.js"><link rel="prefetch" href="/note-pages/assets/js/71.6d6db7d6.js"><link rel="prefetch" href="/note-pages/assets/js/72.fdcfb985.js"><link rel="prefetch" href="/note-pages/assets/js/73.a390b48d.js"><link rel="prefetch" href="/note-pages/assets/js/74.e817987f.js"><link rel="prefetch" href="/note-pages/assets/js/75.f144cf4f.js"><link rel="prefetch" href="/note-pages/assets/js/76.7be2f5f1.js"><link rel="prefetch" href="/note-pages/assets/js/77.6568d596.js"><link rel="prefetch" href="/note-pages/assets/js/78.4ff63ca8.js"><link rel="prefetch" href="/note-pages/assets/js/79.daaf791e.js"><link rel="prefetch" href="/note-pages/assets/js/8.f9f716a1.js"><link rel="prefetch" href="/note-pages/assets/js/80.a0605696.js"><link rel="prefetch" href="/note-pages/assets/js/81.ecb125f5.js"><link rel="prefetch" href="/note-pages/assets/js/82.b64b1c42.js"><link rel="prefetch" href="/note-pages/assets/js/83.d13b7f19.js"><link rel="prefetch" href="/note-pages/assets/js/84.c584da75.js"><link rel="prefetch" href="/note-pages/assets/js/85.7992353f.js"><link rel="prefetch" href="/note-pages/assets/js/86.17ad6399.js"><link rel="prefetch" href="/note-pages/assets/js/87.289f9f2f.js"><link rel="prefetch" href="/note-pages/assets/js/88.3496d6e2.js"><link rel="prefetch" href="/note-pages/assets/js/89.0d0c778d.js"><link rel="prefetch" href="/note-pages/assets/js/9.3209071f.js"><link rel="prefetch" href="/note-pages/assets/js/90.245b9fda.js"><link rel="prefetch" href="/note-pages/assets/js/91.806af5f2.js"><link rel="prefetch" href="/note-pages/assets/js/92.8a10f401.js"><link rel="prefetch" href="/note-pages/assets/js/93.ea90ae18.js"><link rel="prefetch" href="/note-pages/assets/js/94.98cc66ef.js"><link rel="prefetch" href="/note-pages/assets/js/95.836e96c5.js"><link rel="prefetch" href="/note-pages/assets/js/96.d4dd3eee.js"><link rel="prefetch" href="/note-pages/assets/js/97.e4275cb9.js"><link rel="prefetch" href="/note-pages/assets/js/98.0e320d92.js"><link rel="prefetch" href="/note-pages/assets/js/99.e6f77650.js">
    <link rel="stylesheet" href="/note-pages/assets/css/0.styles.167a34c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-pages/" class="home-link router-link-active"><!----> <span class="site-name">后端技术栈笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note-pages/operating-system/knuk3x/" class="sidebar-link">第1章 操作系统概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/operating-system/knuk3x/#_1-1-操作系统的基本概念" class="sidebar-link">1.1 操作系统的基本概念</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/knuk3x/#_1-2-操作系统的发展与分类" class="sidebar-link">1.2 操作系统的发展与分类</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/knuk3x/#_1-3-操作系统的运行机制与体系结构" class="sidebar-link">1.3 操作系统的运行机制与体系结构</a></li></ul></li><li><a href="/note-pages/operating-system/9xtgs8/" class="sidebar-link">第2章 进程与线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/operating-system/9xtgs8/#_2-1-进程与线程" class="sidebar-link">2.1 进程与线程</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/9xtgs8/#_2-2-处理机的调度" class="sidebar-link">2.2 处理机的调度</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/9xtgs8/#_2-3-进程的同步与互斥" class="sidebar-link">2.3 进程的同步与互斥</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/9xtgs8/#_2-4-死锁" class="sidebar-link">2.4 死锁</a></li></ul></li><li><a href="/note-pages/operating-system/owchkr/" class="sidebar-link">第3章 内存管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/operating-system/owchkr/#_3-1-内存管理相关概念" class="sidebar-link">3.1 内存管理相关概念</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/owchkr/#_3-2-虚拟内存" class="sidebar-link">3.2 虚拟内存</a></li></ul></li><li><a href="/note-pages/operating-system/vfjnsa/" aria-current="page" class="active sidebar-link">第4章 文件管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/operating-system/vfjnsa/#_4-1-文件系统" class="sidebar-link">4.1 文件系统</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/vfjnsa/#_4-2-磁盘管理" class="sidebar-link">4.2 磁盘管理</a></li></ul></li><li><a href="/note-pages/operating-system/05-输入输出管理.html" class="sidebar-link">第5章 输入输出管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/operating-system/05-输入输出管理.html#_5-1-i-o-管理概述" class="sidebar-link">5.1 I/O 管理概述</a></li><li class="sidebar-sub-header"><a href="/note-pages/operating-system/05-输入输出管理.html#_5-2-i-o-核心子系统" class="sidebar-link">5.2 I/O 核心子系统</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第4章-文件管理"><a href="#第4章-文件管理" class="header-anchor">#</a> 第4章 文件管理</h1> <h2 id="_4-1-文件系统"><a href="#_4-1-文件系统" class="header-anchor">#</a> 4.1 文件系统</h2> <h3 id="文件的概念和定义"><a href="#文件的概念和定义" class="header-anchor">#</a> 文件的概念和定义</h3> <p>文件（File）是操作系统中的一个重要概念。在系统运行时，计算机以进程为基本单位进行资源的调度和分配；而在用户进行的输入、输出中，则以文件为基本单位。大多数应用程序的输入都是通过文件来实现的，其输出也都保存在文件中，以便信息的长期存及将来的访问。当用户将文件用于应用程序的输入、输出时，还希望可以访问文件、修改文件和保存文件等，实现对文件的维护管理，这就需要系统提供一个文件管理系统，操作系统中的文件系统（File System）就是用于实现用户的这些管理要求。</p> <p>从用户的角度看，文件系统是操作系统的重要部分之一。用户关心的是如何命名、分类和查找文件，如何保证文件数据的安全性以及对文件可以进行哪些操作等。而对其中的细节，如文件如何存储在辅存上、如何管理文件辅存区域等关心甚少。</p> <p>文件系统提供了与二级存储相关的资源的抽象，让用户能在不了解文件的各种属性、文件存储介质的特征以及文件在存储介质上的具体位置等情况下，方便快捷地使用文件。</p> <p>用户通过文件系统建立文件，提供应用程序的输入、输出，对资源进行管理。首先了解文件的结构，我们通过自底向上的方式来定义。</p> <div id="数据项" class="anchor">数据项</div><p>数据项是文件系统中 <strong>最低级的数据组织形式</strong>，可分为以下两种类型：</p> <ul><li>基本数据项：用于描述一个对象的某种属性的一个值，如姓名、日期或证件号等，是数据中可命名的最小逻辑数据单位，即原子数据。</li> <li>组合数据项：由多个基本数据项组成。</li></ul> <div id="记录" class="anchor">记录</div><p>记录是一组相关的数据项的集合，用于描述一个对象在某方面的属性，如一个考生报名记录包括考生姓名、出生日期、报考学校代号、身份证号等一系列域。</p> <div id="文件" class="anchor">文件</div><p><strong>文件是指由创建者所定义的一组相关信息的集合</strong>，逻辑上可分为 <strong>有结构文件</strong> 和 <strong>无结构文件</strong> 两种。在有结构文件中，文件由一组相似记录组成，如报考某学校的所有考生的报考信息记录，又称记录式文件；而无结构文件则被看成是一个字符流，比如一个二进制文件或字符文件，又称流式文件。</p> <p>虽然上面给出了结构化的表述，但实际上关于文件并无严格的定义。通常在操作系统中将程序和数据组织成文件。文件可以是数字、字母或二进制代码，基本访问单元可以是字节、行或记录。文件可以长期存储于硬盘或其他二级存储器中，允许可控制的进程间共享访问，能够被组织成复杂的结构。</p> <h3 id="文件的属性、基本操作以及文件的打开和关闭"><a href="#文件的属性、基本操作以及文件的打开和关闭" class="header-anchor">#</a> 文件的属性、基本操作以及文件的打开和关闭</h3> <div id="文件的属性" class="anchor">文件的属性</div><p>文件有一定的属性，这根据系统的不同而有所不同，但是通常都包括如下属性：</p> <ul><li>名称：文件名称唯一，以容易读取的形式保存。</li> <li>标识符：标识文件系统内文件的唯一标签，通常为数字，它是对人不可读的一种内部名称。</li> <li>类型：被支持不同类型的文件系统所使用。</li> <li>位置：指向设备和设备上文件的指针。</li> <li>大小：文件当前大小（用字节、字或块表示），也可包含文件允许的最大值。</li> <li>保护：对文件进行保护的访问控制信息。</li> <li>时间、日期和用户标识：文件创建、上次修改和上次访问的相关信息，用于保护、 安全和跟踪文件的使用。</li></ul> <p>所有文件的信息都 <strong>保存在目录结构</strong> 中，而目录结构也保存在外存上。文件信息当需要时再调入内存。通常，<strong>目录条目包括文件名称及其唯一标识符，而标识符定位其他属性的信息</strong>。</p> <div id="文件的基本橾作" class="anchor">文件的基本橾作</div><p>文件属于抽象数据类型。为了恰当地定义文件，就需要考虑有关文件的操作。操作系统提供系统调用，它对文件进行创建、写、读、定位和截断。</p> <ul><li>创建文件：创建文件有两个必要步骤，一是在文件系统中为文件找到空间；二是在目录中为新文件创建条目，该条目记录文件名称、在文件系统中的位置及其他可能信息。</li> <li>写文件：执行一个系统调用，指明文件名称和要写入文件的内容。对于给定文件名称，系统搜索目录以查找文件位置。系统必须为该文件维护一个写位置的指针。每当发生写操作，便更新写指针。</li> <li>读文件：执行一个系统调用，指明文件名称和要读入文件块的内存位置。同样，需要搜索目录以找到相关目录项，系统维护一个读位置的指针。每当发生读操作时，更新读指针。一个进程通常只对一个文件读或写，所以当前操作位置可作为每个进程当前文件位置指针。由于读和写操作都使用同一指针，节省了空间也降低了系统复杂度。</li> <li>文件重定位（文件寻址）：按某条件搜索目录，将当前文件位置设为给定值，并且不会读、写文件。</li> <li>删除文件：先从目录中找到要删除文件的目录项，使之成为空项，然后回收该文件所占用的存储空间。</li> <li>截断文件：允许文件所有属性不变，并删除文件内容，即将其长度设为0并释放其空间。</li></ul> <p>这 6 个基本操作可以组合执行其他文件操作。例如，一个文件的复制，可以创建新文件、从旧文件读出并写入到新文件。</p> <div id="文件的打开与关闭" class="anchor">文件的打开与关闭</div><p>因为许多文件操作都涉及为给定文件搜索相关目录条目，许多系统要求在首次使用文件时，使用 <strong>系统调用 open</strong>，将指明文件的属性（包括该文件在外存上的物理位置）从外存拷贝到内存 <strong>打开文件目录表</strong> 的一个表目中，并将该表目的编号（或称为索引）返回给用户。操作系统维护一个包含所有打开文件信息的表（打开文件表，open-file table）。当用户需要一个文件操作时，可通过该表的一个索引指定文件，就省略了搜索环节。当文件不再使用时，进程可以关闭它，操作系统从打开文件表中删除这一条目。</p> <p>大部分操作系统要求在文件使用之前就被显式地打开。操作 open 会根据文件名搜索目录，并将目录条目复制到打开文件表。如果调用 open 的请求（创建、只读、读写、添加等）得到允许，进程就可以打开文件，而 open 通常返回一个指向打开文件表中的一个条目的指针。通过使用该指计（而非文件名）进行所有 I/O 操作，以简化步骤并节省资源。</p> <p>整个系统表包含进程相关信息，如文件在磁盘的位置、访问日期和大小。一个进程打开一个文件，系统打开文件表就会为打开的文件增加相应的条目。当另一个进程执行 open 时，只不过是在其进程打开表中增加一个条目，并指向整个系统表的相应条目。通常，系统打开文件表的每个文件时，还用一个 <strong>文件打开计数器（Open Count）</strong>，以记录多少进程打开了该文件。每个关闭操作 close 则使 count 递减，当打开计数器为 0 时，表示该文件不再被使用。系统将回收分配给该文件的内存空间等资源，若文件被修改过，则将文件写回外存，并将系统打开文件表中相应条目删除，最后释放文件的文件控制块（File Control Block，FCB）。</p> <p>每个打开文件都有如下关联信息：</p> <ul><li>文件指针：系统跟踪上次读写位置作为当前文件位置指针，这种指针对打开文件的某个进程来说是唯一的，因此必须与磁盘文件属性分开保存。</li> <li>文件打开计数：文件关闭时，操作系统必须重用其打开文件表条目，否则表内空间会不够用。因为多个进程可能打开同一个文件，所以系统在删除打开文件条目之前，必须等待最后一个进程关闭文件。该计数器跟踪打开和关闭的数量，当该计数为 0 时，系统关闭文件，删除该条目。</li> <li>文件磁盘位置：绝大多数文件操作都要求系统修改文件数据。该信息保存在内存中以免为每个操作都从磁盘中读取。</li> <li>访问权限：每个进程打开文件都需要有一个访问模式（创建、只读、读写、添加等)。该信息保存在进程的打开文件表中以便操作系统能允许或拒绝之后的I/O请求。</li></ul> <h3 id="文件的逻辑结构"><a href="#文件的逻辑结构" class="header-anchor">#</a> 文件的逻辑结构</h3> <p>文件的逻辑结构是从 <strong>用户观点</strong> 出发看到的文件的组织形式。文件的物理结构是从实现观点出发，又称为文件的存储结构，是指文件在外存上的存储组织形式。文件的逻辑结构与存储介质特性无关，但文件的物理结构与存储介质的特性有很大关系。</p> <p>按逻辑结构，文件有无结构文件和有结构文件两种类型：无结构文件和有结构文件。</p> <h4 id="无结构文件-流式文件"><a href="#无结构文件-流式文件" class="header-anchor">#</a> 无结构文件（流式文件）</h4> <p>无结构文件是最简单的文件组织形式。无结构文件将数据按顺序组织成记录并积累保存，它是有序相关信息项的集合，以 <strong>字节（Byte）</strong> 为单位。由于无结构文件没有结构，因而对记录的访问只能通过穷举搜索的方式，故这种文件形式对大多数应用不适用。</p> <p>但字符流的无结构文件管理简单，用户可以方便地对其进行操作。所以，那些对基本信息单位操作不多的文件较适于釆用字符流的无结构方式，如源程序文件、目标代码文件等。</p> <h4 id="有结构文件-记录式文件"><a href="#有结构文件-记录式文件" class="header-anchor">#</a> 有结构文件（记录式文件）</h4> <p>有结构文件按记录的组织形式可以分为：</p> <div id="顺序文件。" class="anchor">顺序文件。</div><p>文件中的记录一个接一个地顺序排列，记录可以是定长的或变长的，可以 <strong>顺序存储</strong> 或 <strong>以链表形式存储</strong>，在访问时需要顺序搜索文件。顺序文件有以下两种结构：</p> <ul><li>串结构，记录之间的顺序与关键字无关。通常的办法是由时间决定，即按存入时间的先后排列，最先存入的记录作为第 1 个记录，其次存入的为第 2 个记录，依此类推。</li> <li>顺序结构，指文件中的所有记录按关键字顺序排列。</li></ul> <p>在对记录进行批量操作时，即每次要读或写一大批记录，对顺序文件的效率是所有逻辑文件中最高的；此外，也只有顺序文件才能存储在磁带上，并能有效地工作，但顺序文件对查找、修改、增加或删除单个记录的操作比较困难。</p> <div id="索引文件" class="anchor">索引文件</div><p>对于定长记录文件，如果要查找第 i 个记录，可直接根据下式计算来获得第 i 个记录相对于第一个记录的地址：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFMAAAAQCAYAAABqfkPCAAAB3klEQVRYCe2WbdGDMBCEkVANlYAGJFQDEtCAhGqoBDRUAhqwkM7DZDt5rwGSDIUfbzvDhITLfWx2L62q3+9YBNq2dcMwuGOjrkd7PB7ucrkcmlPXde56vRLT3W43x3w9S/PVg+ju93veRuNn7+k0TW4cx8NzquvaNU1TFteD6Pq+L3OwN4rn+ysjltgItZH6+XXkZQBz10iA6nLal1SarYjn8/mWEbQupnZe/ZvWFES/TM2HvhYDFB/0vc2AgQG+ivo0weQHVvrGq6VTRvqk1EJRHHhKIhbQEiCJQ7/MVmgIJE442diJYJdyo5EALEh51vxJkl5mSUAKbAFaCiQHyS1usZH/6EiiFE9wPV5SH8n7AFE/31wkr2yGVFVFHaUK8yC6pZqjfTSGfHHj/RKiORJXCmKkCKL11JHDWzoI2s1Hy4kBSTBv+GcD0k9t4HvJnFzIUUVJ9luACEjZlQBKzCU1fKyTmJq7gmq0/UJ2BFiivfbuPYZAxG5pG88Cqe+hH60tjbb+0A4g33mgdc8wx21lwQmSmRmhjezDPnR8xDsqoQAO1OZq4we12U/zHEC32I2Nr3PGSYdA//WX8mYe0eDhIk7F0HD9916AgCT+A7QAPLsFZiL56F8Ca/xP5i+x3N36v3naAQAAAABJRU5ErkJggg==" alt="img"></p> <p>然而，对于可变长记录的文件，要查找第 i 个记录时，必须顺序地查找前 i - 1 个记录，从而获得相应记录的长度 L，然后才能按下式计算出第 i 个记录的首址：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAA1CAYAAACUax/TAAAEgklEQVR4Ae2ai1HDMAyGOwIzMAIzMAIzMAIzMAIzMAIzMAIzsEK5zyeBEpJWcmw3BXGXy6OWZf+/XrY5HK787/X19fj09HSMTuPj4+N4f38flovqyfaVCHx+fobJeXl5KcZwe3sblq0cZoqNQgCPTWJHoR3U8/z8fHx4eKjyuiQ2CPao5oRTdOF1NeE4iR3FVIUeyLm7u/v2WDyYQmrp4jerIom1aOzsGQLVc6NDS2KjiA1sr2G4htwkdiBRUVV4LCEWkiKyb29vx8fHR2Sq5CO6sm0ikAgkAolAIpAIJAKJQCKQCCQCTgRubm7KMoWlCs+RC5m1i+M/5xCyWQ8EZDOiEFR7nsq6l37kAKH0Zbcme4w7+3QgIIQWQuZ7wA7xSRMOENjowJPf39+559+lEIAMG5JbEEIolt2oS00r9YKAkFk8rdWBOd5fcwR4tYxgyeyv7m0CEoYLubUH7tE5EbbFkEqOljAe7aZLe6KORLLz/Quh1cdj5zVsayFFTyF3VGWLztrC7dxsiUTRQw3tk2jjltUqdGuRospb3+f51j2xbQPpZujg3T06Cqnl30/2XFhoVKGy7b1sUV29DKg7sTYkEHZ6hZ5tjvMjreerkNvTCMmp7jz2Mzz3Uw2xGBtpyMWRzVcA1arydM+woqHNt73CGTp6Gk6UWFKRRlYM7uTSz5IKvuTXJSulnacqBAiqVs/l6W+NcwmPpZBivK2XLtJf8Y61Meh3LzbaXu9RYtWAzdy1q+mdBhABwHqJi/9a7rQGbjqSujcxykKuKzQF1Gjfa/O2eXetjVW3ZPBEBK65E5wzeH4/GUlk8Fb/oXfBMFHW4EXWtC7PiqgDuLWURAg8GQadiqIeq92eDMNLpCIoA54MnPAsAGrfq/cly5xbpL6fs8xVJeYHLL7H8gxS17zCfo9gY4ZdHmuIhTc1OA3N3/3yQZPw90d5mOcWbUdnnpAz76/nuxpIax1zDGz/kKqGtBWbGmI1ZTImHceBvCCeV2L7nCisQX+HSBVEDs+wE7z0MxPsMSbTb8FCgSSHS1E5MfAt2NQQS0TFuJCd8xfmhMmpdYaFOwhoONo8sQZj24IN82iRq6unoWF4D+QCBJ5jq9LqiTUQ3BM24elglYTlS4OJ/pMVYWBmeHsLj98LNoGp76spJOAdhK8WI7OVbYv+so9KBCiU8I5K8YkYKUWKxMn3fBmMQKtlDaFcq/5fa8DBc/r36vBSvDWSD2kLiRRahG7tQ/8dlZD+74G9JACSTyGh6dUqpF8Sm6vWTSUOCa2viPdfNYA5+EQgEUgEEoFEwImAVrjO5qUZlTG5mrWrHmpE5LPtAARqih57AgS5e9jvHgDV31bBJoTdYcJ7W/8Lzd9GcMDsCKOWJI/KuYweInhks80ABDR86hEZIZlNfN1qXLpDIsTazX6+yWbHgFGnChcCkGLzpUdo7rF6luuRzTaDEGD3ST3Xq5Ica3Pq/N3bT7briICGYcglFC+FX/tNwu7BejkeHDWOjlPKrkEAj4UYJcyLCl6q3s7dK3dN7b4ArE+bbY4MhSoAAAAASUVORK5CYII=" alt="img"></p> <blockquote><p>注意：假定每个记录前用一个字节指明该记录的长度。</p></blockquote> <p><img src="/note-pages/assets/img/727485-20210705152524128-1070861700.057006e5.png" alt="img"></p> <p>变长记录文件只能顺序查找，系统开销较大。为此可以建立一张 <strong>索引表</strong> 以加快检索速度，索引表本身是 <strong>定长记录的顺序文件</strong>。在记录很多或是访问要求高的文件中，需要引入索引以提供有效的访问。实际中，通过索引可以成百上千倍地提高访问速度。</p> <div id="索引顺序文件" class="anchor">索引顺序文件</div><p>索引顺序文件是顺序和索引两种组织形式的结合。<strong>索引顺序文件</strong> 将顺序文件中的所有记录分为若干个组，为顺序文件建立一张索引表，在索引表中为每组中的第一个记录建立一个索引项，其中含有该记录的关键字值和指向该记录的指针。</p> <p>如图所示，主文件名包含姓名和其他数据项。姓名为关键字，索引表中为每组的第一个记录（不是每个记录）的关键字值，用指计指向主文件中该记录的起始位置。索引表只包含关键字和指计两个数据项，所有姓名关键字递增排列。主文件中记录分组排列，同一个组中关键字可以无序，但 <strong>组与组之间关键字必须有序</strong>。查找一个记录时，通过索引表找到其所在的组，然后在该组中使用顺序查找就能很快地找到记录。</p> <p><img src="/note-pages/assets/img/727485-20210705152534434-1168995069.12739f21.png" alt="img"></p> <p>索引文件和索引顺序文件都提高了存取的速度，但因为配置索引表而增加了存储空间。</p> <div id="直接文件或散列文件（hash-file）" class="anchor">直接文件或散列文件（Hash File）</div><p>给定记录的键值或通过 Hash 函数转换的键值直接决定记录的物理地址。这种映射结构不同于顺序文件或索引文件，没有顺序的特性。</p> <p>散列文件有很高的存取速度，但是会引起冲突，即不同关键字的散列函数值相同。</p> <h3 id="文件目录结构"><a href="#文件目录结构" class="header-anchor">#</a> 文件目录结构</h3> <p>与文件管理系统和文件集合相关联的是文件目录，它包含有关文件的信息，包括属性、位置和所有权等，这些信息主要是由操作系统进行管理。首先我们来看目录管理的基本要求：从用户的角度看，目录在用户（应用程序）所需要的文件名和文件之间提供一种映射，所以目录管理要实现 “按名存取”；目录存取的效率直接影响到系统的性能，所以要提高对目录的检索速度；在共享系统中，目录还需要提供用于控制访问文件的信息。此外，文件允许重名也是用户的合理和必然要求，目录管理通过树形结构来解决和实现。</p> <h4 id="文件控制块和索引结点"><a href="#文件控制块和索引结点" class="header-anchor">#</a> 文件控制块和索引结点</h4> <p>同进程管理一样，为实现目录管理，操作系统中引入了文件控制块的数据结构。</p> <div id="文件控制块" class="anchor">文件控制块</div><p><strong>文件控制块（FCB）</strong> 是用来存放控制文件需要的各种信息的数据结构，以实现 “按名存取”。<strong>FCB 的有序集合称为文件目录</strong>，一个 FCB 就是一个文件目录项。为了创建一个新文件，系统将分配一个 FCB 并存放在文件目录中，成为目录项。</p> <p>FCB 主要包含以下信息：</p> <ul><li>基本信息，如文件名、文件的物理位置、文件的逻辑结构、文件的物理结构等。</li> <li>存取控制信息，如文件存取权限等。</li> <li>使用信息，如文件建立时间、修改时间等。</li></ul> <div id="索引结点" class="anchor">索引结点</div><p>在检索目录文件的过程中，只用到了文件名，仅当找到一个目录项（查找文件名与目录项中文件名匹配）时，才需要从该目录项中读出该文件的物理地址。也就是说，在检索目录时，文件的其他描述信息不会用到，也不需调入内存。因此，有的系统（如 UNIX）釆用了 <strong>文件名和文件描述信息分开</strong> 的方法，文件描述信息单独形成一个称为 <strong>索引结点</strong> 的数据结构，简称为 <strong>i 结点</strong>。<strong>在文件目录中的每个目录项仅由文件名和指向该文件所对应的 i 结点的指针构成。</strong></p> <p>一个 FCB 的大小是 64 字节，盘块大小是 1KB，则在每个盘块中可以存放 16 个 FCB（注意，FCB 必须连续存放）。而在 UNIX 系统中一个目录项仅占 16 字节，其中 14 字节是文件名，2 字节是 i 结点指针。在 1KB 的盘块中可存放 64 个目录项。这样，可使查找文件时平均启动磁盘次数减少到原来的 1/4，大大节省了系统开销。</p> <p>存放在磁盘上的索引结点称为磁盘索引结点，UNIX 中的每个文件都有一个唯一的磁盘索引结点，主要包括以下几个方面：</p> <ul><li>文件主标识符，拥有该文件的个人或小组的标识符。</li> <li>文件类型，包括普通文件、目录文件或特别文件。</li> <li>文件存取权限，各类用户对该文件的存取权限。</li> <li>文件物理地址，每个索引结点中含有13个地址项，即 iaddr(0) ~ iaddr(12)，它们以直接或间接方式给出数据文件所在盘块的编号。</li> <li>文件长度，以字节为单位。</li> <li>文件链接计数，在本文件系统中所有指向该文件的文件名的指针计数。</li> <li>文件存取时间，本文件最近被进程存取的时间、最近被修改的时间以及索引结点最‘ 近被修改的时间。</li> <li>文件被打开时，磁盘索引结点复制到内存的索引结点中，以便于使用。在内存索引结点中又增加了以下内容：</li> <li>索引结点编号，用于标识内存索引结点。</li> <li>状态，指示i结点是否上锁或被修改。</li> <li>访问计数，每当有一进程要访问此i结点时，计数加1，访问结束减1。</li> <li>逻辑设备号，文件所属文件系统的逻辑设备号。</li> <li>链接指针，设置分别指向空闲链表和散列队列的指针。</li></ul> <h4 id="单级目录结构。"><a href="#单级目录结构。" class="header-anchor">#</a> 单级目录结构。</h4> <p>在整个文件系统中只建立一张目录表，每个文件占一个目录项，如图所示。</p> <p><img src="/note-pages/assets/img/727485-20210705152618465-477845327.1b4d8b83.png" alt="img"></p> <p>当访问一个文件时，先按文件名在该目录中查找到相应的 FCB，经合法性检查后执行相应的操作。当建立一个新文件时，必须先检索所有目录项以确保没有“重名”的情况，然后在该目录中增设一项，把 FCB 的全部信息保存在该项中。当删除一个文件时，先从该目录中找到该文件的目录项，回收该文件所占用的存储空间，然后再清除该目录项。</p> <p>单级目录结构实现了 “按名存取”，但是存在查找速度慢、文件不允许重名、不便于文件共享等缺点，而且对于多用户的操作系统显然是不适用的。</p> <h4 id="两级目录结构"><a href="#两级目录结构" class="header-anchor">#</a> 两级目录结构</h4> <p>单级目录很容易造成文件名称的混淆，可以考虑釆用两级方案，将文件目录分成 <strong>主文件目录</strong>（Master File Directory，MFD）和 <strong>用户文件目录</strong>（User File Directory，UFD）两级，如图所示。</p> <p><img src="/note-pages/assets/img/727485-20210705152627111-906709782.afc87d21.png" alt="img"></p> <p><strong>主文件目录项</strong> 记录用户名及相应用户文件目录所在的存储位置。<strong>用户文件目录项</strong> 记录该用户文件的 FCB 信息。当某用户欲对其文件进行访问时，只需搜索该用户对应的 UFD，这既解决了不同用户文件的 “重名”问题，也在一定程度上保证了文件的安全。</p> <p>两级目录结构可以解决多用户之间的文件重名问题，文件系统可以在目录上实现访问限制。但是两级目录结构缺乏灵活性，不能对文件分类。</p> <h4 id="多级目录结构-树形目录结构"><a href="#多级目录结构-树形目录结构" class="header-anchor">#</a> 多级目录结构（树形目录结构)</h4> <p>将两级目录结构的层次关系加以推广，就形成了多级目录结构，即树形目录结构，如图所示。</p> <p>用户要访问某个文件时用文件的路径名标识文件，文件路径名是个字符串，由从根目录出发到所找文件的通路上的所有目录名与数据文件名用分隔符链接起来而成。从根目录出发的路径称 <strong>绝对路径</strong>。当层次较多时，每次从根目录查询浪费时间，于是加入了 <strong>当前目录</strong>，进程对各文件的访问都是相对于当前目录进行的。当用户要访问某个文件时，使用 <strong>相对路径</strong> 标识文件，相对路径由从当前目录出发到所找文件通路上所有目录名与数据文件名用分隔符 “/” 链接而成。</p> <p><img src="/note-pages/assets/img/727485-20210705152641053-1438572888.ba1493d2.png" alt="img"></p> <p>“/dev/hda” 就是一个绝对路径。若当前目录为 “/bin”，则 “./ls” 就是一个相对路径，其中符号表示当前工作目录。</p> <p>通常，每个用户都有各自的 “当前目录”，<strong>登录后自动进入该用户的 “当前目录”</strong>。操作系统提供一条专门的系统调用，供用户随时改变 “当前目录”。例如，UNIX 系统中，“/etc/passwd” 文件就包含有用户登录时默认的 “当前目录”，可用 cd 命令改变 “当前目录”。</p> <p>树形目录结构可以很方便地对文件进行分类，层次结构清晰，也能够更有效地进行文件的管理和保护。但是，在树形目录中查找一个文件，需要按路径名逐级访问中间结点，这就增加了磁盘访问次数，无疑将影响查询速度。</p> <h4 id="无环图目录结构"><a href="#无环图目录结构" class="header-anchor">#</a> 无环图目录结构</h4> <p>树形目录结构可便于实现文件分类，但不便于实现文件共享，为此在树形目录结构的基础上增加了一些指向同一结点的有向边，使整个目录成为一个有向无环图。引入无环图目录结构是为了实现文件共享，如图所示。</p> <p>当某用户要求删除一个共享结点时，若系统只是简单地将它删除，当另一共享用户需要访问时，却无法找到这个文件而发生错误。为此可以为每个共享结点设置一个 共享计数器，每当图中增加对该结点的共享链时，计数器加 1;每当某用户提出删除该结点时，计数器减 1。仅当共享计数器为 0 时，才真正删除该结点，否则仅删除请求用户的共享链。</p> <p><img src="/note-pages/assets/img/727485-20210705152651867-1971541077.87e0f0d3.png" alt="img"></p> <p>共享文件（或目录）不同于文件拷贝（副本)。如果有两个文件拷贝，每个程序员看到的是拷贝而不是原件；但如果一个文件被修改，那么另一个程序员的拷贝不会有改变。对于共享文件，只存在一个真正文件，任何改变都会为其他用户所见。</p> <p>无环图目录结构方便实现了文件的共享，但使得系统的管理变得更加复杂。</p> <h3 id="共享文件"><a href="#共享文件" class="header-anchor">#</a> 共享文件</h3> <p>文件共享使多个用户（进程）共享同一份文件，系统中只需保留该文件的一份副本。如果系统不能提供共享功能，那么每个需要该文件的用户都要有各自的副本，会造成对存储空间的极大浪费。随着计算机技术的发展，文件共享的范围已由单机系统发展到多机系统，进而通过网络扩展到全球。这些文件的分享是通过分布式文件系统、远程文件系统、分布式信息系统实现的。这些系统允许多个客户通过 C/S 模型共享网络中的服务器文件。</p> <p>现代常用的两种文件共享方法有：</p> <h4 id="基于索引结点的共享方式-硬链接"><a href="#基于索引结点的共享方式-硬链接" class="header-anchor">#</a> 基于索引结点的共享方式（硬链接）</h4> <p>在树形结构的目录中，当有两个或多个用户要共享一个子目录或文件时，必须将共享文件或子目录链接到两个或多个用户的目录中，才能方便地找到该文件，如图所示。</p> <p><img src="/note-pages/assets/img/727485-20210705152709412-1004997912.231756f9.png" alt="img"></p> <p>在这种共享方式中引用 <strong>索引结点</strong>，即诸如文件的物理地址及其他的文件属性等信息，不再是放在目录项中，而是放在索引结点中。在文件目录中只设置文件名及指向相应索引结点的指针。<strong>在索引结点中还应有一个链接计数 count，用于表示链接到本索引结点（亦即文件） 上的用户目录项的数目</strong>。当 count = 2 时，表示有两个用户目录项链接到本文件上，或者说是有两个用户共享此文件。</p> <p>当用户 A 创建一个新文件时，它便是该文件的所有者，此时将 count 置为 1。当有用户 B 要共享此文件时，在用户 B 的目录中增加一个目录项，并设置一指针指向该文件的索引结点。此时，文件主仍然是用户 A，count = 2。如果用户 A 不再需要此文件，不能将文件直接删除。因为，若删除了该文件，也必然删除了该文件的索引结点，这样便会便用户 B 的指针悬空，而用户 B 则可能正在此文件上执行写操作，此时用户 B 会无法访问到文件。因此用户 A 不能删除此文件，只是将该文件的 count 减 1，然后删除自己目录中的相应目录项。用户 B 仍可以使用该文件。当 count=0 时，表示没有用户使用该文件，系统将负责删除该文件。</p> <h4 id="利用符号链实现文件共享-软链接"><a href="#利用符号链实现文件共享-软链接" class="header-anchor">#</a> 利用符号链实现文件共享（软链接）</h4> <p>为使用户 B 能共享用户 A 的一个文件 F，可以由系统创建一个 <strong>LINK 类型</strong> 的新文件，也取名为 F，并将文件 F 写入用户 B 的目录中，以实现用户 B 的目录与文件 F 的链接。<strong>在新文件中只包含被链接文件 F 的路径名</strong>。这样的链接方法被称为 <strong>符号链接</strong>。</p> <p>新文件中的路径名则只被看做是符号链，当用户 B 要访问被链接的文件 F 且正要读 LINK 类新文件时，操作系统根据新文件中的路径名去读该文件，从而实现了用户 B 对文件 F 的共享。</p> <p>在利用符号链方式实现文件共享时，只有文件的拥有者才拥有指向其索引结点的指针。而共享该文件的其他用户则只有该文件的路径名，并不拥有指向其索引结点的指针。这样，也就不会发生在文件主删除一共享文件后留下一悬空指针的情况。当文件的拥有者把一个共享文件删除后，其他用户通过符号链去访问它时，会出现访问失败，于是将符号链删除，此时不会产生任何影响。</p> <p>当然，利用符号链实现文件共享仍然存在问题，例如：一个文件釆用符号链方式共享，当文件拥有者将其删除，而在共享的其他用户使用其符号链接访问该文件之前，又有人在同一路径下创建了另一个具有同样名称的文件，则该符号链将仍然有效，但访问的文件已经改变，从而导致错误。</p> <p>在符号链的共享方式中，当其他用户读共享文件时，需要根据文件路径名逐个地查找目录，直至找到该文件的索引结点。因此，每次访问时，都可能要多次地读盘，使得访问文件的开销变大并增加了启动磁盘的频率。此外，符号链的索引结点也要耗费一定的磁盘空间。符号链方式有一个很大的优点，即网络共享只需提供该文件所在机器的网络地址以及该机器中的文件路径即可。</p> <p>上述两种链接方式都存在一个共同的问题，即每个共享文件都有几个文件名。换言之，每增加一条链接，就增加一个文件名。这实质上就是每个用户都使用自己的路径名去访问共享文件。当我们试图去遍历整个文件系统时，将会多次遍历到该共享文件。</p> <p>硬链接和软链接都是文件系统中的静态共享方法，在文件系统中还存在着另外的共享需求，即两个进程同时对同一个文件进行操作，这样的共享可以称为动态共享。</p> <h3 id="文件保护"><a href="#文件保护" class="header-anchor">#</a> 文件保护</h3> <p>为了防止文件共享可能会导致文件被破坏或未经核准的用户修改文件，文件系统必须控制用户对文件的存取，即解决对文件的读、写、执行的许可问题。为此，必须在文件系统中建立相应的文件保护机制。</p> <p>文件保护通过口令保护、加密保护和访问控制等方式实现。其中，口令保护和加密保护是为了防止用户文件被他人存取或窃取，而访问控制则用于控制用户对文件的访问方式。</p> <h4 id="访问类型"><a href="#访问类型" class="header-anchor">#</a> 访问类型</h4> <p>对文件的保护可以从限制对文件的访问类型中出发。可加以控制的访问类型主要有以下几种：</p> <ul><li>读：从文件中读。</li> <li>写：向文件中写。</li> <li>执行：将文件装入内存并执行。</li> <li>添加：将新信息添加到文件结尾部分。</li> <li>删除：删除文件，释放空间。</li> <li>列表清单：列出文件名和文件属性。</li></ul> <p>此外还可以对文件的重命名、复制、编辑等加以控制。这些高层的功能可以通过系统程序调用低层系统调用来实现。保护可以只在低层提供。例如，复制文件可利用一系列的读请求来完成。这样，具有读访问用户同时也具有复制和打印的权限了。</p> <h4 id="访问控制"><a href="#访问控制" class="header-anchor">#</a> 访问控制</h4> <p>解决访问控制最常用的方法是根据用户身份进行控制。而实现基于身份访问的最为普通的方法是为每个文件和目录增加一个访问控制列表（Access-Control List，ACL），以规定每个用户名及其所允许的访问类型。</p> <p>这种方法的优点是可以使用复杂的访问方法。其缺点是长度无法预期并且可能导致复杂的空间管理，使用精简的访问列表可以解决这个问题。</p> <p><strong>精简的访问列表</strong> 釆用 <strong>拥有者</strong>、<strong>组</strong> 和 <strong>其他</strong> 三种用户类型。</p> <ul><li>拥有者：创建文件的用户。</li> <li>组：一组需要共享文件且具有类似访问的用户。</li> <li>其他：系统内的所有其他用户。</li></ul> <p>这样只需用三个域列出访问表中这三类用户的访问权限即可。文件拥有者在创建文件时，说明创建者用户名及所在的组名，<strong>系统在创建文件时会将文件主的名字、所属组名列在该文件的 FCB 中</strong>。用户访问该文件时，按照拥有者所拥有的权限访问文件，如果用户和拥有者在同一个用户组则按照同组权限访问，否则只能按其他用户权限访问。UNIX 操作系统即釆用此种方法。</p> <p>口令和密码是另外两种访问控制方法。</p> <p><strong>口令</strong> 指用户在建立一个文件时提供一个口令，系统为其建立 FCB 时附上相应口令，同时告诉允许共享该文件的其他用户。用户请求访问时必须提供相应口令。这种方法时间和空间的开销不多，缺点是口令直接存在系统内部，不够安全。</p> <p><strong>密码</strong> 指用户对文件进行加密，文件被访问时需要使用密钥。这种方法保密性强，节省了存储空间，不过编码和译码要花费一定时间。</p> <p>口令和密码都是防止用户文件被他人存取或窃取，并没有控制用户对文件的访问类型。</p> <h2 id="_4-2-磁盘管理"><a href="#_4-2-磁盘管理" class="header-anchor">#</a> 4.2 磁盘管理</h2> <h3 id="磁盘的结构"><a href="#磁盘的结构" class="header-anchor">#</a> 磁盘的结构</h3> <p>磁盘（Disk）是由 <strong>表面涂有磁性物质的金属或塑料构成的圆形盘片，通过一个称为磁头的导体线圈从磁盘中存取数据</strong>。在读/写操作期间，磁头固定，磁盘在下面高速旋转。如图所示，磁盘的盘面上的数据存储在一组同心圆中，称为 <strong>磁道</strong>。每个磁道与磁头一样宽，一个盘面有上千个磁道。磁道又划分为几百个 <strong>扇区</strong>，每个扇区固定存储大小（通常为 512B），<strong>一个扇区称为一个盘块</strong>。相邻磁道及相邻扇区间通过一定的间隙分隔开，以避免精度错误。</p> <blockquote><p>注意，由于扇区按固定圆心角度划分，所以密度从最外道向里道增加，磁盘的存储能力受限于最内道的最大记录密度。</p></blockquote> <p>磁盘安装在一个磁盘驱动器中，它由磁头臂、用于旋转磁盘的主轴和用于数据输入/输出的电子设备组成。如图所示，多个盘片垂直堆叠，组成磁盘组，每个盘面对应一个 磁头，所有磁头固定在一起，与磁盘中心的距离相同且一起移动。所有盘片上相对位置相同的磁道组成 <strong>柱面</strong>。按照这种物理结构组织，<strong>扇区就是磁盘可寻址的最小存储单位</strong>，磁盘地址用 “柱面号 • 盘面号 • 扇区号（或块号）” 表示。<img src="/note-pages/assets/img/727485-20210705151848185-1206578286.3399eeb2.png" alt="img"></p> <p>磁盘按不同方式可以分为若干类型：磁头相对于盘片的径向方向固定的称为固定头磁盘，每个磁道一个磁头；磁头可移动的称为活动头磁盘，磁头臂可以来回伸缩定位磁道。磁 盘永久固定在磁盘驱动器内的称为固定盘磁盘；可移动和替换的称为可换盘磁盘。</p> <h3 id="磁盘调度算法"><a href="#磁盘调度算法" class="header-anchor">#</a> 磁盘调度算法</h3> <p>一次磁盘读写操作的时间由 <strong>寻找（寻道）时间</strong>、<strong>延迟时间</strong> 和 <strong>传输时间</strong> 决定：</p> <p><strong>寻找时间 Ts</strong>：活动头磁盘在读写信息前，<strong>将磁头移动到指定磁道所需要的时间</strong>。这个时间除跨越 n 条磁道的时间外，还包括启动磁臂的时间 s，即：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAPCAYAAAAvQwurAAACmUlEQVRYCe2XgY3CMAxFOwIzMAIzMAIzMAIzMAIzMAIzMAIzsEJPr8qvXJ/TpqEch9SToiRO7Hz72y7XNE3TXC6XdrPZtIfDoT2dTt1gz9CeM/bH47FFZ/37oghA3vP5HBAncq0bt9utJRmsbF0vG4H7/d4+Ho/lYoyx6/U6MJgeaCHUwudxL7Pn6/r1CFBAi8bYkwvEVKUDcpHzsK/01136nAUS+Xw+//JTiPB30WDL8Mi8OMHRW7Ts3W6XdTzSebcMxyGDQZKxZ4BViceZZHSbEkz8xohIJvGxPWWDe2O4pvT9OfhrkwosigtzttXz/Y2c9mD+ag+hOK1PB+D1Nk5tt9vOMck43+/3/R3Jc7MnuZTcKVw1RQL2GoLRwQ/5yI/hkEMFsbQCZDCaeYQqKBkWnLclh0WmPScgEGxl2CqpPq9DQErJRXcMF7bmJJmw1BKMz/Y/nOynNLE+CJge//SMAz4RINLLCCyBmosXPZ8sJTZyuMIKMgajAqDqGb4ovI/GTLdMBYnPXWJlCxQnazLPP/iOPZ8OVY3se1nKXLVzXZucVbkEciqY3pjHkM5nY0CvtoKFSX6ASTI/x7073VIbA0i2DaS7UYb6zNR+Kqj6dFiwkQxc+vb5ZLC6dq2gSDaH5AgD9tQJSjHo7RqCKUjelA3mkGCVea68ASsiIDp3zz601NoSJ5vIfLchqdQaNet+NHtydaeU5AiXbdklGPQmcy3BttjgBQy9XUAgSFnXBQ0HU3b295StBHVuZvZGKhfgwXmrHslwTnLrtNXTGn/oINr7GTtTfuotqzsHg9VjXUMwGNGzw9st3hM0DIUtoNjKejEXATrKX3bGHgeP2nY4lvm90rr4ngiocskwWvpHsux7wvVvkP4A1fsCWTHLAu0AAAAASUVORK5CYII=" alt="img"></p> <p>式中，m 是与磁盘驱动器速度有关的常数，约为 0.2ms，磁臂的启动时间约为 2ms。</p> <p><strong>延迟时间 Tr</strong>：<strong>磁头定位到某一磁道的扇区（块号）所需要的时间</strong>，设磁盘的旋转速度为 r，则：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAlCAYAAAAa0FocAAAB5ElEQVRoBe2YgY2DMAxFGaEzMAIzMAIzdARmYARmYITOwAjMwAo5PZSPUos70JWqTUKliDgByre/7Q9FkdBvnmdX17Ubx9ElBOt3KNM0ubZtXd/3AHaPxyMP4MYlF3DjkOTNK+LJh9gAvCJuHJK8eUU8+RAbgPlEHKmKckOuotyqqlrsXemK1Lvdbq5pmuUCboLNYM5gD/t+v6cjBwGF10LKCHS4hgb2ejhcjnOOwB+G4Qk0a1tiH+ok8wJgQRM+veXYUALaMsOeE7UN9SkQUYP4z8OT313X5QVc+b3bCg56lC4Ag44MusfB255/mo/05x5gHxLPdsZ4/idEgBcCzxsZWJv5TTWHDVCXqs/8SE+Pguo+rze/UgZtb2lp2MFanHxQJMuyXHIHqlNofKFbQeGYLNMABzFWT+QyoSWd1eZe9ZnqDDUEFr5VSn+LmgN0KJ2lPaKvOXtsoBZZ5sFGX6P2Lo93H0ltW6lXfXnWnzDi0F5ag1RQTbAOizf8RVH4fF91BTbFTrkvsKTDR98HzvYyVT1ss6rwRD1kwdn/+9H7/aUtaHVJRVieVh7LtkeKoKJv96K1AaTcFYiQ7spv7SVxpIdDY8BrEH3WBBCnfIvg0jO9fITCWx8jqNq6ObltGaE9jj8pC+a761FbXgAAAABJRU5ErkJggg==" alt="img"></p> <p>对于硬盘，典型的旋转速度为 5400r/m，相当于一周 11.1ms，则 Tr 为 5.55ms；对于软盘，其旋转速度在 300~600r/m 之间，则 Tr 为 50~100ms。</p> <p><strong>传输时间 Tt</strong>：<strong>从磁盘读出或向磁盘写入数据所经历的时间</strong>，这个时间取决于每次所读/写的字节数 b 和磁盘的旋转速度：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAAAmCAYAAACf8yaaAAACUklEQVRoBeWYYbHCMBCEKwENSEADEtCABDQgAQ1IQAMS0ICFvPk6t8w1zfWVH7xHEmYybZO2ZDe3e5cOQ6O/8/mc7vd7ahTeOlgQsN/vIaFvIkTX7XYTIerq93g6nRKtXwYc8t1ul4gO19Xn6fP5HP3ier0mGkbKsUs2DHh6PB4vAjabTTKS+uLkeDzO/AIyupTNdrudAJdsuqs5BNxLQrLpSx/DMOATSMIDpwDrNs0iE5GBT5Bmdd3dEQKIBKXVtwm4XC5jeB0Oh/FFvIxwo3FOY4xr3PrtP6jpAYB602HuIsLjgHWI831NnWM6eYVmBcskRQGa9NR0vs6JALSt/iwCICKPoKYiowQG2XTtwp4U/IINju/r8lx+EZWv9K+RClmHCFvTyFZfSbZFRDg55GOE/fX8mdOn2xQT5at9Q5wO2BUSKg402ln0CzIJoU9kED2/SaV6mZhPhJ/YIaF5YwUgK2mbnFEmmFruDcgnMtZGVRLD6s0vQibwCBViNexPmC/RbXOeRTTjpH0yFBFfqsRDMhhAShBRk1QACVgDPsMHpllnqx2QYas+y4BEx9sRUStRfmNZ2mJABIRUiY/Jk/mQKpmOo65LgLy34R95Aqi2TGAFWWntnQQUL4j2NroHovQc7xBx1ZIhEESH/+grYKVj7gcYKU3k6J2lZ6vow/2jSPAAAJr7gYF/SczfX+U5ul+zol4iHijPQ2a1EhEY6V7XS8eIDEgoZZald33lGABVBS9NkKIwIsOksyq6lv7j38cI7wikJoensPKYbHRvVHX+ADyoViQqo6S7AAAAAElFTkSuQmCC" alt="img"></p> <p>式中，r 为磁盘每秒钟的转数；N 为一个磁道上的字节数。</p> <p>在磁盘存取时间的计算中，寻道时间与磁盘调度算法相关，下面将会介绍分析几种算法，而延迟时间和传输时间都与磁盘旋转速度相关，且为线性相关，所以在硬件上，转速是磁盘性能的一个非常重要的参数。</p> <p>目前常用的磁盘调度算法有以下几种：</p> <h4 id="先来先服务算法"><a href="#先来先服务算法" class="header-anchor">#</a> 先来先服务算法</h4> <p>先来先服务（First Come First Served，FCFS）算法根据进程 <strong>请求访问磁盘的先后顺序</strong> 进行调度，这是一种最简单的调度算法，如图所示。该算法的优点是具有公平性。如果只有少量进程需要访问，且大部分请求都是访问簇聚的文件扇区，则有望达到较好的性能；但如果有大量进程竞争使用磁盘，那么这种算法在性能上往往接近于随机调度。所以，实际磁盘调度中考虑一些更为复杂的调度算法。</p> <p><img src="/note-pages/assets/img/727485-20210705152012611-859361644.8adb20c7.png" alt="img"></p> <p>例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184，磁头初始位置是 100 磁道，釆用 FCFS 算法磁头的运动过程如图所示。磁头共移动了 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>45</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>19</mn><mo>+</mo><mn>21</mn><mo>+</mo><mn>72</mn><mo>+</mo><mn>70</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>112</mn><mo>+</mo><mn>146</mn><mo>=</mo><mn>498</mn></mrow><annotation encoding="application/x-tex">45+3+19+21+72+70+10+112+146 = 498</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">7</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">7</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">4</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">9</span><span class="mord">8</span></span></span></span></span> 个磁道，平均寻找长度 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>498</mn><mi mathvariant="normal">/</mi><mn>9</mn><mo>=</mo><mn>55.3</mn></mrow><annotation encoding="application/x-tex">= 498 / 9 = 55.3</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mord">9</span><span class="mord">8</span><span class="mord">/</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">5</span><span class="mord">.</span><span class="mord">3</span></span></span></span></span>。</p> <h4 id="最短寻找时间优先算法"><a href="#最短寻找时间优先算法" class="header-anchor">#</a> 最短寻找时间优先算法</h4> <p>最短寻找时间优先（Shortest  Seek  Time  First，SSTF）选择调度处理的磁道是 <strong>与当前磁头所在磁道距离最近</strong> 的磁道，以使每次的寻找时间最短。当然，总是选择最小寻找时间并不能保证平均寻找时间最小，但是能提供比 FCFS 算法更好的性能。</p> <p><strong>这种算法会产生 “饥饿” 现象</strong>。如图所示，若某时刻磁头正在 18 号磁道，而在 18 号磁道附近频繁地增加新的请求，那么 SSTF 算法使得磁头长时间在 18 号磁道附近工作，将使 184 号磁道的访问被无限期地延迟，即被 “饿死”。</p> <p><img src="/note-pages/assets/img/727485-20210705152024070-1605968206.3c00de1c.png" alt="img"></p> <p>例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184，磁头初始位置是100磁道，釆用SSTF算法磁头的运动过程如图所示。磁头共移动了 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo>+</mo><mn>32</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>16</mn><mo>+</mo><mn>1</mn><mo>+</mo><mn>20</mn><mo>+</mo><mn>132</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>24</mn><mo>=</mo><mn>248</mn></mrow><annotation encoding="application/x-tex">10+32+3+16+1+20+132+10+24=248</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">4</span><span class="mord">8</span></span></span></span></span> 个磁道，平均寻找长度 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>248</mn><mi mathvariant="normal">/</mi><mn>9</mn><mo>=</mo><mn>27.5</mn></mrow><annotation encoding="application/x-tex">=248/9=27.5</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">4</span><span class="mord">8</span><span class="mord">/</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">7</span><span class="mord">.</span><span class="mord">5</span></span></span></span></span>。</p> <h4 id="扫描算法-又称电梯算法"><a href="#扫描算法-又称电梯算法" class="header-anchor">#</a> 扫描算法（又称电梯算法）</h4> <p>扫描（SCAN）算法（又称电梯算法）在磁头 <strong>当前移动方向上</strong> 选择与 <strong>当前磁头所在磁道距离最近</strong> 的请求作为下一次服务的对象，如图所示。由于磁头移动规律与电梯运行相似，故又称为电梯调度算法。SCAN 算法对最近扫描过的区域不公平，因此，它在访问局部性方面不如 FCFS 算法和 SSTF 算法好。</p> <p><img src="/note-pages/assets/img/727485-20210705152038852-376693944.d46153ce.png" alt="img"></p> <p>例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184，磁头初始位置是 100 磁道。釆用 SCAN 算法时，不但要知道磁头的当前位置，还要知道磁头的移动方向，假设磁头沿磁道号增大的顺序移动，则磁头的运动过程如图所示。磁头共移动了 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>24</mn><mo>+</mo><mn>94</mn><mo>+</mo><mn>32</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>16</mn><mo>+</mo><mn>1</mn><mo>+</mo><mn>20</mn><mo>=</mo><mn>250</mn></mrow><annotation encoding="application/x-tex">50+10+24+94+32+3+16+1+20=250</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">9</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">0</span></span></span></span></span> 个磁道，平均寻找长度 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>250</mn><mi mathvariant="normal">/</mi><mn>9</mn><mo>=</mo><mn>27.8</mn></mrow><annotation encoding="application/x-tex">=250/9=27.8</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">0</span><span class="mord">/</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">7</span><span class="mord">.</span><span class="mord">8</span></span></span></span></span>。</p> <h4 id="循环扫描算法"><a href="#循环扫描算法" class="header-anchor">#</a> 循环扫描算法</h4> <p>循环扫描（Circulair SCAN，C-SCAN）算法在扫描算法的基础上 <strong>规定磁头单向移动</strong> 来提供服务，回返时直接快速移动至起始端而不服务任何请求。由于 SCAN 算法偏向于处理那些接近最里或最外的磁道的访问请求，所以使用改进型 C-SCAN 算法的来避免这个问题。</p> <p>釆用 SCAN 算法和 C-SCAN 算法时磁头总是严格地遵循从盘面的一端到另一端，显然，在实际使用时还可以改进，即磁头移动只需要到达最远端的一个请求即可返回，不需要到达磁盘端点。这种形式的 SCAN 算法和 C-SCAN 算法称为 <strong>LOOK</strong> 和 <strong>C-LOOK</strong> 调度。这是因为它们在朝一个给定方向移动前会查看是否有请求。</p> <blockquote><p>注意，若无特别说明，可以默认 SCAN 算法和 C-SCAN 算法为 LOOK 和 C-LOOK 调度。</p></blockquote> <p><img src="/note-pages/assets/img/727485-20210705152049974-1797847150.01db0713.png" alt="img"></p> <p>例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184，磁头初始位置是 100 磁道。釆用 C-SCAN 算法时，假设磁头沿磁道号增大的顺序移动，则磁头的运动过程如图所示。磁头共移动了 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>24</mn><mo>+</mo><mn>166</mn><mo>+</mo><mn>20</mn><mo>+</mo><mn>1</mn><mo>+</mo><mn>16</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>32</mn><mo>=</mo><mn>322</mn></mrow><annotation encoding="application/x-tex">50+10+24+166+20+1+16+3+32=322</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mord">2</span></span></span></span></span>个磁道，平均寻道长度 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>322</mn><mi mathvariant="normal">/</mi><mn>9</mn><mo>=</mo><mn>35.8</mn></mrow><annotation encoding="application/x-tex">=322/9=35.8</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mord">2</span><span class="mord">/</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">5</span><span class="mord">.</span><span class="mord">8</span></span></span></span></span>。</p> <h4 id="减少延迟时间"><a href="#减少延迟时间" class="header-anchor">#</a> 减少延迟时间</h4> <p>除减少寻找时间外，减少延迟时间也是提高磁盘传输效率的重要因素。可以对盘面扇区进行交替编号，对磁盘片组中的不同盘面错位命名。假设每个盘面有 8 个扇区，磁盘片组共 8 个盘面，则可以釆用如图 4-29 所示的编号。</p> <p><img src="/note-pages/assets/img/727485-20210705152103638-940222780.19f5875a.png" alt="img"></p> <p>磁盘是连续自转设备，磁头读/写一个物理块后，需要经过短暂的处理时间才能开始读/ 写下一块。假设逻辑记录数据连续存放在磁盘空间中，若在盘面上按扇区交替编号连续存放，则连续读/写多个记录时能减少磁头的延迟时间；同柱面不同盘面的扇区若能错位编号，连续读/写相邻两个盘面的逻辑记录时也能减少磁头延迟时间。</p> <p>由于传输时间由磁盘转速决定，所以无法通过其他方法减少传输时间。以上图为例，在随机扇区访问情况下，定位磁道中的一个扇区平均需要转过4个扇区，这时，延迟时间是传输时间的4倍，这是一种非常低效的存取方式。理想化的情况是不需要定位而直接连续读取扇区，没有延迟时间，这样磁盘数据存取效率可以成倍提高。但是由于读取扇区的顺序是不可预测的，所以延迟时间不可避免。上图中的编号方式是读取连续编号扇区时的一种方法。</p> <h3 id="磁盘的管理"><a href="#磁盘的管理" class="header-anchor">#</a> 磁盘的管理</h3> <div id="磁盘初始化" class="anchor">磁盘初始化</div><p>一个新的磁盘只是一个含有磁性记录材料的空白盘。在磁盘能存储数据之前，它必须分成扇区以便磁盘控制器能进行读和写操作，这个过程称为 <strong>低级格式化（物理分区）</strong>。低级格式化为磁盘的每个扇区釆用特别的数据结构。每个扇区的数据结构通常由 <strong>头、数据区域</strong>（通常为 512B 大小）和 <strong>尾部</strong> 组成。头部和尾部包含了一些磁盘控制器所使用的信息。</p> <p>为了使用磁盘存储文件，操作系统还需要将自己的数据结构记录在磁盘上：第一步将磁盘分为由一个或多个柱面组成的分区（即我们熟悉的 C 盘、D 盘等形式的分区）；第二步对物理分区进行 <strong>逻辑格式化</strong>（创建文件系统），操作系统将初始的文件系统数据结构存储到磁盘上，这些数据结构包括空闲和已分配的空间以及一个初始为空的目录。</p> <div id="引导块" class="anchor">引导块</div><p>计算机启动时需要运行一个 <strong>初始化程序（自举程序）</strong>，它初始化 CPU、寄存器、设备控制器和内存等，接着启动操作系统。为此，该自举程序应找到磁盘上的操作系统内核，装入内存，并转到起始地址，从而开始操作系统的运行。</p> <p>自举程序通常保存在 ROM 中，为了避免改变自举代码需要改变 ROM 硬件的问题，故 <strong>只在 ROM 中保留很小的自举装入程序，将完整功能的自举程序保存在磁盘的启动块上</strong>，启动块位于磁盘的固定位。拥有启动分区的磁盘称为启动磁盘或者系统磁盘。</p> <div id="坏块" class="anchor">坏块</div><p>由于磁盘有移动部件且容错能力弱，所以容易导致一个或多个扇区损坏。部分磁盘甚至从出厂时就有坏扇区。根据所使用的磁盘和控制器，对这些块有多种处理方式。</p> <p>对于简单磁盘，如电子集成驱动器（IDE）。坏扇区可手工处理，如 MS-DOS 的 Format 命令执行逻辑格式化时便会扫描磁盘以检查坏扇区。坏扇区在 FAT 表上会标明，因此程序不会使用。</p> <p>对于复杂的磁盘，如小型计算机系统接口（SCSI），其控制器维护一个磁盘坏块链表。该链表在出厂前进行低级格式化时就初始化了，并在磁盘的整个使用过程中不断更新。低级格式化将一些块保留作为备用，对操作系统透明。控制器可以用备用块来逻辑地替代坏块，这种方案称为扇区备用。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-pages/operating-system/owchkr/" class="prev">
        第3章 内存管理
      </a></span> <span class="next"><a href="/note-pages/operating-system/05-输入输出管理.html">
        第5章 输入输出管理
      </a>
      →
    </span></p></div> </main> <aside items="[object Object],[object Object],[object Object],[object Object],[object Object]" class="right-sidebar"><div style="margin-left:20px; margin-bottom: 10px; text-align: center; font-size:16px;font-weight:bold;">此页内容</div> <div class="right-sidebar-wrap"><ul class="right-sidebar-links"><li id="tab-item0" class="right-sidebar-item active"><a href="#_4-1-文件系统" class="right-sidebar-item-level2">
          4.1 文件系统
        </a></li><li id="tab-item1" class="right-sidebar-item"><a href="#文件的概念和定义" class="right-sidebar-item-level3">
          文件的概念和定义
        </a></li><li id="tab-item2" class="right-sidebar-item"><a href="#文件的属性、基本操作以及文件的打开和关闭" class="right-sidebar-item-level3">
          文件的属性、基本操作以及文件的打开和关闭
        </a></li><li id="tab-item3" class="right-sidebar-item"><a href="#文件的逻辑结构" class="right-sidebar-item-level3">
          文件的逻辑结构
        </a></li><li id="tab-item4" class="right-sidebar-item"><a href="#无结构文件-流式文件" class="right-sidebar-item-level4">
          无结构文件（流式文件）
        </a></li><li id="tab-item5" class="right-sidebar-item"><a href="#有结构文件-记录式文件" class="right-sidebar-item-level4">
          有结构文件（记录式文件）
        </a></li><li id="tab-item6" class="right-sidebar-item"><a href="#文件目录结构" class="right-sidebar-item-level3">
          文件目录结构
        </a></li><li id="tab-item7" class="right-sidebar-item"><a href="#文件控制块和索引结点" class="right-sidebar-item-level4">
          文件控制块和索引结点
        </a></li><li id="tab-item8" class="right-sidebar-item"><a href="#单级目录结构。" class="right-sidebar-item-level4">
          单级目录结构。
        </a></li><li id="tab-item9" class="right-sidebar-item"><a href="#两级目录结构" class="right-sidebar-item-level4">
          两级目录结构
        </a></li><li id="tab-item10" class="right-sidebar-item"><a href="#多级目录结构-树形目录结构" class="right-sidebar-item-level4">
          多级目录结构（树形目录结构)
        </a></li><li id="tab-item11" class="right-sidebar-item"><a href="#无环图目录结构" class="right-sidebar-item-level4">
          无环图目录结构
        </a></li><li id="tab-item12" class="right-sidebar-item"><a href="#共享文件" class="right-sidebar-item-level3">
          共享文件
        </a></li><li id="tab-item13" class="right-sidebar-item"><a href="#基于索引结点的共享方式-硬链接" class="right-sidebar-item-level4">
          基于索引结点的共享方式（硬链接）
        </a></li><li id="tab-item14" class="right-sidebar-item"><a href="#利用符号链实现文件共享-软链接" class="right-sidebar-item-level4">
          利用符号链实现文件共享（软链接）
        </a></li><li id="tab-item15" class="right-sidebar-item"><a href="#文件保护" class="right-sidebar-item-level3">
          文件保护
        </a></li><li id="tab-item16" class="right-sidebar-item"><a href="#访问类型" class="right-sidebar-item-level4">
          访问类型
        </a></li><li id="tab-item17" class="right-sidebar-item"><a href="#访问控制" class="right-sidebar-item-level4">
          访问控制
        </a></li><li id="tab-item18" class="right-sidebar-item"><a href="#_4-2-磁盘管理" class="right-sidebar-item-level2">
          4.2 磁盘管理
        </a></li><li id="tab-item19" class="right-sidebar-item"><a href="#磁盘的结构" class="right-sidebar-item-level3">
          磁盘的结构
        </a></li><li id="tab-item20" class="right-sidebar-item"><a href="#磁盘调度算法" class="right-sidebar-item-level3">
          磁盘调度算法
        </a></li><li id="tab-item21" class="right-sidebar-item"><a href="#先来先服务算法" class="right-sidebar-item-level4">
          先来先服务算法
        </a></li><li id="tab-item22" class="right-sidebar-item"><a href="#最短寻找时间优先算法" class="right-sidebar-item-level4">
          最短寻找时间优先算法
        </a></li><li id="tab-item23" class="right-sidebar-item"><a href="#扫描算法-又称电梯算法" class="right-sidebar-item-level4">
          扫描算法（又称电梯算法）
        </a></li><li id="tab-item24" class="right-sidebar-item"><a href="#循环扫描算法" class="right-sidebar-item-level4">
          循环扫描算法
        </a></li><li id="tab-item25" class="right-sidebar-item"><a href="#减少延迟时间" class="right-sidebar-item-level4">
          减少延迟时间
        </a></li><li id="tab-item26" class="right-sidebar-item"><a href="#磁盘的管理" class="right-sidebar-item-level3">
          磁盘的管理
        </a></li></ul></div></aside></div><div class="global-ui"></div></div>
    <script src="/note-pages/assets/js/app.05dcbd87.js" defer></script><script src="/note-pages/assets/js/3.4a2f67fd.js" defer></script><script src="/note-pages/assets/js/2.ab82720e.js" defer></script><script src="/note-pages/assets/js/5.869d288f.js" defer></script>
  </body>
</html>
