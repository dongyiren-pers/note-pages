<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java | 后端技术栈笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/jquery/3.4.0/jquery.min.js"></script>
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" href="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">
    <meta name="description" content="BackEnd Notes">
    
    <link rel="preload" href="/note-pages/assets/css/0.styles.167a34c7.css" as="style"><link rel="preload" href="/note-pages/assets/js/app.05dcbd87.js" as="script"><link rel="preload" href="/note-pages/assets/js/3.4a2f67fd.js" as="script"><link rel="preload" href="/note-pages/assets/js/2.ab82720e.js" as="script"><link rel="preload" href="/note-pages/assets/js/66.dd49594c.js" as="script"><link rel="prefetch" href="/note-pages/assets/js/10.e11a80d9.js"><link rel="prefetch" href="/note-pages/assets/js/100.489cf69a.js"><link rel="prefetch" href="/note-pages/assets/js/101.560e37ea.js"><link rel="prefetch" href="/note-pages/assets/js/102.baaa4f6a.js"><link rel="prefetch" href="/note-pages/assets/js/103.262b6423.js"><link rel="prefetch" href="/note-pages/assets/js/104.ac33d7ce.js"><link rel="prefetch" href="/note-pages/assets/js/105.5e6ce18f.js"><link rel="prefetch" href="/note-pages/assets/js/106.a69322ef.js"><link rel="prefetch" href="/note-pages/assets/js/107.6cdb78ee.js"><link rel="prefetch" href="/note-pages/assets/js/108.1d720289.js"><link rel="prefetch" href="/note-pages/assets/js/109.58f7297c.js"><link rel="prefetch" href="/note-pages/assets/js/11.241a46da.js"><link rel="prefetch" href="/note-pages/assets/js/110.9cef761d.js"><link rel="prefetch" href="/note-pages/assets/js/111.c782138c.js"><link rel="prefetch" href="/note-pages/assets/js/112.40cb3b1a.js"><link rel="prefetch" href="/note-pages/assets/js/113.c367e40a.js"><link rel="prefetch" href="/note-pages/assets/js/114.a4a75db5.js"><link rel="prefetch" href="/note-pages/assets/js/115.a73cd469.js"><link rel="prefetch" href="/note-pages/assets/js/116.ad853155.js"><link rel="prefetch" href="/note-pages/assets/js/117.a82b2649.js"><link rel="prefetch" href="/note-pages/assets/js/118.8f896dd0.js"><link rel="prefetch" href="/note-pages/assets/js/119.374482b1.js"><link rel="prefetch" href="/note-pages/assets/js/12.ebe220d5.js"><link rel="prefetch" href="/note-pages/assets/js/120.89698284.js"><link rel="prefetch" href="/note-pages/assets/js/121.cbe50685.js"><link rel="prefetch" href="/note-pages/assets/js/122.7de2ac51.js"><link rel="prefetch" href="/note-pages/assets/js/123.a2d16009.js"><link rel="prefetch" href="/note-pages/assets/js/124.e1ba7cbe.js"><link rel="prefetch" href="/note-pages/assets/js/125.4e1e6d6a.js"><link rel="prefetch" href="/note-pages/assets/js/126.3db22af3.js"><link rel="prefetch" href="/note-pages/assets/js/127.937f4ffc.js"><link rel="prefetch" href="/note-pages/assets/js/128.0bad2e20.js"><link rel="prefetch" href="/note-pages/assets/js/129.75a99d25.js"><link rel="prefetch" href="/note-pages/assets/js/13.5ee7bef5.js"><link rel="prefetch" href="/note-pages/assets/js/130.599b6d3d.js"><link rel="prefetch" href="/note-pages/assets/js/131.687214bf.js"><link rel="prefetch" href="/note-pages/assets/js/132.8295c067.js"><link rel="prefetch" href="/note-pages/assets/js/133.854d61c0.js"><link rel="prefetch" href="/note-pages/assets/js/134.f3fc20e1.js"><link rel="prefetch" href="/note-pages/assets/js/135.2a5a690d.js"><link rel="prefetch" href="/note-pages/assets/js/136.6ba30378.js"><link rel="prefetch" href="/note-pages/assets/js/137.80d7c511.js"><link rel="prefetch" href="/note-pages/assets/js/138.0a25898e.js"><link rel="prefetch" href="/note-pages/assets/js/139.fb3c377f.js"><link rel="prefetch" href="/note-pages/assets/js/14.a561f8b3.js"><link rel="prefetch" href="/note-pages/assets/js/140.cbfdbe32.js"><link rel="prefetch" href="/note-pages/assets/js/141.c09f054f.js"><link rel="prefetch" href="/note-pages/assets/js/142.723bd973.js"><link rel="prefetch" href="/note-pages/assets/js/143.b31785f9.js"><link rel="prefetch" href="/note-pages/assets/js/144.69d3d121.js"><link rel="prefetch" href="/note-pages/assets/js/145.c4ee6aa0.js"><link rel="prefetch" href="/note-pages/assets/js/146.7f836a1c.js"><link rel="prefetch" href="/note-pages/assets/js/147.d4a57976.js"><link rel="prefetch" href="/note-pages/assets/js/148.b15e75eb.js"><link rel="prefetch" href="/note-pages/assets/js/149.94085ddc.js"><link rel="prefetch" href="/note-pages/assets/js/15.4ed118f1.js"><link rel="prefetch" href="/note-pages/assets/js/150.6751d41b.js"><link rel="prefetch" href="/note-pages/assets/js/151.bd60e322.js"><link rel="prefetch" href="/note-pages/assets/js/152.15caf78f.js"><link rel="prefetch" href="/note-pages/assets/js/153.131128fc.js"><link rel="prefetch" href="/note-pages/assets/js/154.b8ee2e7d.js"><link rel="prefetch" href="/note-pages/assets/js/155.8fa1e2e0.js"><link rel="prefetch" href="/note-pages/assets/js/156.25e2a796.js"><link rel="prefetch" href="/note-pages/assets/js/157.7137c9c3.js"><link rel="prefetch" href="/note-pages/assets/js/158.fdc18c40.js"><link rel="prefetch" href="/note-pages/assets/js/159.0dadb745.js"><link rel="prefetch" href="/note-pages/assets/js/16.818fc8bf.js"><link rel="prefetch" href="/note-pages/assets/js/160.05f7541c.js"><link rel="prefetch" href="/note-pages/assets/js/161.2a8c62a2.js"><link rel="prefetch" href="/note-pages/assets/js/162.5b9983b7.js"><link rel="prefetch" href="/note-pages/assets/js/163.b51a5538.js"><link rel="prefetch" href="/note-pages/assets/js/164.06c9f20a.js"><link rel="prefetch" href="/note-pages/assets/js/165.c25063f4.js"><link rel="prefetch" href="/note-pages/assets/js/166.6c570da5.js"><link rel="prefetch" href="/note-pages/assets/js/167.12fb6fb6.js"><link rel="prefetch" href="/note-pages/assets/js/168.d7dd27bc.js"><link rel="prefetch" href="/note-pages/assets/js/169.27f575fe.js"><link rel="prefetch" href="/note-pages/assets/js/17.9daf0c47.js"><link rel="prefetch" href="/note-pages/assets/js/170.ba4295ef.js"><link rel="prefetch" href="/note-pages/assets/js/171.3fb54078.js"><link rel="prefetch" href="/note-pages/assets/js/18.086ed162.js"><link rel="prefetch" href="/note-pages/assets/js/19.adca670c.js"><link rel="prefetch" href="/note-pages/assets/js/20.2e9ff004.js"><link rel="prefetch" href="/note-pages/assets/js/21.07830947.js"><link rel="prefetch" href="/note-pages/assets/js/22.609929cb.js"><link rel="prefetch" href="/note-pages/assets/js/23.d83b832f.js"><link rel="prefetch" href="/note-pages/assets/js/24.592e8014.js"><link rel="prefetch" href="/note-pages/assets/js/25.9d28bb6f.js"><link rel="prefetch" href="/note-pages/assets/js/26.fd4195d5.js"><link rel="prefetch" href="/note-pages/assets/js/27.ca60e875.js"><link rel="prefetch" href="/note-pages/assets/js/28.c2cd75e6.js"><link rel="prefetch" href="/note-pages/assets/js/29.4213d132.js"><link rel="prefetch" href="/note-pages/assets/js/30.c6ee0ead.js"><link rel="prefetch" href="/note-pages/assets/js/31.eea6a542.js"><link rel="prefetch" href="/note-pages/assets/js/32.1ffdceaf.js"><link rel="prefetch" href="/note-pages/assets/js/33.0425748b.js"><link rel="prefetch" href="/note-pages/assets/js/34.5dd0d81d.js"><link rel="prefetch" href="/note-pages/assets/js/35.773df14e.js"><link rel="prefetch" href="/note-pages/assets/js/36.5db32ea2.js"><link rel="prefetch" href="/note-pages/assets/js/37.1106162c.js"><link rel="prefetch" href="/note-pages/assets/js/38.793ba7d0.js"><link rel="prefetch" href="/note-pages/assets/js/39.488fb9a5.js"><link rel="prefetch" href="/note-pages/assets/js/4.550e6883.js"><link rel="prefetch" href="/note-pages/assets/js/40.9c05b0ae.js"><link rel="prefetch" href="/note-pages/assets/js/41.ae198526.js"><link rel="prefetch" href="/note-pages/assets/js/42.d815456e.js"><link rel="prefetch" href="/note-pages/assets/js/43.1808aff8.js"><link rel="prefetch" href="/note-pages/assets/js/44.c26d9bde.js"><link rel="prefetch" href="/note-pages/assets/js/45.fae5f755.js"><link rel="prefetch" href="/note-pages/assets/js/46.703057c9.js"><link rel="prefetch" href="/note-pages/assets/js/47.ed3a23ce.js"><link rel="prefetch" href="/note-pages/assets/js/48.c5a46ee8.js"><link rel="prefetch" href="/note-pages/assets/js/49.b04c1681.js"><link rel="prefetch" href="/note-pages/assets/js/5.869d288f.js"><link rel="prefetch" href="/note-pages/assets/js/50.249fc2a7.js"><link rel="prefetch" href="/note-pages/assets/js/51.cab74632.js"><link rel="prefetch" href="/note-pages/assets/js/52.e2f231b3.js"><link rel="prefetch" href="/note-pages/assets/js/53.6241e308.js"><link rel="prefetch" href="/note-pages/assets/js/54.7d29c5c0.js"><link rel="prefetch" href="/note-pages/assets/js/55.a9050f95.js"><link rel="prefetch" href="/note-pages/assets/js/56.75828a09.js"><link rel="prefetch" href="/note-pages/assets/js/57.b3f75d67.js"><link rel="prefetch" href="/note-pages/assets/js/58.0cf3bd1c.js"><link rel="prefetch" href="/note-pages/assets/js/59.19f18f1f.js"><link rel="prefetch" href="/note-pages/assets/js/6.d879438f.js"><link rel="prefetch" href="/note-pages/assets/js/60.61940d92.js"><link rel="prefetch" href="/note-pages/assets/js/61.bc890bb0.js"><link rel="prefetch" href="/note-pages/assets/js/62.f487437c.js"><link rel="prefetch" href="/note-pages/assets/js/63.4a91369b.js"><link rel="prefetch" href="/note-pages/assets/js/64.1b0770e4.js"><link rel="prefetch" href="/note-pages/assets/js/65.b56e2b22.js"><link rel="prefetch" href="/note-pages/assets/js/67.22efede4.js"><link rel="prefetch" href="/note-pages/assets/js/68.0d22a8a4.js"><link rel="prefetch" href="/note-pages/assets/js/69.aec9bfeb.js"><link rel="prefetch" href="/note-pages/assets/js/7.e3626849.js"><link rel="prefetch" href="/note-pages/assets/js/70.0c53c20d.js"><link rel="prefetch" href="/note-pages/assets/js/71.6d6db7d6.js"><link rel="prefetch" href="/note-pages/assets/js/72.fdcfb985.js"><link rel="prefetch" href="/note-pages/assets/js/73.a390b48d.js"><link rel="prefetch" href="/note-pages/assets/js/74.e817987f.js"><link rel="prefetch" href="/note-pages/assets/js/75.f144cf4f.js"><link rel="prefetch" href="/note-pages/assets/js/76.7be2f5f1.js"><link rel="prefetch" href="/note-pages/assets/js/77.6568d596.js"><link rel="prefetch" href="/note-pages/assets/js/78.4ff63ca8.js"><link rel="prefetch" href="/note-pages/assets/js/79.daaf791e.js"><link rel="prefetch" href="/note-pages/assets/js/8.f9f716a1.js"><link rel="prefetch" href="/note-pages/assets/js/80.a0605696.js"><link rel="prefetch" href="/note-pages/assets/js/81.ecb125f5.js"><link rel="prefetch" href="/note-pages/assets/js/82.b64b1c42.js"><link rel="prefetch" href="/note-pages/assets/js/83.d13b7f19.js"><link rel="prefetch" href="/note-pages/assets/js/84.c584da75.js"><link rel="prefetch" href="/note-pages/assets/js/85.7992353f.js"><link rel="prefetch" href="/note-pages/assets/js/86.17ad6399.js"><link rel="prefetch" href="/note-pages/assets/js/87.289f9f2f.js"><link rel="prefetch" href="/note-pages/assets/js/88.3496d6e2.js"><link rel="prefetch" href="/note-pages/assets/js/89.0d0c778d.js"><link rel="prefetch" href="/note-pages/assets/js/9.3209071f.js"><link rel="prefetch" href="/note-pages/assets/js/90.245b9fda.js"><link rel="prefetch" href="/note-pages/assets/js/91.806af5f2.js"><link rel="prefetch" href="/note-pages/assets/js/92.8a10f401.js"><link rel="prefetch" href="/note-pages/assets/js/93.ea90ae18.js"><link rel="prefetch" href="/note-pages/assets/js/94.98cc66ef.js"><link rel="prefetch" href="/note-pages/assets/js/95.836e96c5.js"><link rel="prefetch" href="/note-pages/assets/js/96.d4dd3eee.js"><link rel="prefetch" href="/note-pages/assets/js/97.e4275cb9.js"><link rel="prefetch" href="/note-pages/assets/js/98.0e320d92.js"><link rel="prefetch" href="/note-pages/assets/js/99.e6f77650.js">
    <link rel="stylesheet" href="/note-pages/assets/css/0.styles.167a34c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-pages/" class="home-link router-link-active"><!----> <span class="site-name">后端技术栈笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note-pages/interview/f05h67/" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/f05h67/#计算机网络" class="sidebar-link">计算机网络</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/f05h67/#操作系统" class="sidebar-link">操作系统</a></li></ul></li><li><a href="/note-pages/interview/Java.html" aria-current="page" class="active sidebar-link">Java</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/Java.html#基础" class="sidebar-link">基础</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/Java.html#java-集合" class="sidebar-link">Java 集合</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/Java.html#java-并发" class="sidebar-link">Java 并发</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/Java.html#jvm" class="sidebar-link">JVM</a></li></ul></li><li><a href="/note-pages/interview/数据库.html" class="sidebar-link">数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/数据库.html#mysql" class="sidebar-link">MySQL</a></li></ul></li><li><a href="/note-pages/interview/NoSQL.html" class="sidebar-link">NoSQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/NoSQL.html#redis" class="sidebar-link">Redis</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/NoSQL.html#elasticsearch" class="sidebar-link">ElasticSearch</a></li></ul></li><li><a href="/note-pages/interview/2t6vir/" class="sidebar-link">Spring</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/2t6vir/#spring-core" class="sidebar-link">Spring Core</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/2t6vir/#spring-aop" class="sidebar-link">Spring AOP</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/2t6vir/#spring-dao" class="sidebar-link">Spring DAO</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/2t6vir/#spring-mvc" class="sidebar-link">Spring MVC</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/2t6vir/#springboot" class="sidebar-link">SpringBoot</a></li></ul></li><li><a href="/note-pages/interview/消息队列.html" class="sidebar-link">消息队列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/消息队列.html#基础" class="sidebar-link">基础</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/消息队列.html#rocketmq" class="sidebar-link">RocketMQ</a></li></ul></li><li><a href="/note-pages/interview/架构设计.html" class="sidebar-link">架构设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/架构设计.html#zookeeper" class="sidebar-link">Zookeeper</a></li></ul></li><li><a href="/note-pages/interview/数据结构与算法.html" class="sidebar-link">数据结构与算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/数据结构与算法.html#数据结构" class="sidebar-link">数据结构</a></li><li class="sidebar-sub-header"><a href="/note-pages/interview/数据结构与算法.html#算法模板" class="sidebar-link">算法模板</a></li></ul></li><li><a href="/note-pages/interview/场景题.html" class="sidebar-link">场景题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/interview/场景题.html#场景题-2" class="sidebar-link">场景题</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java"><a href="#java" class="header-anchor">#</a> Java</h1> <p></p><div class="table-of-contents"><ul><li><a href="#基础">基础</a><ul><li><a href="#string、stringbuffer、stringbuilder-的区别">String、StringBuffer、StringBuilder 的区别</a></li><li><a href="#接口与抽象类的区别">接口与抽象类的区别</a></li><li><a href="#如何通过反射获取-class-对象">如何通过反射获取 Class 对象</a></li><li><a href="#jdk-动态代理与-cglib-动态代理的区别">JDK 动态代理与 CGLib 动态代理的区别</a></li><li><a href="#arrays-sort-方法里的排序算法">Arrays.sort 方法里的排序算法</a></li></ul></li><li><a href="#java-集合">Java 集合</a><ul><li><a href="#fail-fast-和-fail-safe-策略">fail-fast 和 fail-safe 策略</a></li><li><a href="#hashmap-的扩容机制">HashMap 的扩容机制</a></li></ul></li><li><a href="#java-并发">Java 并发</a><ul><li><a href="#写一个必定发生死锁的代码">写一个必定发生死锁的代码</a></li><li><a href="#synchronized-锁升级">synchronized 锁升级</a></li><li><a href="#volatile-的功能和实现原理">volatile 的功能和实现原理</a></li><li><a href="#volatile-和-synchronized-区别">volatile 和 synchronized 区别</a></li><li><a href="#什么是-aqs">什么是 AQS</a></li><li><a href="#公平锁与非公平锁的区别">公平锁与非公平锁的区别</a></li><li><a href="#concurrenthashmap-的-put-方法">ConcurrentHashMap 的 put 方法</a></li><li><a href="#线程池的工作原理">线程池的工作原理</a></li><li><a href="#如何合理设置线程池的核心线程数">如何合理设置线程池的核心线程数</a></li></ul></li><li><a href="#jvm">JVM</a><ul><li><a href="#类的加载过程">类的加载过程</a></li><li><a href="#双亲委派机制">双亲委派机制</a></li><li><a href="#jvm-内存结构">JVM 内存结构</a></li><li><a href="#如何判断对象是否可被回收">如何判断对象是否可被回收</a></li><li><a href="#垃圾回收算法">垃圾回收算法</a></li><li><a href="#新生代对象何时进入老年代">新生代对象何时进入老年代</a></li><li><a href="#什么情况下会触发-full-gc">什么情况下会触发 Full GC</a></li><li><a href="#oom-场景及解决方案">OOM 场景及解决方案</a></li><li><a href="#线上-cpu-飙升-100-问题排查">线上 CPU 飙升 100% 问题排查</a></li></ul></li></ul></div><p></p> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <h3 id="string、stringbuffer、stringbuilder-的区别"><a href="#string、stringbuffer、stringbuilder-的区别" class="header-anchor">#</a> String、StringBuffer、StringBuilder 的区别</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里</span></div><style>
                        .table-column-x-x-container-v3yqnqx5 table th:nth-of-type(1) {
                            width: 18.181818181818183%;
                            word-wrap: break-word;
                        }
                    
                        .table-column-x-x-container-v3yqnqx5 table th:nth-of-type(2) {
                            width: 27.27272727272727%;
                            word-wrap: break-word;
                        }
                    
                        .table-column-x-x-container-v3yqnqx5 table th:nth-of-type(3) {
                            width: 27.27272727272727%;
                            word-wrap: break-word;
                        }
                    
                        .table-column-x-x-container-v3yqnqx5 table th:nth-of-type(4) {
                            width: 27.27272727272727%;
                            word-wrap: break-word;
                        }
                    </style><div class="table-column-x-x-container-v3yqnqx5"><table><thead><tr><th>类型</th> <th>String</th> <th>StringBuilder</th> <th>StringBuilder</th></tr></thead> <tbody><tr><td>线程是否安全</td> <td>线程安全</td> <td>线程安全</td> <td><strong>线程不安全</strong></td></tr> <tr><td>线程安全原因</td> <td><strong>不可变序列</strong></td> <td><strong>synchronized 方法</strong></td> <td>—</td></tr> <tr><td>拼接性能</td> <td>最慢</td> <td>较快</td> <td>最快</td></tr> <tr><td>性能影响因素</td> <td>一旦创建不可修改，需要不断创建新对象并将旧对象回收</td> <td>JDK 6 之前无差别使用重量级锁，CPU 需频繁切换用户态和内核态</td> <td>—</td></tr> <tr><td>实现接口</td> <td>Comparable<br>CharSequence</td> <td>Appendable<br>CharSequence</td> <td>Appendable<br>CharSequence</td></tr> <tr><td>适用场景</td> <td>少量字符串操作</td> <td><strong>多线程</strong>，在字符缓冲区进行大量操作</td> <td><strong>单线程</strong>，在字符缓冲区进行大量操作</td></tr></tbody></table></div><h3 id="接口与抽象类的区别"><a href="#接口与抽象类的区别" class="header-anchor">#</a> 接口与抽象类的区别</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里</span></div><style>
                        .table-column-x-x-container-f7pvq3ns table th:nth-of-type(1) {
                            width: 20%;
                            word-wrap: break-word;
                        }
                    
                        .table-column-x-x-container-f7pvq3ns table th:nth-of-type(2) {
                            width: 40%;
                            word-wrap: break-word;
                        }
                    
                        .table-column-x-x-container-f7pvq3ns table th:nth-of-type(3) {
                            width: 40%;
                            word-wrap: break-word;
                        }
                    </style><div class="table-column-x-x-container-f7pvq3ns"><table><thead><tr><th></th> <th>接口</th> <th>抽象类</th></tr></thead> <tbody><tr><td>方法的实现</td> <td>JDK 8 之后允许有静态和默认实现</td> <td>允许有实现</td></tr> <tr><td>方法访问限定</td> <td>默认且只能为 public</td> <td>可以为 public、protected 和 default</td></tr> <tr><td>成员变量类型</td> <td>只能有 public static final 成员变量</td> <td>可以有普通成员变量</td></tr> <tr><td>继承或实现机制</td> <td>一个接口可以继承多个接口<br>一个类可以实现多个接口</td> <td>一个类只能继承一个抽象类</td></tr> <tr><td>设计层面</td> <td>对行为的抽象，是一种行为的规范</td> <td>对类的抽象，是一种模板设计</td></tr></tbody></table></div><h3 id="如何通过反射获取-class-对象"><a href="#如何通过反射获取-class-对象" class="header-anchor">#</a> 如何通过反射获取 Class 对象</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里</span></div><ul><li><a href="/note-pages/java/5ddf7a/#getclass-方法"><strong>getClass 方法</strong></a>：Object 类的 getClass() 方法返回一个 Class 对象。</li> <li><a href="/note-pages/java/5ddf7a/#forname-方法"><strong>forName 方法</strong></a>：Class 类的静态方法 forName(className) 返回类名对应的 Class 对象。</li> <li><a href="/note-pages/java/5ddf7a/#t-class"><strong>T.class</strong></a>：如果 T 是任意的 Java 类型，T.class 代表匹配的 Class 对象。</li></ul> <h3 id="jdk-动态代理与-cglib-动态代理的区别"><a href="#jdk-动态代理与-cglib-动态代理的区别" class="header-anchor">#</a> JDK 动态代理与 CGLib 动态代理的区别</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里飞猪</span></div><p><strong>实现机制不同</strong></p> <ul><li><a href="/note-pages/java/5ddf7a/#jdk-动态代理"><strong>JDK 动态代理</strong></a>：委托机制。Proxy 通过 <strong>反射机制</strong> 动态创建代理类实例。代理类和目标类实现了同样的接口，InvocationHandler 持有目标类对象，代理类委托 InvocationHandler 去调用目标类的原始方法。</li> <li><a href="/note-pages/java/5ddf7a/#cglib-动态代理"><strong>CGLib 动态代理</strong></a>：继承机制。Enhancer 通过 <strong>字节码技术</strong> 动态创建代理类实例。代理类继承了目标类并重写了目标方法，通过 MethodInterceptor 调用父类方法执行原始逻辑。</li></ul> <p><strong>回调方式不同</strong></p> <ul><li>JDK 动态代理：反射。</li> <li>CGLib 动态代理：通过 <a href="/note-pages/java/5ddf7a/#fastclass-机制"><strong>FastClass 机制</strong></a> 的方法索引直接调用。</li></ul> <p><strong>适用场景不同</strong></p> <ul><li>JDK 动态代理：目标类是接口类。</li> <li>CGLib 动态代理：非接口类、非 final 类，非 final 方法。</li></ul> <p><strong>执行效率不同</strong></p> <ul><li>JDK 动态代理：效率瓶颈在反射调用，稍慢。</li> <li>CGLib 动态代理：通过 FastClass 机制，较快。但第一次调用需要生成多个 Class 对象，较慢。</li></ul> <h3 id="arrays-sort-方法里的排序算法"><a href="#arrays-sort-方法里的排序算法" class="header-anchor">#</a> Arrays.sort 方法里的排序算法</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">大疆</span></div><p>Arrays.Sort 方法里的排序算法主要涉及以下四种：<a href="/note-pages/algorithm/i9pdiv/#双轴快速排序"><strong>双轴快速排序</strong></a>、<a href="/note-pages/algorithm/i9pdiv/#插入排序"><strong>插入排序</strong></a>、<strong>TimSort</strong>、<a href="/note-pages/algorithm/i9pdiv/#归并排序"><strong>归并排序</strong></a>。</p> <ul><li>数组类型为基础类型时，采用 <strong>双轴快速排序</strong>，辅以 <strong>插入排序</strong>；</li> <li>数组类型为引用类型时，采用 <strong>TimSort</strong> 或者 <strong>归并排序</strong>（除非特殊配置，否则默认采用 TimSort）。</li></ul> <p><strong>数组长度小于 47 时为什么使用插入排序</strong>：随着数据量的减小，快速排序的递归行为产生的额外性能开销会逐渐盖过算法带来的性能优势，此时插入排序会比快速排序更快。</p> <p><strong>引用类型的排序为什么不使用快排</strong>：快速排序不是稳定的，而归并排序是稳定的。对于基本类型，稳定性没有意义，而对于引用类型，稳定性是比较重要的。</p> <p><strong>TimSort 算法</strong> 的特点在于它结合了 <strong>归并排序</strong> 和 <strong>插入排序</strong>，以便在处理实际数据时能够充分利用数据的 <strong>局部有序性</strong>。</p> <h2 id="java-集合"><a href="#java-集合" class="header-anchor">#</a> Java 集合</h2> <h3 id="fail-fast-和-fail-safe-策略"><a href="#fail-fast-和-fail-safe-策略" class="header-anchor">#</a> fail-fast 和 fail-safe 策略</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">快手本地生活</span></div><p><strong>fail-fast</strong>：直接在容器上进行遍历，在遍历过程中，一旦发现容器中的数据被修改了，会立刻抛出 ConcurrentModificationException 异常导致遍历失败。</p> <p>Iterator 接口中的 expectedModCount 记录了容器初始的 modCount（modCount 记录集合操作过程中作的修改次数），每次调用 next() 方法，在实际访问元素前，都会调用 checkForComodification 方法，当 modCount != expectedModCount 时，就会抛出该异常。</p> <p><strong>fail-safe</strong>：这种遍历基于容器的一个克隆。因此，对容器内容的修改不影响遍历。常见的的使用 fail-safe 方式遍历的容器有 ConcerrentHashMap 和 CopyOnWriteArrayList 等。</p> <h3 id="hashmap-的扩容机制"><a href="#hashmap-的扩容机制" class="header-anchor">#</a> HashMap 的扩容机制</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">美团</span></div><p><strong>何时扩容：</strong></p> <ul><li><strong>第一次放入元素时</strong>：实例化后，并不会立即初始化 table，而是在第一次放入元素时才初始化 table。</li> <li><strong>元素数量超过阈值时</strong>：阈值 = 容量（默认16）* 加载因子（默认0.75）。</li></ul> <p><strong>如何扩容：</strong></p> <div style="text-align:center;"><p><img src="/note-pages/assets/img/image-20230826191742899.drawio.2a5f40e5.png" alt="image-20230826191742899.drawio"></p></div><h2 id="java-并发"><a href="#java-并发" class="header-anchor">#</a> Java 并发</h2> <h3 id="写一个必定发生死锁的代码"><a href="#写一个必定发生死锁的代码" class="header-anchor">#</a> 写一个必定发生死锁的代码</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">快手</span></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLockDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> notified <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">B</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread-1 got a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>notified<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread-1 got b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread-2 got b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                notified <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread-2 got a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="synchronized-锁升级"><a href="#synchronized-锁升级" class="header-anchor">#</a> synchronized 锁升级</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">快手</span></div><p>synchronized 不断优化中，引入了偏向锁、轻量级锁、重量级锁的概念，在不同的情况逐步进行锁膨胀。过程如下图：</p> <p><a href="/note-pages/java-concurrency/shrk6c/#偏向锁"><strong>偏向锁</strong></a>：<strong>在 MarkWord 上加一个线程 ID 标记</strong> 的低消耗的方式，来标志对象正在被使用。</p> <ul><li><strong>加锁</strong>：如果锁对象是 <strong>匿名偏向状态</strong> 或 <strong>偏向锁指向的线程不存在</strong>，使用 CAS 尝试将线程 ID 赋值给对象的 MarkWord。如果偏向锁指向的线程存活，则将锁标志位设置为 <strong>00</strong>（轻量级锁态），进行锁升级。</li> <li><strong>锁重入</strong>：只需要判断锁对象的线程 ID 是否是当前线程即可。偏向锁的重入没有计数器，只要线程 ID 还是自己，就认为可重入，即认为可以进入临界区。</li> <li><strong>解锁</strong>：偏向锁没有实际意义上的解锁，离开 synchronized 代码块后，不会对偏向锁对象的 MarkWord 做修改，即偏向锁态的 MarkWord 中的线程 ID 仍然指向已经过时的线程。</li></ul> <p><a href="/note-pages/java-concurrency/shrk6c/#轻量级锁"><strong>轻量级锁</strong></a>：在当前线程的 <strong>栈帧</strong> 中创建一个 <strong>Lock Record</strong>，通过 CAS 尝试交换 Lock Record 的内容与锁对象的 MarkWord，从而进行锁的争抢。</p> <ul><li><strong>加锁</strong>：如果锁标志位为 <strong>001</strong>（无锁态），在当前线程的栈帧中创建一个 Lock Record，通过 CAS 尝试交换 Lock Record 的内容与对象的 MarkWord。如果锁标志位为 <strong>00</strong>（轻量级锁态），通过 MarkWord 的 ptr_to_lock_record 判断是否本线程持有锁，如果不是，升级为重量级锁。</li> <li><strong>锁重入</strong>：通过 MarkWord 的 ptr_to_lock_record 判断是否本线程持有锁，如果是，将在自己的栈帧中加一个 Lock Record，<strong>记录内容为空（null），锁对象的引用仍然指向锁对象。</strong></li> <li><strong>解锁</strong>：退出栈帧的时候，如果 <strong>Lock Record 的记录为 null</strong>，说明是重入锁，仅仅是弹出栈帧。如果 <strong>Lock Record 的记录有值</strong>，说明本次解锁是真正解锁，通过 CAS 尝试将 Lock Record 的内容与对象的 MarkWord 交换。删除线程栈中对应的 Lock Record。</li></ul> <p><a href="/note-pages/java-concurrency/shrk6c/#重量级锁"><strong>重量级锁</strong></a>：<strong>需要内核态的参与</strong>，JVM 向操作系统申请 <strong>ObjectMonitor</strong>，这是一个 C++ 对象，需要内核态才能访问。锁对象的 MarkWord 指向 ObjectMonitor 的地址。</p> <ul><li><strong>加锁</strong>：当线程 <strong>获取轻量级锁失败</strong> 或 <strong>遇到 wait() 或 notify() 方法</strong>，进入重量级锁升级状态。将锁标志位改为 <strong>10</strong> （重量级锁态）。线程自适应自旋，如果在最大自旋次数内争抢成功，使得 ObjectMonitor 的 owner 指向自己，则加锁成功。如果在最大自选次数内没有争抢成功，则进入 ObjectMonitor 的 EntryList 等待队列中等待，并进入 BLOCKED 状态。</li> <li><strong>锁重入</strong>：将 ObjectMonitor 的 recursion 重入次数加 1。</li> <li><strong>解锁</strong>：将 recursion 重入次数减 1。如果 recursion 为 0，表示本次是真正的解锁，将 owner 置空，并唤醒 EntryList 中的线程。</li></ul> <h3 id="volatile-的功能和实现原理"><a href="#volatile-的功能和实现原理" class="header-anchor">#</a> volatile 的功能和实现原理</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">美团到店</span><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">百度</span></div><p><strong>保证</strong> <a href="/note-pages/java-concurrency/vt6hbk/#_5-1-可见性"><strong>可见性</strong></a></p> <p>实现原理：volatile 修饰的共享变量进行写操作时会加上 lock 前缀指令。lock 前缀指令会引发两件事情：</p> <ul><li>将当前处理器缓存行的数据写回到系统内存。</li> <li>当前处理器的缓存回写到内存会导致其他处理器的缓存失效（<a href="/note-pages/java-concurrency/shrk6c/#缓存一致性协议"><strong>缓存一致性协议</strong></a>）。</li></ul> <p><strong>禁止</strong> <a href="/note-pages/java-concurrency/vt6hbk/#_5-2-重排序"><strong>重排序</strong></a></p> <p>实现原理：编译器在生成字节码时，会在指令序列中插入 <a href="/note-pages/java-concurrency/vt6hbk/#内存屏障"><strong>内存屏障</strong></a> 来禁止特定类型的处理器重排序。</p> <ul><li>在每个 volatile 写操作的前面插入一个 StoreStore 屏障，后面插入一个 StoreLoad 屏障。</li> <li>在每个 volatile 读操作的后面插入一个 LoadLoad 屏障和一个 LoadStore 屏障。</li></ul> <h3 id="volatile-和-synchronized-区别"><a href="#volatile-和-synchronized-区别" class="header-anchor">#</a> volatile 和 synchronized 区别</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">百度</span></div><ul><li><strong>volatile 和 synchronized 都能保证可见性，但实现原理不同</strong>。volatile 通过 <a href="/note-pages/java-concurrency/shrk6c/#缓存一致性协议"><strong>缓存一致性协议</strong></a> 实现；synchronized 通过 “释放锁之前将数据写回主存、获取锁之后从主存读取数据” 实现。</li> <li><strong>volatile 禁止重排序</strong>，synchronized 不禁止重排序。volatile 通过 <a href="/note-pages/java-concurrency/shrk6c/#内存屏障"><strong>内存屏障</strong></a> 实现禁止重排序。</li> <li>volatile 不保证原子性， <strong>synchronized 保证原子性</strong>。同一时间只有一个线程执行临界区代码，因此 synchronized 天然就具有原子性。</li> <li>volatile 只能修饰变量；synchronized 可以修饰变量、方法和类（实际上是对象锁）。</li></ul> <h3 id="什么是-aqs"><a href="#什么是-aqs" class="header-anchor">#</a> 什么是 AQS</h3> <p>AQS 是 AbstractQueuedSynchronizer 的简称，即抽象队列同步器。</p> <p>AQS 维护一个 <strong>volatile int state（代表共享资源）</strong> 和一个 <strong>FIFO 线程等待队列（多线程争用资源被阻塞时会进入此队列）</strong> 。</p> <p>自定义同步器在实现时只需要重写 tryAcquire() / tryAcquireShared() 和 tryRelease() / tryReleaseShared() 实现共享资源 state 的获取与释放方式即可，至于具体线程等待队列的维护（如获取资源失败入队/唤醒出队等），AQS 已经在顶层实现好了。状态信息 state 可以通过 protected 类型的 getState()、setState() 和 compareAndSetState() 进行操作。</p> <h3 id="公平锁与非公平锁的区别"><a href="#公平锁与非公平锁的区别" class="header-anchor">#</a> 公平锁与非公平锁的区别</h3> <p>在使用 ReentrantLock#lock() 方法加锁时，如果是公平锁，会先检查 AQS 队列中是否存在线程在排队，如果有线程在排队，则当前线程加入等待队列，如果是非公平锁，则不会去检查是否有线程在排队，而是直接 CAS 竞争锁。</p> <p>无论是公平锁还是非公平锁，没有竞争到锁都会进行排队。锁释放时，都是唤醒排在最前面的线程，因此非公平锁只是体现在了线程加锁阶段，而没有体现在线程被唤醒阶段。</p> <h3 id="concurrenthashmap-的-put-方法"><a href="#concurrenthashmap-的-put-方法" class="header-anchor">#</a> ConcurrentHashMap 的 put 方法</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">快手</span></div><p>ConcurrentHashMap#put 方法大致可以分为以下步骤：</p> <p><img src="/note-pages/assets/img/image-20230914121647715.drawio.aad446e6.png" alt="image-20230914121647715.drawio"></p> <h3 id="线程池的工作原理"><a href="#线程池的工作原理" class="header-anchor">#</a> 线程池的工作原理</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里飞猪</span></div><ul><li>线程池中线程数量 <strong>小于 corePoolSize</strong> 时，则创建线程，并处理任务。</li> <li>线程池中线程数量 <strong>大于等于 corePoolSize</strong> 时，则把任务 <strong>放入 workQueue</strong> 中，随着线程池中的核心线程不断执行任务，只要线程池中有空闲的核心线程，线程池就从 workQueue 中取任务并处理。</li> <li>当 <strong>workQueue 已存满</strong>，放不下新任务时，则 <strong>新建非核心线程入池</strong>，并处理任务，直到线程数目达到 maximumPoolSize。</li> <li>如果线程池中线程数 <strong>大于 maximumPoolSize</strong>，则使用 <a href="/note-pages/java-concurrency/g56kek/#拒绝策略"><strong>拒绝策略</strong></a> 进行拒绝处理。</li></ul> <h3 id="如何合理设置线程池的核心线程数"><a href="#如何合理设置线程池的核心线程数" class="header-anchor">#</a> 如何合理设置线程池的核心线程数</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">京东保险</span></div><div id="cpu-密集型任务" class="anchor">CPU 密集型任务</div><p>对于 CPU 密集型的计算场景，如果设置过多的线程数，会造成不必要的上下文切换。</p> <p>理论上线程的数量 = CPU 核数就是最合适的，不过通常把线程的数量设置为 <strong>CPU 核数 +1</strong>，会实现最优的利用率。即使当密集型的线程由于偶尔的内存页失效或其他原因导致阻塞时，这个额外的线程也能确保 CPU 的时钟周期不会被浪费，从而保证 CPU 的利用率。</p> <div id="io-密集型任务" class="anchor">IO 密集型任务</div><p>对于 IO 密集型计算场景，当一部分线程正在等待 IO 的时候，它们此时并不需要 CPU 来计算，那么另外的线程便可以利用 CPU 去执行其他的任务。</p> <p>最佳的线程数是与程序中 CPU 计算和 IO 操作的耗时比相关的，《Java 并发编程实战》的作者 Brain Goetz 推荐的计算方法如下：</p> <p><strong>线程数 = CPU 核心数 * (1 + IO 耗时 / CPU 耗时)</strong></p> <p>通过这个公式，我们可以计算出一个合理的线程数量，如果任务的平均等待时间长，线程数就随之增加，而如果平均工作时间长，即 CPU 密集型任务，线程数就随之减少。</p> <h2 id="jvm"><a href="#jvm" class="header-anchor">#</a> JVM</h2> <h3 id="类的加载过程"><a href="#类的加载过程" class="header-anchor">#</a> 类的加载过程</h3> <p>JVM 加载 Class 文件主要三步：<strong>加载 → 连接 → 初始化</strong>。</p> <div id="加载" class="anchor">加载</div><p>在加载阶段，虚拟机需要完成以下三件事情：</p> <ul><li>通过一个 <strong>类的全限定名</strong> 来获取其定义的 <strong>二进制字节流</strong>。</li> <li>将这个字节流所代表的 <strong>静态存储结构</strong> 转化为 <strong>方法区</strong> 的 <strong>运行时数据结构</strong>。</li> <li>在 Java <strong>堆</strong> 中生成一个代表这个类的 <strong>java.lang.Class 对象</strong>，作为对方法区中这些数据的访问入口。</li></ul> <div id="连接" class="anchor">连接</div><p>连接过程又可分为三步：<strong>验证 → 准备 → 解析</strong>。</p> <ul><li>验证：确保被加载的类的 <strong>正确性</strong>。</li> <li>准备：为类的 <strong>静态变量</strong> 分配内存，并将其初始化为 <strong>默认值</strong>。</li> <li>解析：把类中的符号引用转换为 <strong>直接引用</strong>。</li></ul> <div id="初始化" class="anchor">初始化</div><p>初始化是为类的静态变量赋予正确的初始值。</p> <h3 id="双亲委派机制"><a href="#双亲委派机制" class="header-anchor">#</a> 双亲委派机制</h3> <p>如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把请求委托给父加载器去完成，依次向上，所有的类加载请求最终都应该被传递到顶层的启动类加载器中，只有当父加载器在它的搜索范围中没有找到所需的类时，即无法加载时，子加载器才会尝试自己去加载该类。</p> <h3 id="jvm-内存结构"><a href="#jvm-内存结构" class="header-anchor">#</a> JVM 内存结构</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里</span></div><p>JVM 定义了若干种程序运行时数据区，其中有一些会随着虚拟机启动而创建，随着虚拟机退出而销毁。另外一些则是与线程一一对应的，这些与线程一一对应的数据区域会随着线程开始和结束而创建和销毁。</p> <ul><li>线程私有：<a href="/note-pages/jvm/b0ouv4/#_3-1-程序计数器"><strong>程序计数器</strong></a>、<a href="/note-pages/jvm/b0ouv4/#_3-2-虚拟机栈"><strong>虚拟机栈</strong></a>、<a href="/note-pages/jvm/b0ouv4/#_3-3-本地方法栈"><strong>本地方法栈</strong></a></li> <li>线程共享：<a href="/note-pages/jvm/b0ouv4/#_3-4-堆"><strong>堆</strong></a>、<a href="/note-pages/jvm/b0ouv4/#_3-5-方法区"><strong>方法区</strong></a>、堆外内存</li></ul> <h3 id="如何判断对象是否可被回收"><a href="#如何判断对象是否可被回收" class="header-anchor">#</a> 如何判断对象是否可被回收</h3> <p><a href="/note-pages/jvm/184c59/#引用计数算法"><strong>引用计数算法</strong></a>：给对象添加一个引用计数器，每当有一个其他对象引用它时，计数器加 1；引用失效时，计数器减 1。引用计数为 0 的对象可被回收。</p> <p><a href="/note-pages/jvm/184c59/#可达性分析算法"><strong>可达性分析算法</strong></a>：通过 <a href="/note-pages/jvm/184c59/#gc-roots"><strong>GC Roots</strong></a> 作为起始点进行搜索，能够到达到的对象都是存活的，不可达的对象可被回收。</p> <h3 id="垃圾回收算法"><a href="#垃圾回收算法" class="header-anchor">#</a> 垃圾回收算法</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">阿里</span></div><p><strong>标记-清除</strong>：将存活的对象进行标记，然后清理掉未被标记的对象。</p> <p><strong>标记-整理</strong>：将存活的对象进行标记，将存活的对象向一端移动，然后直接清理掉端边界以外的内存。</p> <p><strong>标记-复制</strong>：将内存划分为大小相等的两块，每次只使用其中一块，当这一块内存用完就将还存活的对象复制到另一块上面，然后再把使用过的内存空间进行一次清理。</p> <h3 id="新生代对象何时进入老年代"><a href="#新生代对象何时进入老年代" class="header-anchor">#</a> 新生代对象何时进入老年代</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">美团到店</span></div><p><strong>大对象直接进入老年代</strong>：如果大对象直接在新生代分配就会导致 Eden 区和两个 Survivor 区之间发生大量的内存复制。因此对于大对象都会直接在老年代进行分配。</p> <p><strong>长期存活的对象进入老年代</strong>：对象在 Eden 出生并经过 Minor GC 依然存活，将移动到 Survivor 中，年龄就增加 1 岁，增加到一定年龄（默认情况下，阈值为15）则移动到老年代中。</p> <p><strong>动态对象年龄判定</strong>：如果在当前的 Survivor 区中，一批对象的总大小超过了该 Survivor 区内存大小的 50%，此时大于等于这批对象年龄的对象可以直接晋升到老年代。</p> <h3 id="什么情况下会触发-full-gc"><a href="#什么情况下会触发-full-gc" class="header-anchor">#</a> 什么情况下会触发 Full GC</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">快手</span></div><ul><li><strong>老年代空间不足</strong>：常见场景比如大对象直接进入老年代、长期存活的对象进入老年代。</li> <li><strong>永久代空间不足（JDK 1.7 及以前）</strong>：当要加载的类、反射的类和调用的方法较多时，永久代可能会被占满，在未配置为采用 CMS GC 的情况下也会执行 Full GC。</li> <li><strong>空间分配担保失败</strong>：每次晋升的对象的平均大小大于老年代剩余空间或 Minor GC 后存活的对象超过了老年代剩余空间。</li> <li><strong>调用 System.gc()</strong>：只是建议虚拟机执行 Full GC，但是虚拟机不一定真正去执行。</li> <li><strong>堆伸缩</strong>：未指定老年代和新生代大小，堆伸缩时会产生 Full GC。</li></ul> <h3 id="oom-场景及解决方案"><a href="#oom-场景及解决方案" class="header-anchor">#</a> OOM 场景及解决方案</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">美团到店</span></div><p><strong>场景1</strong>：<a href="/note-pages/jvm/gsfjls/#线程溢出-unable-to-create-new-native-thread"><strong>线程溢出 - unable to create new native thread</strong></a>：操作系统对于一个进程所能创建的本地线程数有限制。当尝试创建新的本地线程时，如果已经达到了系统的线程数限制，就会出现 <code>java.lang.OutOfMemoryError: unable to create new native thread</code>  错误。这通常发生在运行线程密集型应用程序或者系统资源有限的情况下。</p> <p>解决方案：</p> <ul><li>降低程序中创建线程的数量，分析应用是否真的需要创建这么多线程。</li> <li>如果确实需要创建很多线程，则调高操作系统层面的线程最大数：执行 <code>ulimia-a</code> 查看最大线程数限制，使用 <code>ulimit-u xxx</code> 调整最大线程数限制。</li></ul> <p><strong>场景2</strong>：<a href="/note-pages/jvm/gsfjls/#堆内存溢出-java-heap-space"><strong>堆内存溢出 - Java heap space</strong></a>：当堆内存没有足够空间存放新创建的对象时，就会抛出 <code>java.lang.OutOfMemoryError: Java heap space</code> 错误。</p> <p>解决方案：</p> <ul><li>针对大部分情况，通常只需要通过 -Xmx 参数调高 JVM 堆内存空间即可。</li> <li>如果是超大对象，可以检查其合理性，比如是否一次性查询了数据库全部结果，而没有做结果数限制。</li> <li>如果是业务峰值压力，可以考虑添加机器资源，或者做限流降级。</li> <li>如果是内存泄漏，需要找到持有的对象，修改代码设计，比如关闭没有释放的连接。</li></ul> <p><strong>场景3</strong>：<a href="/note-pages/jvm/gsfjls/#垃圾回收上头-gc-overhead-limit-exceeded"><strong>垃圾回收上头 - GC overhead limit exceeded</strong></a>：当 Java 进程花费 98% 以上的时间执行 GC，但只恢复了不到 2% 的内存，且该动作连续重复了 5 次，就会抛出 <code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code> 异常。</p> <p>解决方案：此类问题的原因与解决方案跟 <code>Java heap space</code> 非常类似。</p> <ul><li>添加 JVM 参数 <code>-XX:-UseGCOverheadLimit</code>。不推荐这么干，没有真正解决问题，只是将异常推迟。</li> <li>检查项目中是否有大量的死循环或有使用大内存的代码，优化代码。</li> <li>dump 内存分析，检查是否存在内存泄露，如果没有，加大内存。</li></ul> <p><strong>场景4</strong>：<a href="/note-pages/jvm/gsfjls/#数组大小超限-requested-array-size-exceeds-vm-limit"><strong>数组大小超限 - Requested array size exceeds VM limit</strong></a>：Java 虚拟机为每个数组分配一块连续的内存空间，以便存储数组的元素。如果请求的数组大小超过了虚拟机的限制，就会抛出 <code>java.lang.OutOfMemoryError: Requested array size exceeds VM limit</code> 错误。</p> <p>解决方案：</p> <ul><li>检查代码，确认业务是否需要创建如此大的数组，是否可以拆分为多个块，分批执行。</li></ul> <p><strong>场景5</strong>：<a href="/note-pages/jvm/gsfjls/#元空间溢出-metaspace"><strong>元空间溢出 - Metaspace</strong></a>：当元空间无法满足新的类加载请求或元数据的动态增长时，就会抛出 <code>java.lang.OutOfMemoryError: Metaspace</code> 异常。</p> <p>解决方案：</p> <ul><li>增加 Metaspace 的初始大小和最大大小，使用 JVM 参数 <code>-XX:MetaspaceSize</code> 设置初始大小，使用 <code>-XX:MaxMetaspaceSize</code> 设置最大大小。</li> <li>优化类加载行为，避免加载不必要的类，采用延迟加载或按需加载的策略。</li> <li>减少动态类生成操作，避免过度使用反射和动态代理，尽量使用静态类或编译时生成的类。</li> <li>如果必须动态生成大量类，限制生成的类的数量或使用对象池来重用动态生成的类。</li> <li>使用内存分析工具检查内存使用情况，修复内存泄漏问题，确保无用的类和类加载器能够正确释放。</li></ul> <p><strong>场景6</strong>：<a href="/note-pages/jvm/gsfjls/#直接缓冲区溢出-direct-buffer-memory"><strong>直接缓冲区溢出 - Direct buffer memory</strong></a>：如果不断分配本地内存，堆内存很少使用，那么 JVM 就不需要执行 GC，DirectByteBuffer 对象就不会被回收，这时虽然堆内存充足，但本地内存可能已经不够用了，就会出现 OOM，本地直接内存溢出。</p> <p>解决方案：</p> <ul><li>通过增加 <code>-XX:MaxDirectMemorySize</code> JVM 参数来调整 Direct Buffer Memory 的限制。</li> <li>合理使用直接字节缓冲区、及时释放无用的缓冲区对象。</li></ul> <p><strong>场景7</strong>：<a href="/note-pages/jvm/gsfjls/#虚拟内存耗尽-out-of-swap-space"><strong>虚拟内存耗尽 - Out of swap space</strong></a>：该错误表示所有可用的 <strong>虚拟内存已被耗尽</strong>。虚拟内存由物理内存和交换空间两部分组成。当运行时程序请求的虚拟内存溢出时就会抛出 <code>java.lang.OutOfMemoryError: Outof swap space</code> 错误。</p> <p>解决方案：</p> <ul><li>增加交换空间：调整操作系统的交换空间设置，提供更多的虚拟内存供应用程序使用。</li> <li>优化内存使用：检查应用程序的内存使用情况，找出内存泄漏或过度消耗内存的部分，并进行优化，以降低内存消耗。</li></ul> <p><strong>场景8</strong>：<a href="/note-pages/jvm/gsfjls/#oom-killer-被激活-kill-process-or-sacrifice-child"><strong>OOM Killer 被激活 - Kill process or sacrifice child</strong></a>：Linux 内核允许进程申请的内存总量大于系统可用内存，通过 “错峰复用” 的方式更有效的利用系统资源。然而，这种方式会带来一定的 “超卖” 风险。例如某些进程持续占用系统内存，导致其他进程没有可用内存。此时，系统将自动激活 OOM Killer，寻找评分低的进程，并将其 “杀死”，释放内存资源。</p> <p>解决方案：</p> <ul><li>升级服务器配置或隔离部署，避免争用。</li> <li>OOM Killer 调优。</li></ul> <h3 id="线上-cpu-飙升-100-问题排查"><a href="#线上-cpu-飙升-100-问题排查" class="header-anchor">#</a> 线上 CPU 飙升 100% 问题排查</h3> <div class="tag-group"><span class="el-tag el-tag--primary el-tag--medium el-tag--plain">百度</span></div><p><strong>问题复现</strong></p> <p>线上系统突然运行缓慢，CPU 飙升，甚至到 100%，以及 Full GC 次数过多。</p> <p><strong>问题排查</strong></p> <ul><li>使用 <code>top</code> 命令查看系统中各个 <strong>进程</strong> 的资源（主要看 CPU 使用率）占用状况。</li> <li>使用 <code>top -Hp 进程ID</code> 命令查看 Java 进程下的各个 <strong>线程</strong> 的资源（主要看 CPU 使用率）占用状况。</li> <li>使用 <code>printf &quot;%x\n&quot; 线程ID</code> 命令将线程号转换为十六进制格式，以在后续查找线程堆栈信息时使用。</li> <li>使用 <code>jstack 进程ID</code>  命令查看 JVM 当前时刻的 <strong>线程快照</strong>，可以通过线程 ID（十六进制格式）来定位线程：<code>jstack 进程ID | grep 线程ID</code>。</li> <li>使用 <code>jstat -gcutil 进程ID 统计间隔毫秒 统计次数</code> 命令来查看 Java 进程的 <strong>GC（垃圾回收）情况</strong>。特别关注 FGC（Full GC）次数和增长情况，如果频繁进行 Full GC 可能意味着内存溢出或性能问题。</li> <li>使用 <code>jmap -dump:format=b,file=filename 进程ID</code> 命令将 Java 进程的堆内存导出到文件中，然后可以使用 Eclipse 的 MAT（Memory Analyzer Tool）工具来分析导出的堆转储文件。</li></ul> <p><strong>原因分析</strong></p> <p><strong>原因1</strong>：内存消耗过大，导致 Full GC 次数过多。</p> <ul><li>多个线程的 CPU 都超过了 100%，通过 jstack 命令可以看到这些线程主要是垃圾回收线程。</li> <li>通过 jstat 命令监控 GC 情况，可以看到 Full GC 次数非常多，并且次数在不断增加。</li></ul> <p>确定是 Full GC，接下来找到具体原因：</p> <ul><li>生成大量的对象，导致内存溢出 → 执行步骤 6，查看具体内存对象占用情况。</li> <li>内存占用不高，但是 Full GC 次数还是比较多 → 此时可能是代码中手动调用 <code>System.gc()</code> 导致 GC 次数过多，这可以通过添加 <code>-XX:+DisableExplicitGC</code> 来禁用 JVM 对显式 GC 的响应。</li></ul> <p><strong>原因2</strong>：代码中有大量消耗 CPU 的操作，导致 CPU 过高，系统运行缓慢。</p> <ul><li>jstack 可直接定位到代码行。例如某些复杂算法，甚至 BUG、无限循环递归等等。</li></ul> <p><strong>原因3</strong>：由于锁使用不当，导致死锁。</p> <ul><li>如果有死锁，线程快照会直接提示 deadlock。jstack 会打印出业务死锁的位置。</li></ul> <p><strong>原因4</strong>：某个线程由于某种原因而一直停留在 WAITING 状态。</p> <ul><li>jstack 多查询几次，每次间隔 30 秒，对比一直停留在 parking 导致的 WAITING 状态的线程。例如 CountDownLatch 倒计时器，使得相关线程等待 → AQS → LockSupport.park()。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-pages/interview/f05h67/" class="prev">
        基础
      </a></span> <span class="next"><a href="/note-pages/interview/数据库.html">
        数据库
      </a>
      →
    </span></p></div> </main> <aside items="[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]" class="right-sidebar"><div style="margin-left:20px; margin-bottom: 10px; text-align: center; font-size:16px;font-weight:bold;">此页内容</div> <div class="right-sidebar-wrap"><ul class="right-sidebar-links"><li id="tab-item0" class="right-sidebar-item active"><a href="#基础" class="right-sidebar-item-level2">
          基础
        </a></li><li id="tab-item1" class="right-sidebar-item"><a href="#string、stringbuffer、stringbuilder-的区别" class="right-sidebar-item-level3">
          String、StringBuffer、StringBuilder 的区别
        </a></li><li id="tab-item2" class="right-sidebar-item"><a href="#接口与抽象类的区别" class="right-sidebar-item-level3">
          接口与抽象类的区别
        </a></li><li id="tab-item3" class="right-sidebar-item"><a href="#如何通过反射获取-class-对象" class="right-sidebar-item-level3">
          如何通过反射获取 Class 对象
        </a></li><li id="tab-item4" class="right-sidebar-item"><a href="#jdk-动态代理与-cglib-动态代理的区别" class="right-sidebar-item-level3">
          JDK 动态代理与 CGLib 动态代理的区别
        </a></li><li id="tab-item5" class="right-sidebar-item"><a href="#arrays-sort-方法里的排序算法" class="right-sidebar-item-level3">
          Arrays.sort 方法里的排序算法
        </a></li><li id="tab-item6" class="right-sidebar-item"><a href="#java-集合" class="right-sidebar-item-level2">
          Java 集合
        </a></li><li id="tab-item7" class="right-sidebar-item"><a href="#fail-fast-和-fail-safe-策略" class="right-sidebar-item-level3">
          fail-fast 和 fail-safe 策略
        </a></li><li id="tab-item8" class="right-sidebar-item"><a href="#hashmap-的扩容机制" class="right-sidebar-item-level3">
          HashMap 的扩容机制
        </a></li><li id="tab-item9" class="right-sidebar-item"><a href="#java-并发" class="right-sidebar-item-level2">
          Java 并发
        </a></li><li id="tab-item10" class="right-sidebar-item"><a href="#写一个必定发生死锁的代码" class="right-sidebar-item-level3">
          写一个必定发生死锁的代码
        </a></li><li id="tab-item11" class="right-sidebar-item"><a href="#synchronized-锁升级" class="right-sidebar-item-level3">
          synchronized 锁升级
        </a></li><li id="tab-item12" class="right-sidebar-item"><a href="#volatile-的功能和实现原理" class="right-sidebar-item-level3">
          volatile 的功能和实现原理
        </a></li><li id="tab-item13" class="right-sidebar-item"><a href="#volatile-和-synchronized-区别" class="right-sidebar-item-level3">
          volatile 和 synchronized 区别
        </a></li><li id="tab-item14" class="right-sidebar-item"><a href="#什么是-aqs" class="right-sidebar-item-level3">
          什么是 AQS
        </a></li><li id="tab-item15" class="right-sidebar-item"><a href="#公平锁与非公平锁的区别" class="right-sidebar-item-level3">
          公平锁与非公平锁的区别
        </a></li><li id="tab-item16" class="right-sidebar-item"><a href="#concurrenthashmap-的-put-方法" class="right-sidebar-item-level3">
          ConcurrentHashMap 的 put 方法
        </a></li><li id="tab-item17" class="right-sidebar-item"><a href="#线程池的工作原理" class="right-sidebar-item-level3">
          线程池的工作原理
        </a></li><li id="tab-item18" class="right-sidebar-item"><a href="#如何合理设置线程池的核心线程数" class="right-sidebar-item-level3">
          如何合理设置线程池的核心线程数
        </a></li><li id="tab-item19" class="right-sidebar-item"><a href="#jvm" class="right-sidebar-item-level2">
          JVM
        </a></li><li id="tab-item20" class="right-sidebar-item"><a href="#类的加载过程" class="right-sidebar-item-level3">
          类的加载过程
        </a></li><li id="tab-item21" class="right-sidebar-item"><a href="#双亲委派机制" class="right-sidebar-item-level3">
          双亲委派机制
        </a></li><li id="tab-item22" class="right-sidebar-item"><a href="#jvm-内存结构" class="right-sidebar-item-level3">
          JVM 内存结构
        </a></li><li id="tab-item23" class="right-sidebar-item"><a href="#如何判断对象是否可被回收" class="right-sidebar-item-level3">
          如何判断对象是否可被回收
        </a></li><li id="tab-item24" class="right-sidebar-item"><a href="#垃圾回收算法" class="right-sidebar-item-level3">
          垃圾回收算法
        </a></li><li id="tab-item25" class="right-sidebar-item"><a href="#新生代对象何时进入老年代" class="right-sidebar-item-level3">
          新生代对象何时进入老年代
        </a></li><li id="tab-item26" class="right-sidebar-item"><a href="#什么情况下会触发-full-gc" class="right-sidebar-item-level3">
          什么情况下会触发 Full GC
        </a></li><li id="tab-item27" class="right-sidebar-item"><a href="#oom-场景及解决方案" class="right-sidebar-item-level3">
          OOM 场景及解决方案
        </a></li><li id="tab-item28" class="right-sidebar-item"><a href="#线上-cpu-飙升-100-问题排查" class="right-sidebar-item-level3">
          线上 CPU 飙升 100% 问题排查
        </a></li></ul></div></aside></div><div class="global-ui"></div></div>
    <script src="/note-pages/assets/js/app.05dcbd87.js" defer></script><script src="/note-pages/assets/js/3.4a2f67fd.js" defer></script><script src="/note-pages/assets/js/2.ab82720e.js" defer></script><script src="/note-pages/assets/js/66.dd49594c.js" defer></script>
  </body>
</html>
