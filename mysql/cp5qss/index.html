<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第5章 日志 | 后端技术栈笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/jquery/3.4.0/jquery.min.js"></script>
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" href="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">
    <meta name="description" content="BackEnd Notes">
    
    <link rel="preload" href="/note-pages/assets/css/0.styles.167a34c7.css" as="style"><link rel="preload" href="/note-pages/assets/js/app.05dcbd87.js" as="script"><link rel="preload" href="/note-pages/assets/js/3.4a2f67fd.js" as="script"><link rel="preload" href="/note-pages/assets/js/2.ab82720e.js" as="script"><link rel="preload" href="/note-pages/assets/js/56.75828a09.js" as="script"><link rel="prefetch" href="/note-pages/assets/js/10.e11a80d9.js"><link rel="prefetch" href="/note-pages/assets/js/100.489cf69a.js"><link rel="prefetch" href="/note-pages/assets/js/101.560e37ea.js"><link rel="prefetch" href="/note-pages/assets/js/102.baaa4f6a.js"><link rel="prefetch" href="/note-pages/assets/js/103.262b6423.js"><link rel="prefetch" href="/note-pages/assets/js/104.ac33d7ce.js"><link rel="prefetch" href="/note-pages/assets/js/105.5e6ce18f.js"><link rel="prefetch" href="/note-pages/assets/js/106.a69322ef.js"><link rel="prefetch" href="/note-pages/assets/js/107.6cdb78ee.js"><link rel="prefetch" href="/note-pages/assets/js/108.1d720289.js"><link rel="prefetch" href="/note-pages/assets/js/109.58f7297c.js"><link rel="prefetch" href="/note-pages/assets/js/11.241a46da.js"><link rel="prefetch" href="/note-pages/assets/js/110.9cef761d.js"><link rel="prefetch" href="/note-pages/assets/js/111.c782138c.js"><link rel="prefetch" href="/note-pages/assets/js/112.40cb3b1a.js"><link rel="prefetch" href="/note-pages/assets/js/113.c367e40a.js"><link rel="prefetch" href="/note-pages/assets/js/114.a4a75db5.js"><link rel="prefetch" href="/note-pages/assets/js/115.a73cd469.js"><link rel="prefetch" href="/note-pages/assets/js/116.ad853155.js"><link rel="prefetch" href="/note-pages/assets/js/117.a82b2649.js"><link rel="prefetch" href="/note-pages/assets/js/118.8f896dd0.js"><link rel="prefetch" href="/note-pages/assets/js/119.374482b1.js"><link rel="prefetch" href="/note-pages/assets/js/12.ebe220d5.js"><link rel="prefetch" href="/note-pages/assets/js/120.89698284.js"><link rel="prefetch" href="/note-pages/assets/js/121.cbe50685.js"><link rel="prefetch" href="/note-pages/assets/js/122.7de2ac51.js"><link rel="prefetch" href="/note-pages/assets/js/123.a2d16009.js"><link rel="prefetch" href="/note-pages/assets/js/124.e1ba7cbe.js"><link rel="prefetch" href="/note-pages/assets/js/125.4e1e6d6a.js"><link rel="prefetch" href="/note-pages/assets/js/126.3db22af3.js"><link rel="prefetch" href="/note-pages/assets/js/127.937f4ffc.js"><link rel="prefetch" href="/note-pages/assets/js/128.0bad2e20.js"><link rel="prefetch" href="/note-pages/assets/js/129.75a99d25.js"><link rel="prefetch" href="/note-pages/assets/js/13.5ee7bef5.js"><link rel="prefetch" href="/note-pages/assets/js/130.599b6d3d.js"><link rel="prefetch" href="/note-pages/assets/js/131.687214bf.js"><link rel="prefetch" href="/note-pages/assets/js/132.8295c067.js"><link rel="prefetch" href="/note-pages/assets/js/133.854d61c0.js"><link rel="prefetch" href="/note-pages/assets/js/134.f3fc20e1.js"><link rel="prefetch" href="/note-pages/assets/js/135.2a5a690d.js"><link rel="prefetch" href="/note-pages/assets/js/136.6ba30378.js"><link rel="prefetch" href="/note-pages/assets/js/137.80d7c511.js"><link rel="prefetch" href="/note-pages/assets/js/138.0a25898e.js"><link rel="prefetch" href="/note-pages/assets/js/139.fb3c377f.js"><link rel="prefetch" href="/note-pages/assets/js/14.a561f8b3.js"><link rel="prefetch" href="/note-pages/assets/js/140.cbfdbe32.js"><link rel="prefetch" href="/note-pages/assets/js/141.c09f054f.js"><link rel="prefetch" href="/note-pages/assets/js/142.723bd973.js"><link rel="prefetch" href="/note-pages/assets/js/143.b31785f9.js"><link rel="prefetch" href="/note-pages/assets/js/144.69d3d121.js"><link rel="prefetch" href="/note-pages/assets/js/145.c4ee6aa0.js"><link rel="prefetch" href="/note-pages/assets/js/146.7f836a1c.js"><link rel="prefetch" href="/note-pages/assets/js/147.d4a57976.js"><link rel="prefetch" href="/note-pages/assets/js/148.b15e75eb.js"><link rel="prefetch" href="/note-pages/assets/js/149.94085ddc.js"><link rel="prefetch" href="/note-pages/assets/js/15.4ed118f1.js"><link rel="prefetch" href="/note-pages/assets/js/150.6751d41b.js"><link rel="prefetch" href="/note-pages/assets/js/151.bd60e322.js"><link rel="prefetch" href="/note-pages/assets/js/152.15caf78f.js"><link rel="prefetch" href="/note-pages/assets/js/153.131128fc.js"><link rel="prefetch" href="/note-pages/assets/js/154.b8ee2e7d.js"><link rel="prefetch" href="/note-pages/assets/js/155.8fa1e2e0.js"><link rel="prefetch" href="/note-pages/assets/js/156.25e2a796.js"><link rel="prefetch" href="/note-pages/assets/js/157.7137c9c3.js"><link rel="prefetch" href="/note-pages/assets/js/158.fdc18c40.js"><link rel="prefetch" href="/note-pages/assets/js/159.0dadb745.js"><link rel="prefetch" href="/note-pages/assets/js/16.818fc8bf.js"><link rel="prefetch" href="/note-pages/assets/js/160.05f7541c.js"><link rel="prefetch" href="/note-pages/assets/js/161.2a8c62a2.js"><link rel="prefetch" href="/note-pages/assets/js/162.5b9983b7.js"><link rel="prefetch" href="/note-pages/assets/js/163.b51a5538.js"><link rel="prefetch" href="/note-pages/assets/js/164.06c9f20a.js"><link rel="prefetch" href="/note-pages/assets/js/165.c25063f4.js"><link rel="prefetch" href="/note-pages/assets/js/166.6c570da5.js"><link rel="prefetch" href="/note-pages/assets/js/167.12fb6fb6.js"><link rel="prefetch" href="/note-pages/assets/js/168.d7dd27bc.js"><link rel="prefetch" href="/note-pages/assets/js/169.27f575fe.js"><link rel="prefetch" href="/note-pages/assets/js/17.9daf0c47.js"><link rel="prefetch" href="/note-pages/assets/js/170.ba4295ef.js"><link rel="prefetch" href="/note-pages/assets/js/171.3fb54078.js"><link rel="prefetch" href="/note-pages/assets/js/18.086ed162.js"><link rel="prefetch" href="/note-pages/assets/js/19.adca670c.js"><link rel="prefetch" href="/note-pages/assets/js/20.2e9ff004.js"><link rel="prefetch" href="/note-pages/assets/js/21.07830947.js"><link rel="prefetch" href="/note-pages/assets/js/22.609929cb.js"><link rel="prefetch" href="/note-pages/assets/js/23.d83b832f.js"><link rel="prefetch" href="/note-pages/assets/js/24.592e8014.js"><link rel="prefetch" href="/note-pages/assets/js/25.9d28bb6f.js"><link rel="prefetch" href="/note-pages/assets/js/26.fd4195d5.js"><link rel="prefetch" href="/note-pages/assets/js/27.ca60e875.js"><link rel="prefetch" href="/note-pages/assets/js/28.c2cd75e6.js"><link rel="prefetch" href="/note-pages/assets/js/29.4213d132.js"><link rel="prefetch" href="/note-pages/assets/js/30.c6ee0ead.js"><link rel="prefetch" href="/note-pages/assets/js/31.eea6a542.js"><link rel="prefetch" href="/note-pages/assets/js/32.1ffdceaf.js"><link rel="prefetch" href="/note-pages/assets/js/33.0425748b.js"><link rel="prefetch" href="/note-pages/assets/js/34.5dd0d81d.js"><link rel="prefetch" href="/note-pages/assets/js/35.773df14e.js"><link rel="prefetch" href="/note-pages/assets/js/36.5db32ea2.js"><link rel="prefetch" href="/note-pages/assets/js/37.1106162c.js"><link rel="prefetch" href="/note-pages/assets/js/38.793ba7d0.js"><link rel="prefetch" href="/note-pages/assets/js/39.488fb9a5.js"><link rel="prefetch" href="/note-pages/assets/js/4.550e6883.js"><link rel="prefetch" href="/note-pages/assets/js/40.9c05b0ae.js"><link rel="prefetch" href="/note-pages/assets/js/41.ae198526.js"><link rel="prefetch" href="/note-pages/assets/js/42.d815456e.js"><link rel="prefetch" href="/note-pages/assets/js/43.1808aff8.js"><link rel="prefetch" href="/note-pages/assets/js/44.c26d9bde.js"><link rel="prefetch" href="/note-pages/assets/js/45.fae5f755.js"><link rel="prefetch" href="/note-pages/assets/js/46.703057c9.js"><link rel="prefetch" href="/note-pages/assets/js/47.ed3a23ce.js"><link rel="prefetch" href="/note-pages/assets/js/48.c5a46ee8.js"><link rel="prefetch" href="/note-pages/assets/js/49.b04c1681.js"><link rel="prefetch" href="/note-pages/assets/js/5.869d288f.js"><link rel="prefetch" href="/note-pages/assets/js/50.249fc2a7.js"><link rel="prefetch" href="/note-pages/assets/js/51.cab74632.js"><link rel="prefetch" href="/note-pages/assets/js/52.e2f231b3.js"><link rel="prefetch" href="/note-pages/assets/js/53.6241e308.js"><link rel="prefetch" href="/note-pages/assets/js/54.7d29c5c0.js"><link rel="prefetch" href="/note-pages/assets/js/55.a9050f95.js"><link rel="prefetch" href="/note-pages/assets/js/57.b3f75d67.js"><link rel="prefetch" href="/note-pages/assets/js/58.0cf3bd1c.js"><link rel="prefetch" href="/note-pages/assets/js/59.19f18f1f.js"><link rel="prefetch" href="/note-pages/assets/js/6.d879438f.js"><link rel="prefetch" href="/note-pages/assets/js/60.61940d92.js"><link rel="prefetch" href="/note-pages/assets/js/61.bc890bb0.js"><link rel="prefetch" href="/note-pages/assets/js/62.f487437c.js"><link rel="prefetch" href="/note-pages/assets/js/63.4a91369b.js"><link rel="prefetch" href="/note-pages/assets/js/64.1b0770e4.js"><link rel="prefetch" href="/note-pages/assets/js/65.b56e2b22.js"><link rel="prefetch" href="/note-pages/assets/js/66.dd49594c.js"><link rel="prefetch" href="/note-pages/assets/js/67.22efede4.js"><link rel="prefetch" href="/note-pages/assets/js/68.0d22a8a4.js"><link rel="prefetch" href="/note-pages/assets/js/69.aec9bfeb.js"><link rel="prefetch" href="/note-pages/assets/js/7.e3626849.js"><link rel="prefetch" href="/note-pages/assets/js/70.0c53c20d.js"><link rel="prefetch" href="/note-pages/assets/js/71.6d6db7d6.js"><link rel="prefetch" href="/note-pages/assets/js/72.fdcfb985.js"><link rel="prefetch" href="/note-pages/assets/js/73.a390b48d.js"><link rel="prefetch" href="/note-pages/assets/js/74.e817987f.js"><link rel="prefetch" href="/note-pages/assets/js/75.f144cf4f.js"><link rel="prefetch" href="/note-pages/assets/js/76.7be2f5f1.js"><link rel="prefetch" href="/note-pages/assets/js/77.6568d596.js"><link rel="prefetch" href="/note-pages/assets/js/78.4ff63ca8.js"><link rel="prefetch" href="/note-pages/assets/js/79.daaf791e.js"><link rel="prefetch" href="/note-pages/assets/js/8.f9f716a1.js"><link rel="prefetch" href="/note-pages/assets/js/80.a0605696.js"><link rel="prefetch" href="/note-pages/assets/js/81.ecb125f5.js"><link rel="prefetch" href="/note-pages/assets/js/82.b64b1c42.js"><link rel="prefetch" href="/note-pages/assets/js/83.d13b7f19.js"><link rel="prefetch" href="/note-pages/assets/js/84.c584da75.js"><link rel="prefetch" href="/note-pages/assets/js/85.7992353f.js"><link rel="prefetch" href="/note-pages/assets/js/86.17ad6399.js"><link rel="prefetch" href="/note-pages/assets/js/87.289f9f2f.js"><link rel="prefetch" href="/note-pages/assets/js/88.3496d6e2.js"><link rel="prefetch" href="/note-pages/assets/js/89.0d0c778d.js"><link rel="prefetch" href="/note-pages/assets/js/9.3209071f.js"><link rel="prefetch" href="/note-pages/assets/js/90.245b9fda.js"><link rel="prefetch" href="/note-pages/assets/js/91.806af5f2.js"><link rel="prefetch" href="/note-pages/assets/js/92.8a10f401.js"><link rel="prefetch" href="/note-pages/assets/js/93.ea90ae18.js"><link rel="prefetch" href="/note-pages/assets/js/94.98cc66ef.js"><link rel="prefetch" href="/note-pages/assets/js/95.836e96c5.js"><link rel="prefetch" href="/note-pages/assets/js/96.d4dd3eee.js"><link rel="prefetch" href="/note-pages/assets/js/97.e4275cb9.js"><link rel="prefetch" href="/note-pages/assets/js/98.0e320d92.js"><link rel="prefetch" href="/note-pages/assets/js/99.e6f77650.js">
    <link rel="stylesheet" href="/note-pages/assets/css/0.styles.167a34c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-pages/" class="home-link router-link-active"><!----> <span class="site-name">后端技术栈笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note-pages/mysql/1dh29a/" class="sidebar-link">第1章 MySQL基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/mysql/1dh29a/#_1-1-存储引擎" class="sidebar-link">1.1 存储引擎</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/1dh29a/#_1-2-mysql-内部架构" class="sidebar-link">1.2 MySQL 内部架构</a></li></ul></li><li><a href="/note-pages/mysql/wfs82l/" class="sidebar-link">第2章 索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/mysql/wfs82l/#_2-1-索引的分类" class="sidebar-link">2.1 索引的分类</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/wfs82l/#_2-2-索引的实现" class="sidebar-link">2.2 索引的实现</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/wfs82l/#_2-3-索引失效的场景" class="sidebar-link">2.3 索引失效的场景</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/wfs82l/#_2-4-索引设计的原则" class="sidebar-link">2.4 索引设计的原则</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/wfs82l/#_2-5-性能调优" class="sidebar-link">2.5 性能调优</a></li></ul></li><li><a href="/note-pages/mysql/xz81ss/" class="sidebar-link">第3章 事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/mysql/xz81ss/#_7-1-事务" class="sidebar-link">7.1 事务</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/xz81ss/#_7-2-acid-特性" class="sidebar-link">7.2 ACID 特性</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/xz81ss/#_7-3-并发事务带来的问题" class="sidebar-link">7.3 并发事务带来的问题</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/xz81ss/#_7-4-事务隔离级别" class="sidebar-link">7.4 事务隔离级别</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/xz81ss/#_7-5-mvcc" class="sidebar-link">7.5 MVCC</a></li></ul></li><li><a href="/note-pages/mysql/yh4rjk/" class="sidebar-link">第4章 锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/mysql/yh4rjk/#_4-1-mysql-的锁有哪些" class="sidebar-link">4.1  MySQL 的锁有哪些</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/yh4rjk/#_4-2-mysql-如何加锁" class="sidebar-link">4.2 MySQL 如何加锁</a></li></ul></li><li><a href="/note-pages/mysql/cp5qss/" aria-current="page" class="active sidebar-link">第5章 日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/mysql/cp5qss/#_5-1-binlog" class="sidebar-link">5.1 binlog</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/cp5qss/#_5-2-redo-log" class="sidebar-link">5.2 redo log</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/cp5qss/#_5-3-undo-log" class="sidebar-link">5.3 undo log</a></li></ul></li><li><a href="/note-pages/mysql/06-缓存.html" class="sidebar-link">第6章 缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/mysql/06-缓存.html#_6-1-什么是-buffer-pool" class="sidebar-link">6.1 什么是 Buffer Pool</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/06-缓存.html#_6-2-buffer-pool-的控制块" class="sidebar-link">6.2 Buffer Pool 的控制块</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/06-缓存.html#_6-3-buffer-pool-的管理" class="sidebar-link">6.3 Buffer Pool 的管理</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/06-缓存.html#_6-4-mysql-对-lru-算法的改进" class="sidebar-link">6.4 MySQL 对 LRU 算法的改进</a></li><li class="sidebar-sub-header"><a href="/note-pages/mysql/06-缓存.html#_6-5-脏页的刷盘时机" class="sidebar-link">6.5 脏页的刷盘时机</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第5章-日志"><a href="#第5章-日志" class="header-anchor">#</a> 第5章 日志</h1> <h2 id="_5-1-binlog"><a href="#_5-1-binlog" class="header-anchor">#</a> 5.1 binlog</h2> <p>binlog 记录了对 MySQL 数据库执行更改的所有的 <strong>写操作</strong>，包括所有对数据库的数据、表结构、索引等等变更的操作。</p> <blockquote><p>注意：这其中不包含 SELECT、SHOW 等，因为对数据没有修改</p></blockquote> <p>只要是对数据库有变更的操作都会记录到 binlog 里面来。</p> <p>binlog 的功能：</p> <ul><li><strong>主从复制</strong> ：在 Master 端开启 binlog ，然后将 binlog 发送到各个 Slave 端， Slave 端重放 binlog 来达到主从数据一致。</li> <li><strong>数据恢复</strong> ：通过使用 mysqlbinlog 工具来恢复数据。</li></ul> <h3 id="binlog-数据格式"><a href="#binlog-数据格式" class="header-anchor">#</a> binlog 数据格式</h3> <p>binlog 日志有三种格式，分别为 STATMENT 、 ROW 和 MIXED。</p> <blockquote><p>在 MySQL 5.7.7 之前，默认的格式是 STATEMENT ， MySQL 5.7.7 之后，默认值是 ROW。日志格式通过 binlog-format 指定。</p></blockquote> <p><strong>ROW</strong>：基于行的复制，不记录每条 SQL 语句的上下文信息，仅需记录哪条数据被修改了。如果一个 update 语句修改一百行数据，那么这种模式下就会记录 100 行对应的记录日志。</p> <ul><li>优点：不会出现某些特定情况下的存储过程、或 function、或 trigger 的调用和触发无法被正确记录的问题；</li> <li>缺点：会产生大量的日志，尤其是 alter table 的时候会让日志暴涨。</li></ul> <p><strong>STATMENT</strong>：基于 SQL 语句的记录，每一条会修改数据的 SQL 语句会记录到 binlog 中 。相对于 ROW 模式，STATEMENT 模式下只会记录这个 update 的语句，因此非常节省日志空间，同时避免了大量的 IO 操作。</p> <ul><li>优点：不需要记录每一行的变化，减少了 binlog 日志量，节约了 IO , 从而提高了性能；</li> <li>缺点：在某些情况下会导致主从数据不一致，比如执行 sysdate() 、slepp() 等 。</li></ul> <p><strong>MIXED</strong>：基于 STATMENT 和 ROW 两种模式的混合复制，一般的记录使用 STATEMENT 模式保存 binlog ，对于一些函数、STATEMENT 模式无法记录的操作使用 ROW 模式保存 binlog。</p> <p>基于这三种模式需要注意的是：</p> <ul><li>使用 row 格式的 binlog 时，在进行数据同步或恢复的时候不一致的问题更容易被发现，因为它是基于数据行记录的。</li> <li>使用 mixed 或者 statement 格式的 binlog 时，很多事务操作都是基于 SQL 逻辑记录，一个 SQL 在不同的时间点执行它们产生的数据变化和影响是不一样的，因此数据同步或恢复的时候就容易出现不一致的情况。</li></ul> <h3 id="主从复制"><a href="#主从复制" class="header-anchor">#</a> 主从复制</h3> <p>主从复制具体详细过程如下：</p> <ul><li>主库在收到客户端提交事务的请求之后，会先写入 binlog，再提交事务，更新存储引擎中的数据，事务提交完成后，返回给客户端 “操作成功” 的响应。</li> <li>从库会创建一个专门的 I/O 线程，连接主库的 log dump 线程，来接收主库的 binlog 日志，再把 binlog 信息写入 <strong>relay log 中继日志</strong> 里，再返回给主库 “复制成功” 的响应。</li> <li>从库会创建一个用于回放 binlog 的线程，去读 relay log 中继日志，然后回放 binlog 更新存储引擎中的数据，最终实现主从的数据一致性。</li></ul> <h3 id="binlog-写入策略"><a href="#binlog-写入策略" class="header-anchor">#</a> binlog 写入策略</h3> <p>对于 InnoDB 存储引擎而言，在进行事务的过程中，首先会把 binlog 写入到 <strong>binlog cache</strong> 中（因为写入到 cache 中会比较快，一个事务通常会有多个操作，避免每个操作都直接写磁盘导致性能降低），只有在事务提交时才会记录 binlog ，此时记录还在内存中。</p> <p>MySQL 通过 <strong>sync_binlog</strong> 参数控制 biglog 的刷盘时机，取值范围是 0-N：</p> <ul><li><strong>0</strong>：每次提交事务 binlog 不会马上写入到磁盘，而是先写到 page cache。不去强制要求，由系统自行判断何时写入磁盘，在 MySql 崩溃的时候会有丢失日志的风险；</li> <li><strong>1</strong>：每次提交事务都会执行 fsync 将 binlog 写入到磁盘；</li> <li><strong>N</strong>：每次提交事务都先写到 page cache，只有等到积累了 N 个事务之后才 fsync 将 binlog 写入到磁盘，在 MySQL 崩溃的时候会有丢失 N 个事务日志的风险。</li></ul> <p>很显然三种模式下，sync_binlog = 1 是强一致的选择，选择 0 或者 N 的情况下在极端情况下就会有丢失日志的风险，具体选择什么模式还是得看系统对于一致性的要求。</p> <h2 id="_5-2-redo-log"><a href="#_5-2-redo-log" class="header-anchor">#</a> 5.2 redo log</h2> <p>redo log 是属于引擎层（innodb）的日志，称为 <strong>重做日志</strong> ，当 MySQL 服务器意外崩溃或宕机后，能够 <strong>保证已经提交的事务</strong> 持久化到磁盘中（<strong>持久性</strong>）。</p> <p>redo log 是 InnoDB 存储引擎中用于持久化记录事务提交的物理日志文件。它记录的是对 <strong>数据页</strong> 的物理修改操作，比如 <strong>对 XXX 表空间中的 YYY 数据页 ZZZ 偏移量的地方做了AAA 更新</strong>，每当执行一个事务就会产生这样的一条或者多条物理日志。</p> <p>redo log 的功能：</p> <ul><li><strong>实现事务的持久性，让 MySQL 有 crash-safe 的能力</strong>，能够保证 MySQL 在任何时间段突然崩溃，重启后之前已提交的记录都不会丢失；</li> <li><strong>将写操作从 “随机写” 变成了 “顺序写”</strong>，提升 MySQL 写入磁盘的性能。</li></ul> <h3 id="redo-log-数据格式"><a href="#redo-log-数据格式" class="header-anchor">#</a> redo log 数据格式</h3> <p>redo log 包括两部分：</p> <ul><li><strong>日志缓冲</strong>（redo log buffer）：内存层面，默认 16M，通过 innodb_log_buffer_size 参数指定。</li> <li><strong>日志文件</strong>（redo log file）：持久化的，磁盘层面。</li></ul> <p>MySQL 每执行一条 DML 语句，先将记录写入 redo log buffer，后续某个时间点再一次性将多个操作记录写到 redo log file。</p> <blockquote><p><strong>Write-Ahead Log</strong> （预先日志持久化）指的是 <strong>在持久化一个数据页之前，先将内存中相应的日志页持久化。</strong></p></blockquote> <p>在计算机操作系统中，用户空间（user space）下的缓冲区数据一般情况下是无法直接写入磁盘的，中间必须经过操作系统内核空间（kernel space）缓冲区（OS Buffer）。</p> <p>因此，redo log buffer 写入 redo log file 实际上是先写入 OS Buffer ，然后再通过系统调用 fsync() 将其刷到 redo log file 中。</p> <p><strong>修改数据的操作流程</strong>：</p> <ul><li>先将原始数据从磁盘中读入内存中来，修改数据的内存拷贝，产生脏数据；</li> <li>生成一条重做日志并写入 redo log buffer，记录的是数据被修改后的值；</li> <li>默认在事务提交后将 redo log buffer 的内容刷新到 redo log file，对 redo log file 采用追加写的方式；</li> <li>定期将内存中修改的数据刷新到磁盘中。</li></ul> <h3 id="wal-策略"><a href="#wal-策略" class="header-anchor">#</a> WAL 策略</h3> <p>当缓冲池中的某页数据被修改后，该页就被标记为 ”脏页“，脏页的数据会被定期刷新到磁盘上。</p> <p>倘若每次一个页发生变化，就将新页的版本刷新到磁盘，那么这个开销是非常大的。并且，如果热点数据都集中在某几个页中，那么数据库的性能将变得非常差。另外，如果在从缓冲池将页的新版本刷新到磁盘时发生了宕机，那么这个数据就不能恢复了。</p> <p>因此，为了避免发生数据丢失的问题，当前事务数据库系统普遍都采用了 <strong>WAL（Write-Ahead Log，预写日志）策略</strong>：即 <strong>当事务提交时，先写重做日志（redo log），再修改页（先修改缓冲池，再刷新到磁盘）；当由于发生宕机而导致数据丢失时，通过 redo log 来完成数据的恢复</strong>。</p> <p>有了 redo log，InnoDB 就可以保证即使数据库发生异常重启，之前提交的记录都不会丢失，这个能力称为 <strong>crash-safe</strong>。</p> <h3 id="redo-log-写入方式"><a href="#redo-log-写入方式" class="header-anchor">#</a> redo log 写入方式</h3> <p>每个 InnoDB 存储引擎至少有 1 个重做日志文件组（redo log group），每个文件组下至少有 2 个重做日志文件（redo log file），默认的话是一个 redo log group，其中包含 2 个 redo log file：<code>ib_logfile0</code> 和 <code>ib_logfile1</code> 。</p> <p>一般来说，为了得到更高的可靠性，用户可以设置多个镜像日志组（mirrored log groups），将不同的文件组放在不同的磁盘上，以此提高 redo log 的高可用性。在日志组中每个 redo log file 的大小一致，并以 <strong>循环写入</strong> 的方式运行。</p> <div style="text-align:center;"><img src="data:image/png;base64,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" alt="img" style="zoom:67%;"></div><p>InnoDB 存储引擎会先写 redo log file 0，当 file 0 被写满的时候，会切换至 redo log file 1，当 file 1 也被写满时，会切换到 redo log file 2 中，而当 file 2 也被写满时，会再切换到  file 0 中。</p> <h3 id="checkpoint-技术"><a href="#checkpoint-技术" class="header-anchor">#</a> Checkpoint 技术</h3> <p>CheckPoint 技术简单来说其实就是在 redo log file 中找到一个位置，将这个位置前的页都刷新到磁盘中去，这个位置就称为 CheckPoint（检查点）。</p> <div style="text-align:center;"><img src="/note-pages/assets/img/4fb7d59d20b816d7782f74b3a9fa728d.37368e0b.png" alt="img" style="zoom:67%;"></div><p>在 redo log 文件中，存在着一个重要的关系：<strong>write pos</strong>（写入位置）和 <strong>CheckPoint</strong>（检查点）之间形成了一片空间，这个空间可以被用来记录新的数据库操作。当写入位置（write pos）逐步追上检查点（CheckPoint）时，这意味着 redo log 文件已经接近充满状态。在这种情况下，数据库无法继续执行新的数据更新操作，而必须先暂停，擦除一些旧的 redo log 记录，为新的操作腾出足够的空间。同时，将检查点的位置推进到写入位置，以确保数据库在进行崩溃恢复时可以跳过已经成功写入持久性存储的 redo log 记录，从而加速数据的恢复过程。</p> <p>在 InnoDB 存储引擎内部，有两种 Checkpoint，分别为：</p> <ul><li><strong>Sharp Checkpoint</strong>：发生在数据库关闭时，将所有的脏页都刷新回磁盘。这是默认的工作方式，并且可以通过参数 <code>innodb_fast_shutdown</code> 来控制。</li> <li><strong>Fuzzy Checkpoint</strong>：InnoDB 存储引擎内部使用这种模式，只刷新一部分脏页，而不是刷新所有的脏页回磁盘。这有助于减少对数据库性能的影响，但也可能会导致在恢复时需要更多的重做操作。</li></ul> <h2 id="_5-3-undo-log"><a href="#_5-3-undo-log" class="header-anchor">#</a> 5.3 undo log</h2> <p>undo log 是一种用于撤销回退的日志。在事务没提交之前，MySQL 会先记录更新前的数据到 undo log 日志文件里面，当事务回滚时，可以利用 undo log 来进行回滚。</p> <p>undo log 的功能：</p> <ul><li><strong>实现事务回滚，保障事务的原子性</strong>。事务处理过程中，如果出现了错误或者用户执行了 ROLLBACK 语句，MySQL 可以利用 undo log 中的历史数据将数据恢复到事务开始之前的状态。</li> <li><strong>实现 MVCC（多版本并发控制）</strong>。MVCC 是通过 ReadView + undo log 实现的。undo log 为每条记录保存多份历史数据，MySQL 在执行快照读（普通 SELECT 语句）的时候，会根据事务的 Read View 里的信息，顺着 undo log 的版本链找到满足其可见性的记录。</li></ul> <h3 id="undo-log-数据格式"><a href="#undo-log-数据格式" class="header-anchor">#</a> undo log 数据格式</h3> <p>每当 InnoDB 引擎对一条记录进行操作（修改、删除、新增）时，要把回滚时需要的信息都记录到 undo log 里。</p> <p>在发生回滚时，就读取 undo log 里的数据，然后做原先相反操作。比如当 delete 一条记录时，undo log 中会把记录中的内容都记下来，然后执行回滚操作的时候，就读取 undo log 里的数据，然后进行 insert 操作。</p> <p>一条记录的每一次更新操作产生的 undo log 格式都有一个 roll_pointer 指针和一个 trx_id 事务id：</p> <ul><li>通过 trx_id 可以知道该记录是被哪个事务修改的；</li> <li>通过 roll_pointer 指针可以将这些 undo log 串成一个链表，这个链表就被称为版本链；</li></ul> <p><img src="/note-pages/assets/img/image-20230211134738454.a4e72493.png" alt="image-20230211134738454"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-pages/mysql/yh4rjk/" class="prev">
        第4章 锁
      </a></span> <span class="next"><a href="/note-pages/mysql/06-缓存.html">
        第6章 缓存
      </a>
      →
    </span></p></div> </main> <aside items="[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]" class="right-sidebar"><div style="margin-left:20px; margin-bottom: 10px; text-align: center; font-size:16px;font-weight:bold;">此页内容</div> <div class="right-sidebar-wrap"><ul class="right-sidebar-links"><li id="tab-item0" class="right-sidebar-item active"><a href="#_5-1-binlog" class="right-sidebar-item-level2">
          5.1 binlog
        </a></li><li id="tab-item1" class="right-sidebar-item"><a href="#binlog-数据格式" class="right-sidebar-item-level3">
          binlog 数据格式
        </a></li><li id="tab-item2" class="right-sidebar-item"><a href="#主从复制" class="right-sidebar-item-level3">
          主从复制
        </a></li><li id="tab-item3" class="right-sidebar-item"><a href="#binlog-写入策略" class="right-sidebar-item-level3">
          binlog 写入策略
        </a></li><li id="tab-item4" class="right-sidebar-item"><a href="#_5-2-redo-log" class="right-sidebar-item-level2">
          5.2 redo log
        </a></li><li id="tab-item5" class="right-sidebar-item"><a href="#redo-log-数据格式" class="right-sidebar-item-level3">
          redo log 数据格式
        </a></li><li id="tab-item6" class="right-sidebar-item"><a href="#wal-策略" class="right-sidebar-item-level3">
          WAL 策略
        </a></li><li id="tab-item7" class="right-sidebar-item"><a href="#redo-log-写入方式" class="right-sidebar-item-level3">
          redo log 写入方式
        </a></li><li id="tab-item8" class="right-sidebar-item"><a href="#checkpoint-技术" class="right-sidebar-item-level3">
          Checkpoint 技术
        </a></li><li id="tab-item9" class="right-sidebar-item"><a href="#_5-3-undo-log" class="right-sidebar-item-level2">
          5.3 undo log
        </a></li><li id="tab-item10" class="right-sidebar-item"><a href="#undo-log-数据格式" class="right-sidebar-item-level3">
          undo log 数据格式
        </a></li></ul></div></aside></div><div class="global-ui"></div></div>
    <script src="/note-pages/assets/js/app.05dcbd87.js" defer></script><script src="/note-pages/assets/js/3.4a2f67fd.js" defer></script><script src="/note-pages/assets/js/2.ab82720e.js" defer></script><script src="/note-pages/assets/js/56.75828a09.js" defer></script>
  </body>
</html>
