(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{1003:function(_,v,t){"use strict";t.r(v);var s=t(14),a=Object(s.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"第10章-数据库恢复技术"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第10章-数据库恢复技术"}},[_._v("#")]),_._v(" 第10章 数据库恢复技术")]),_._v(" "),t("h2",{attrs:{id:"_10-1-事务的基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-事务的基本概念"}},[_._v("#")]),_._v(" 10.1 事务的基本概念")]),_._v(" "),t("h3",{attrs:{id:"事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[_._v("#")]),_._v(" 事务")]),_._v(" "),t("p",[_._v("事务是用户定义的一个 "),t("strong",[_._v("数据库操作序列")]),_._v("，这些操作要么全做、要么全不做，"),t("strong",[_._v("是一个不可分割的工作单位")]),_._v("。")]),_._v(" "),t("p",[_._v("显式定义方式：")]),_._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("BEGIN")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("TRANSACTION")]),_._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[_._v("# SQL 语句")]),_._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("COMMIT")]),_._v("\n")])])]),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("BEGIN")]),_._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("TRANSACTION")]),_._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[_._v("# SQL 语句")]),_._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("ROLLBACK")]),_._v("\n")])])]),t("p",[_._v("隐式定义方式：当用户没有显式地定义事务时，数据库管理系统按缺省规定自动划分事务。")]),_._v(" "),t("h3",{attrs:{id:"事务的-acid-特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务的-acid-特性"}},[_._v("#")]),_._v(" 事务的 ACID 特性")]),_._v(" "),t("p",[_._v("事务的特性："),t("strong",[_._v("原子性")]),_._v("（Atomicity）、"),t("strong",[_._v("一致性")]),_._v("（Consistency）、"),t("strong",[_._v("隔离性")]),_._v("（Isolation）和"),t("strong",[_._v("持续性")]),_._v("（Durability）。这 4 个特性简称为 ACID 特性。")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("原子性")]),_._v("：事务是数据库的逻辑工作单位，事务中包括的诸操作 "),t("strong",[_._v("要么都做，要么都不做")]),_._v("。")]),_._v(" "),t("li",[t("strong",[_._v("一致性")]),_._v("：事务执行的结果必须是使数据库 "),t("strong",[_._v("从一个一致性状态变到另一个一致性状态")]),_._v("。")]),_._v(" "),t("li",[t("strong",[_._v("隔离性")]),_._v("："),t("strong",[_._v("一个事务的执行不能被其他事务干扰")]),_._v("。即一个事务内部的操作及使用的数据对其他并发事务是隔离的，并发执行的各个事务之间不能互相干扰。")]),_._v(" "),t("li",[t("strong",[_._v("持续性")]),_._v("："),t("strong",[_._v("指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的")]),_._v("。接下来的其他操作或故障不应该对其执行结果有任何影响。")])]),_._v(" "),t("h2",{attrs:{id:"_10-2-数据库恢复概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-数据库恢复概述"}},[_._v("#")]),_._v(" 10.2 数据库恢复概述")]),_._v(" "),t("p",[_._v("数据库管理系统必须具有 "),t("strong",[_._v("把数据库从错误状态恢复到某一已知的正确状态")]),_._v("（亦称为一致状态或完整状态）的功能，这就是数据库的恢复管理系统对故障的对策。")]),_._v(" "),t("p",[t("strong",[_._v("恢复子系统")]),_._v(" 是数据库管理系统的一个重要组成部分。")]),_._v(" "),t("h2",{attrs:{id:"_10-3-故障的种类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-故障的种类"}},[_._v("#")]),_._v(" 10.3 故障的种类")]),_._v(" "),t("h3",{attrs:{id:"事务内部的故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务内部的故障"}},[_._v("#")]),_._v(" 事务内部的故障")]),_._v(" "),t("p",[_._v("事务内部更多的故障是非预期的，是不能由应用程序处理的。")]),_._v(" "),t("ul",[t("li",[_._v("运算溢出")]),_._v(" "),t("li",[_._v("并发事务发生死锁而被选中撤销该事务")]),_._v(" "),t("li",[_._v("违反了某些完整性限制而被终止等")])]),_._v(" "),t("p",[_._v("事务故障意味着")]),_._v(" "),t("ul",[t("li",[_._v("事务没有达到预期的终点（COMMIT 或者显式的 ROLLBACK）；")]),_._v(" "),t("li",[_._v("数据库可能处于不正确状态。")])]),_._v(" "),t("p",[_._v("事务故障的恢复："),t("strong",[_._v("事务撤消（UNDO）")]),_._v("。")]),_._v(" "),t("h3",{attrs:{id:"系统故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统故障"}},[_._v("#")]),_._v(" 系统故障")]),_._v(" "),t("p",[_._v("称为 "),t("strong",[_._v("软故障")]),_._v("，是指造成系统停止运转的任何事件，使得系统要重新启动。")]),_._v(" "),t("ul",[t("li",[_._v("特定类型的硬件错误（如 CPU 故障）")]),_._v(" "),t("li",[_._v("操作系统故障")]),_._v(" "),t("li",[_._v("数据库管理系统代码错误")]),_._v(" "),t("li",[_._v("系统断电")])]),_._v(" "),t("p",[_._v("发生系统故障时，一些 "),t("strong",[_._v("尚未完成的事务的结果可能已送入物理数据库")]),_._v("，造成数据库可能处于不正确状态。")]),_._v(" "),t("ul",[t("li",[_._v("恢复策略：系统重新启动时，恢复程序让所有非正常终止的事务回滚，"),t("strong",[_._v("强行撤消（UNDO）")]),_._v(" 所有未完成事务。")])]),_._v(" "),t("p",[_._v("发生系统故障时，有些 "),t("strong",[_._v("已完成的事务")]),_._v(" 可能有一部分甚至全部留在缓冲区，"),t("strong",[_._v("尚未写回到磁盘")]),_._v(" 上的物理数据库中，系统故障使得这些事务对数据库的修改部分或全部丢失。")]),_._v(" "),t("ul",[t("li",[_._v("恢复策略：系统重新启动时，恢复程序需要 "),t("strong",[_._v("重做（REDO）")]),_._v(" 所有已提交的事务。")])]),_._v(" "),t("h3",{attrs:{id:"介质故障"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介质故障"}},[_._v("#")]),_._v(" 介质故障")]),_._v(" "),t("p",[_._v("称为 "),t("strong",[_._v("硬故障")]),_._v("，指外存故障。")]),_._v(" "),t("h2",{attrs:{id:"_10-4-恢复的实现技术"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-恢复的实现技术"}},[_._v("#")]),_._v(" 10.4 恢复的实现技术")]),_._v(" "),t("p",[_._v("恢复操作的基本原理："),t("strong",[_._v("冗余")]),_._v("。")]),_._v(" "),t("h3",{attrs:{id:"数据转储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据转储"}},[_._v("#")]),_._v(" 数据转储")]),_._v(" "),t("p",[_._v("转储是指数据库管理员 "),t("strong",[_._v("定期地将整个数据库复制到磁带、磁盘或其他存储介质上保存起来")]),_._v(" 的过程。")]),_._v(" "),t("p",[_._v("静态转储与动态转储：")]),_._v(" "),t("ul",[t("li",[_._v("静态转储：在系统中无运行事务时进行的转储操作。")]),_._v(" "),t("li",[_._v("动态转储：转储操作与用户事务并发进行。")])]),_._v(" "),t("p",[_._v("海量转储与增量转储")]),_._v(" "),t("ul",[t("li",[_._v("海量转储: 每次转储全部数据库。")]),_._v(" "),t("li",[_._v("增量转储: 只转储上次转储后更新过的数据。")])]),_._v(" "),t("h3",{attrs:{id:"登记日志文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登记日志文件"}},[_._v("#")]),_._v(" 登记日志文件")]),_._v(" "),t("p",[_._v("日志文件（log file）是用来记录事务对数据库的更新操作的文件。")]),_._v(" "),t("p",[_._v("日志文件的格式：")]),_._v(" "),t("ul",[t("li",[_._v("以记录为单位的日志文件。")]),_._v(" "),t("li",[_._v("以数据块为单位的日志文件。")])]),_._v(" "),t("p",[t("strong",[_._v("登记日志文件时必须先写日志文件，后写数据库：")])]),_._v(" "),t("ul",[t("li",[_._v("把对数据的修改写到数据库中和把表示这个修改的日志记录写到日志文件中是两个不同的操作。有可能在这两个操作之间发生故障，即这两个写操作只完成了一个。")]),_._v(" "),t("li",[_._v("如果先写了数据库修改，而在运行记录中没有登记这个修改，则以后就无法恢复这个修改了。如果先写日志，但没有修改数据库，在恢复时只不过是多执行一次 UNDO 操作，并不会影响数据库的正确性。")])]),_._v(" "),t("h2",{attrs:{id:"_10-5-恢复策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-5-恢复策略"}},[_._v("#")]),_._v(" 10.5 恢复策略")]),_._v(" "),t("h3",{attrs:{id:"事务故障的恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务故障的恢复"}},[_._v("#")]),_._v(" 事务故障的恢复")]),_._v(" "),t("p",[t("strong",[_._v("恢复方法")]),_._v("：由恢复子系统利用日志文件 "),t("strong",[_._v("撤消（UNDO）此事务已对数据库进行的修改")]),_._v("。")]),_._v(" "),t("ul",[t("li",[_._v("反向扫描文件日志，查找该事务的更新操作。")]),_._v(" "),t("li",[_._v("对该事务的更新操作执行逆操作。即将日志记录中 “更新前的值” 写入数据库。")])]),_._v(" "),t("p",[_._v("直至读到此事务的开始标记，该事务故障的恢复就完成了")]),_._v(" "),t("h3",{attrs:{id:"系统故障的恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统故障的恢复"}},[_._v("#")]),_._v(" 系统故障的恢复")]),_._v(" "),t("p",[t("strong",[_._v("恢复方法")]),_._v("：")]),_._v(" "),t("ul",[t("li",[_._v("正向扫描日志文件，找出在故障发生前已经提交的事务队列（REDO 队列）和未完成的事务队列（UNDO 队列）。")]),_._v(" "),t("li",[_._v("对未完成的事务队列中的各个事务进行 UNDO 处理。")]),_._v(" "),t("li",[_._v("对已经提交的事务队列中的各个事务进行 REDO 处理。")])]),_._v(" "),t("h3",{attrs:{id:"介质故障的恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介质故障的恢复"}},[_._v("#")]),_._v(" 介质故障的恢复")]),_._v(" "),t("p",[t("strong",[_._v("恢复方法")]),_._v("：")]),_._v(" "),t("ul",[t("li",[_._v("装入最新的数据库后备副本（离故障发生时刻最近的"),t("strong",[_._v("转储副本")]),_._v("），使数据库恢复到最近一次转储时的一致性状态。")]),_._v(" "),t("li",[_._v("装入转储结束时刻的 "),t("strong",[_._v("日志文件副本")]),_._v("。")]),_._v(" "),t("li",[_._v("启动系统恢复命令，由 DBMS 完成恢复功能，即重做已完成的事务。")])]),_._v(" "),t("h2",{attrs:{id:"_10-6-具有检查点的恢复技术"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-6-具有检查点的恢复技术"}},[_._v("#")]),_._v(" 10.6 具有检查点的恢复技术")]),_._v(" "),t("p",[_._v("利用日志技术进行数据库恢复时，恢复子系统必须搜索整个日志，这将耗费大量的时间。此外，需要 REDO 处理的事务实际上已经将它们的更新操作结果写到数据库中了，恢复子系统又重新执行了这些操作，浪费了大量时间。")]),_._v(" "),t("p",[_._v("检查点技术就是为了解决这些问题。")]),_._v(" "),t("p",[_._v("检查点记录是一类新的日志记录。它的内容包括：")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("建立检查点时刻所有正在执行的事务清单")]),_._v("；")]),_._v(" "),t("li",[_._v("这些事务的 "),t("strong",[_._v("最近一个日志记录的地址")]),_._v("。")])]),_._v(" "),t("p",[t("strong",[_._v("使用检查点方法进行恢复的步骤：")])]),_._v(" "),t("ul",[t("li",[_._v("在重新开始文件中，找到最后一个检查点记录在日志文件中的地址，由该地址在日志文件中 "),t("strong",[_._v("找到最后一个检查点记录")]),_._v("。")]),_._v(" "),t("li",[_._v("由该检查点记录 "),t("strong",[_._v("得到检查点建立时刻所有正在执行的事务清单 ACTIVE-LIST")]),_._v("。")]),_._v(" "),t("li",[_._v("这里建立两个事务队列：\n"),t("ul",[t("li",[_._v("UNDO-LIST：需要执行 UNDO 操作的事务集合")]),_._v(" "),t("li",[_._v("REDO-LIST：需要执行 REDO 操作的事务集合")])])]),_._v(" "),t("li",[t("strong",[_._v("把 ACTIVE-LIST 暂时放入 UNDO-LIST 队列，REDO 队列暂为空。")])]),_._v(" "),t("li",[_._v("从检查点开始正向扫描日志文件。\n"),t("ul",[t("li",[_._v("如有 "),t("strong",[_._v("新开始的事务 Ti")]),_._v("，把 Ti 暂时 "),t("strong",[_._v("放入UNDO-LIST 队列")]),_._v("；")]),_._v(" "),t("li",[_._v("如有 "),t("strong",[_._v("提交的事务 Tj")]),_._v("，把Tj "),t("strong",[_._v("从UNDO-LIST 队列移到 REDO-LIST 队列")]),_._v("，直到日志文件结束。")])])]),_._v(" "),t("li",[_._v("对 UNDO-LIST 中的每个事务执行 UNDO 操作，对 REDO-LIST 中的每个事务执行 REDO 操作。")])]),_._v(" "),t("h2",{attrs:{id:"_10-7-数据库镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-7-数据库镜像"}},[_._v("#")]),_._v(" 10.7 数据库镜像")]),_._v(" "),t("p",[_._v("数据库镜像即根据 DBA 的要求，自动把整个数据库或者其中的部分关键数据复制到另一个磁盘上。每当主数据库更新时，DBMS 自动把更新后的数据复制过去，即 DBMS 自动保证镜像数据与主数据的一致性。")]),_._v(" "),t("p",[_._v("数据库镜像的用途：")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("数据库恢复")]),_._v("。当出现介质故障时，镜像磁盘可继续使用，同时 DBMS 自动利用镜像磁盘数据进行数据库的恢复，不需要关闭系统和重装数据库副本。")]),_._v(" "),t("li",[t("strong",[_._v("提高数据库的可用性")]),_._v("。在没有出现故障时，当一个用户对某个数据加排他锁进行修改时，其他用户可以读镜像数据库上的数据，而不必等待该用户释放锁。")])])])}),[],!1,null,null,null);v.default=a.exports}}]);