<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第3章 程序的机器级表示 | 后端技术栈笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/jquery/3.4.0/jquery.min.js"></script>
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" href="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">
    <meta name="description" content="BackEnd Notes">
    
    <link rel="preload" href="/note-pages/assets/css/0.styles.167a34c7.css" as="style"><link rel="preload" href="/note-pages/assets/js/app.05dcbd87.js" as="script"><link rel="preload" href="/note-pages/assets/js/3.4a2f67fd.js" as="script"><link rel="preload" href="/note-pages/assets/js/2.ab82720e.js" as="script"><link rel="preload" href="/note-pages/assets/js/27.ca60e875.js" as="script"><link rel="prefetch" href="/note-pages/assets/js/10.e11a80d9.js"><link rel="prefetch" href="/note-pages/assets/js/100.489cf69a.js"><link rel="prefetch" href="/note-pages/assets/js/101.560e37ea.js"><link rel="prefetch" href="/note-pages/assets/js/102.baaa4f6a.js"><link rel="prefetch" href="/note-pages/assets/js/103.262b6423.js"><link rel="prefetch" href="/note-pages/assets/js/104.ac33d7ce.js"><link rel="prefetch" href="/note-pages/assets/js/105.5e6ce18f.js"><link rel="prefetch" href="/note-pages/assets/js/106.a69322ef.js"><link rel="prefetch" href="/note-pages/assets/js/107.6cdb78ee.js"><link rel="prefetch" href="/note-pages/assets/js/108.1d720289.js"><link rel="prefetch" href="/note-pages/assets/js/109.58f7297c.js"><link rel="prefetch" href="/note-pages/assets/js/11.241a46da.js"><link rel="prefetch" href="/note-pages/assets/js/110.9cef761d.js"><link rel="prefetch" href="/note-pages/assets/js/111.c782138c.js"><link rel="prefetch" href="/note-pages/assets/js/112.40cb3b1a.js"><link rel="prefetch" href="/note-pages/assets/js/113.c367e40a.js"><link rel="prefetch" href="/note-pages/assets/js/114.a4a75db5.js"><link rel="prefetch" href="/note-pages/assets/js/115.a73cd469.js"><link rel="prefetch" href="/note-pages/assets/js/116.ad853155.js"><link rel="prefetch" href="/note-pages/assets/js/117.a82b2649.js"><link rel="prefetch" href="/note-pages/assets/js/118.8f896dd0.js"><link rel="prefetch" href="/note-pages/assets/js/119.374482b1.js"><link rel="prefetch" href="/note-pages/assets/js/12.ebe220d5.js"><link rel="prefetch" href="/note-pages/assets/js/120.89698284.js"><link rel="prefetch" href="/note-pages/assets/js/121.cbe50685.js"><link rel="prefetch" href="/note-pages/assets/js/122.7de2ac51.js"><link rel="prefetch" href="/note-pages/assets/js/123.a2d16009.js"><link rel="prefetch" href="/note-pages/assets/js/124.e1ba7cbe.js"><link rel="prefetch" href="/note-pages/assets/js/125.4e1e6d6a.js"><link rel="prefetch" href="/note-pages/assets/js/126.3db22af3.js"><link rel="prefetch" href="/note-pages/assets/js/127.937f4ffc.js"><link rel="prefetch" href="/note-pages/assets/js/128.0bad2e20.js"><link rel="prefetch" href="/note-pages/assets/js/129.75a99d25.js"><link rel="prefetch" href="/note-pages/assets/js/13.5ee7bef5.js"><link rel="prefetch" href="/note-pages/assets/js/130.599b6d3d.js"><link rel="prefetch" href="/note-pages/assets/js/131.687214bf.js"><link rel="prefetch" href="/note-pages/assets/js/132.8295c067.js"><link rel="prefetch" href="/note-pages/assets/js/133.854d61c0.js"><link rel="prefetch" href="/note-pages/assets/js/134.f3fc20e1.js"><link rel="prefetch" href="/note-pages/assets/js/135.2a5a690d.js"><link rel="prefetch" href="/note-pages/assets/js/136.6ba30378.js"><link rel="prefetch" href="/note-pages/assets/js/137.80d7c511.js"><link rel="prefetch" href="/note-pages/assets/js/138.0a25898e.js"><link rel="prefetch" href="/note-pages/assets/js/139.fb3c377f.js"><link rel="prefetch" href="/note-pages/assets/js/14.a561f8b3.js"><link rel="prefetch" href="/note-pages/assets/js/140.cbfdbe32.js"><link rel="prefetch" href="/note-pages/assets/js/141.c09f054f.js"><link rel="prefetch" href="/note-pages/assets/js/142.723bd973.js"><link rel="prefetch" href="/note-pages/assets/js/143.b31785f9.js"><link rel="prefetch" href="/note-pages/assets/js/144.69d3d121.js"><link rel="prefetch" href="/note-pages/assets/js/145.c4ee6aa0.js"><link rel="prefetch" href="/note-pages/assets/js/146.7f836a1c.js"><link rel="prefetch" href="/note-pages/assets/js/147.d4a57976.js"><link rel="prefetch" href="/note-pages/assets/js/148.b15e75eb.js"><link rel="prefetch" href="/note-pages/assets/js/149.94085ddc.js"><link rel="prefetch" href="/note-pages/assets/js/15.4ed118f1.js"><link rel="prefetch" href="/note-pages/assets/js/150.6751d41b.js"><link rel="prefetch" href="/note-pages/assets/js/151.bd60e322.js"><link rel="prefetch" href="/note-pages/assets/js/152.15caf78f.js"><link rel="prefetch" href="/note-pages/assets/js/153.131128fc.js"><link rel="prefetch" href="/note-pages/assets/js/154.b8ee2e7d.js"><link rel="prefetch" href="/note-pages/assets/js/155.8fa1e2e0.js"><link rel="prefetch" href="/note-pages/assets/js/156.25e2a796.js"><link rel="prefetch" href="/note-pages/assets/js/157.7137c9c3.js"><link rel="prefetch" href="/note-pages/assets/js/158.fdc18c40.js"><link rel="prefetch" href="/note-pages/assets/js/159.0dadb745.js"><link rel="prefetch" href="/note-pages/assets/js/16.818fc8bf.js"><link rel="prefetch" href="/note-pages/assets/js/160.05f7541c.js"><link rel="prefetch" href="/note-pages/assets/js/161.2a8c62a2.js"><link rel="prefetch" href="/note-pages/assets/js/162.5b9983b7.js"><link rel="prefetch" href="/note-pages/assets/js/163.b51a5538.js"><link rel="prefetch" href="/note-pages/assets/js/164.06c9f20a.js"><link rel="prefetch" href="/note-pages/assets/js/165.c25063f4.js"><link rel="prefetch" href="/note-pages/assets/js/166.6c570da5.js"><link rel="prefetch" href="/note-pages/assets/js/167.12fb6fb6.js"><link rel="prefetch" href="/note-pages/assets/js/168.d7dd27bc.js"><link rel="prefetch" href="/note-pages/assets/js/169.27f575fe.js"><link rel="prefetch" href="/note-pages/assets/js/17.9daf0c47.js"><link rel="prefetch" href="/note-pages/assets/js/170.ba4295ef.js"><link rel="prefetch" href="/note-pages/assets/js/171.3fb54078.js"><link rel="prefetch" href="/note-pages/assets/js/18.086ed162.js"><link rel="prefetch" href="/note-pages/assets/js/19.adca670c.js"><link rel="prefetch" href="/note-pages/assets/js/20.2e9ff004.js"><link rel="prefetch" href="/note-pages/assets/js/21.07830947.js"><link rel="prefetch" href="/note-pages/assets/js/22.609929cb.js"><link rel="prefetch" href="/note-pages/assets/js/23.d83b832f.js"><link rel="prefetch" href="/note-pages/assets/js/24.592e8014.js"><link rel="prefetch" href="/note-pages/assets/js/25.9d28bb6f.js"><link rel="prefetch" href="/note-pages/assets/js/26.fd4195d5.js"><link rel="prefetch" href="/note-pages/assets/js/28.c2cd75e6.js"><link rel="prefetch" href="/note-pages/assets/js/29.4213d132.js"><link rel="prefetch" href="/note-pages/assets/js/30.c6ee0ead.js"><link rel="prefetch" href="/note-pages/assets/js/31.eea6a542.js"><link rel="prefetch" href="/note-pages/assets/js/32.1ffdceaf.js"><link rel="prefetch" href="/note-pages/assets/js/33.0425748b.js"><link rel="prefetch" href="/note-pages/assets/js/34.5dd0d81d.js"><link rel="prefetch" href="/note-pages/assets/js/35.773df14e.js"><link rel="prefetch" href="/note-pages/assets/js/36.5db32ea2.js"><link rel="prefetch" href="/note-pages/assets/js/37.1106162c.js"><link rel="prefetch" href="/note-pages/assets/js/38.793ba7d0.js"><link rel="prefetch" href="/note-pages/assets/js/39.488fb9a5.js"><link rel="prefetch" href="/note-pages/assets/js/4.550e6883.js"><link rel="prefetch" href="/note-pages/assets/js/40.9c05b0ae.js"><link rel="prefetch" href="/note-pages/assets/js/41.ae198526.js"><link rel="prefetch" href="/note-pages/assets/js/42.d815456e.js"><link rel="prefetch" href="/note-pages/assets/js/43.1808aff8.js"><link rel="prefetch" href="/note-pages/assets/js/44.c26d9bde.js"><link rel="prefetch" href="/note-pages/assets/js/45.fae5f755.js"><link rel="prefetch" href="/note-pages/assets/js/46.703057c9.js"><link rel="prefetch" href="/note-pages/assets/js/47.ed3a23ce.js"><link rel="prefetch" href="/note-pages/assets/js/48.c5a46ee8.js"><link rel="prefetch" href="/note-pages/assets/js/49.b04c1681.js"><link rel="prefetch" href="/note-pages/assets/js/5.869d288f.js"><link rel="prefetch" href="/note-pages/assets/js/50.249fc2a7.js"><link rel="prefetch" href="/note-pages/assets/js/51.cab74632.js"><link rel="prefetch" href="/note-pages/assets/js/52.e2f231b3.js"><link rel="prefetch" href="/note-pages/assets/js/53.6241e308.js"><link rel="prefetch" href="/note-pages/assets/js/54.7d29c5c0.js"><link rel="prefetch" href="/note-pages/assets/js/55.a9050f95.js"><link rel="prefetch" href="/note-pages/assets/js/56.75828a09.js"><link rel="prefetch" href="/note-pages/assets/js/57.b3f75d67.js"><link rel="prefetch" href="/note-pages/assets/js/58.0cf3bd1c.js"><link rel="prefetch" href="/note-pages/assets/js/59.19f18f1f.js"><link rel="prefetch" href="/note-pages/assets/js/6.d879438f.js"><link rel="prefetch" href="/note-pages/assets/js/60.61940d92.js"><link rel="prefetch" href="/note-pages/assets/js/61.bc890bb0.js"><link rel="prefetch" href="/note-pages/assets/js/62.f487437c.js"><link rel="prefetch" href="/note-pages/assets/js/63.4a91369b.js"><link rel="prefetch" href="/note-pages/assets/js/64.1b0770e4.js"><link rel="prefetch" href="/note-pages/assets/js/65.b56e2b22.js"><link rel="prefetch" href="/note-pages/assets/js/66.dd49594c.js"><link rel="prefetch" href="/note-pages/assets/js/67.22efede4.js"><link rel="prefetch" href="/note-pages/assets/js/68.0d22a8a4.js"><link rel="prefetch" href="/note-pages/assets/js/69.aec9bfeb.js"><link rel="prefetch" href="/note-pages/assets/js/7.e3626849.js"><link rel="prefetch" href="/note-pages/assets/js/70.0c53c20d.js"><link rel="prefetch" href="/note-pages/assets/js/71.6d6db7d6.js"><link rel="prefetch" href="/note-pages/assets/js/72.fdcfb985.js"><link rel="prefetch" href="/note-pages/assets/js/73.a390b48d.js"><link rel="prefetch" href="/note-pages/assets/js/74.e817987f.js"><link rel="prefetch" href="/note-pages/assets/js/75.f144cf4f.js"><link rel="prefetch" href="/note-pages/assets/js/76.7be2f5f1.js"><link rel="prefetch" href="/note-pages/assets/js/77.6568d596.js"><link rel="prefetch" href="/note-pages/assets/js/78.4ff63ca8.js"><link rel="prefetch" href="/note-pages/assets/js/79.daaf791e.js"><link rel="prefetch" href="/note-pages/assets/js/8.f9f716a1.js"><link rel="prefetch" href="/note-pages/assets/js/80.a0605696.js"><link rel="prefetch" href="/note-pages/assets/js/81.ecb125f5.js"><link rel="prefetch" href="/note-pages/assets/js/82.b64b1c42.js"><link rel="prefetch" href="/note-pages/assets/js/83.d13b7f19.js"><link rel="prefetch" href="/note-pages/assets/js/84.c584da75.js"><link rel="prefetch" href="/note-pages/assets/js/85.7992353f.js"><link rel="prefetch" href="/note-pages/assets/js/86.17ad6399.js"><link rel="prefetch" href="/note-pages/assets/js/87.289f9f2f.js"><link rel="prefetch" href="/note-pages/assets/js/88.3496d6e2.js"><link rel="prefetch" href="/note-pages/assets/js/89.0d0c778d.js"><link rel="prefetch" href="/note-pages/assets/js/9.3209071f.js"><link rel="prefetch" href="/note-pages/assets/js/90.245b9fda.js"><link rel="prefetch" href="/note-pages/assets/js/91.806af5f2.js"><link rel="prefetch" href="/note-pages/assets/js/92.8a10f401.js"><link rel="prefetch" href="/note-pages/assets/js/93.ea90ae18.js"><link rel="prefetch" href="/note-pages/assets/js/94.98cc66ef.js"><link rel="prefetch" href="/note-pages/assets/js/95.836e96c5.js"><link rel="prefetch" href="/note-pages/assets/js/96.d4dd3eee.js"><link rel="prefetch" href="/note-pages/assets/js/97.e4275cb9.js"><link rel="prefetch" href="/note-pages/assets/js/98.0e320d92.js"><link rel="prefetch" href="/note-pages/assets/js/99.e6f77650.js">
    <link rel="stylesheet" href="/note-pages/assets/css/0.styles.167a34c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-pages/" class="home-link router-link-active"><!----> <span class="site-name">后端技术栈笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link router-link-active">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link router-link-active">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note-pages/computer-systems/5de00e/" class="sidebar-link">第1章 计算机系统漫游</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-1-信息就是位-上下文" class="sidebar-link">1.1 信息就是位+上下文</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-2-程序被其他程序翻译成不同的格式" class="sidebar-link">1.2 程序被其他程序翻译成不同的格式</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-3-处理器读并解释储存在内存中的指令" class="sidebar-link">1.3 处理器读并解释储存在内存中的指令</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-4-高速缓存至关重要" class="sidebar-link">1.4 高速缓存至关重要</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-5-存储设备形成层次结构" class="sidebar-link">1.5 存储设备形成层次结构</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-6-操作系统管理硬件" class="sidebar-link">1.6 操作系统管理硬件</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-7-系统之间利用网络通信" class="sidebar-link">1.7 系统之间利用网络通信</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00e/#_1-8-重要主题" class="sidebar-link">1.8 重要主题</a></li></ul></li><li><a href="/note-pages/computer-systems/5de00f/" class="sidebar-link">第2章 信息的表示和处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00f/#_2-1-信息存储" class="sidebar-link">2.1 信息存储</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00f/#_2-2-整数表示" class="sidebar-link">2.2 整数表示</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00f/#_2-3-整数运算" class="sidebar-link">2.3 整数运算</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00f/#_2-4-浮点数表示" class="sidebar-link">2.4 浮点数表示</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/5de00f/#_2-5-浮点数运算" class="sidebar-link">2.5 浮点数运算</a></li></ul></li><li><a href="/note-pages/computer-systems/03-程序的机器级表示.html" class="active sidebar-link">第3章 程序的机器级表示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-1-程序编码" class="sidebar-link">3.1 程序编码</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-2-访问信息" class="sidebar-link">3.2 访问信息</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-3-算术和逻辑操作" class="sidebar-link">3.3 算术和逻辑操作</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-4-控制" class="sidebar-link">3.4 控制</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-5-过程" class="sidebar-link">3.5 过程</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-6-数组分配和访问" class="sidebar-link">3.6 数组分配和访问</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/03-程序的机器级表示.html#_3-7-异质的数据结构" class="sidebar-link">3.7 异质的数据结构</a></li></ul></li><li><a href="/note-pages/computer-systems/04-处理器体系结构.html" class="sidebar-link">第4章 处理器体系结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/04-处理器体系结构.html#_4-1-指令集结构" class="sidebar-link">4.1 指令集结构</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/04-处理器体系结构.html#_4-2-计算机组成" class="sidebar-link">4.2 计算机组成</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/04-处理器体系结构.html#_4-3-寄存器传送语言" class="sidebar-link">4.3 寄存器传送语言</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/04-处理器体系结构.html#_4-4-中央处理器设计规范" class="sidebar-link">4.4 中央处理器设计规范</a></li></ul></li><li><a href="/note-pages/computer-systems/05-优化程序性能.html" class="sidebar-link">第5章 优化程序性能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-1-编译器的局限性" class="sidebar-link">5.1 编译器的局限性</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-2-程序性能的度量" class="sidebar-link">5.2 程序性能的度量</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-3-高级语言层次优化性能" class="sidebar-link">5.3 高级语言层次优化性能</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-4-理解现代处理器" class="sidebar-link">5.4 理解现代处理器</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-5-循环展开" class="sidebar-link">5.5 循环展开</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-6-提高并行性" class="sidebar-link">5.6 提高并行性</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-7-理解存储器性能" class="sidebar-link">5.7 理解存储器性能</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/05-优化程序性能.html#_5-8-加速比" class="sidebar-link">5.8 加速比</a></li></ul></li><li><a href="/note-pages/computer-systems/06-存储器层次结构.html" class="sidebar-link">第6章 存储器层次结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/06-存储器层次结构.html#_6-1-存储技术" class="sidebar-link">6.1 存储技术</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/06-存储器层次结构.html#_6-2-局部性" class="sidebar-link">6.2 局部性</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/06-存储器层次结构.html#_6-3-存储器层次结构" class="sidebar-link">6.3 存储器层次结构</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/06-存储器层次结构.html#_6-4-高速缓存存储器" class="sidebar-link">6.4 高速缓存存储器</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/06-存储器层次结构.html#_6-5-编写高速缓存友好的代码" class="sidebar-link">6.5 编写高速缓存友好的代码</a></li></ul></li><li><a href="/note-pages/computer-systems/07-链接.html" class="sidebar-link">第7章 链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-1-编译器驱动程序" class="sidebar-link">7.1 编译器驱动程序</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-2-静态链接" class="sidebar-link">7.2 静态链接</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-3-目标文件" class="sidebar-link">7.3 目标文件</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-4-可重定位目标文件" class="sidebar-link">7.4 可重定位目标文件</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-5-符号和符号表" class="sidebar-link">7.5 符号和符号表</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-6-符号解析" class="sidebar-link">7.6 符号解析</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-7-重定位" class="sidebar-link">7.7 重定位</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-8-加载可执行目标文件" class="sidebar-link">7.8 加载可执行目标文件</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/07-链接.html#_7-9-小结" class="sidebar-link">7.9 小结</a></li></ul></li><li><a href="/note-pages/computer-systems/08-异常控制流.html" class="sidebar-link">第8章 异常控制流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-1-异常" class="sidebar-link">8.1 异常</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-2-进程" class="sidebar-link">8.2 进程</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-3-系统调用错误处理" class="sidebar-link">8.3 系统调用错误处理</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-4-进程控制" class="sidebar-link">8.4 进程控制</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-5-信号" class="sidebar-link">8.5 信号</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-6-非本地跳转" class="sidebar-link">8.6 非本地跳转</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/08-异常控制流.html#_8-7-操作进程的工具" class="sidebar-link">8.7 操作进程的工具</a></li></ul></li><li><a href="/note-pages/computer-systems/09-虚拟存储器.html" class="sidebar-link">第9章 虚拟存储器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-1-物理和虚拟寻址" class="sidebar-link">9.1 物理和虚拟寻址</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-2-地址空间" class="sidebar-link">9.2 地址空间</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-3-虚拟存储器作为缓存的工具" class="sidebar-link">9.3 虚拟存储器作为缓存的工具</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-4-虚拟存储器作为存储器管理的工具" class="sidebar-link">9.4 虚拟存储器作为存储器管理的工具</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-5-虚拟存储器作为存储器保护的工具" class="sidebar-link">9.5 虚拟存储器作为存储器保护的工具</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-6-地址翻译" class="sidebar-link">9.6 地址翻译</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-7-案例研究" class="sidebar-link">9.7 案例研究</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-8-存储器映射" class="sidebar-link">9.8 存储器映射</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-9-动态存储器分配" class="sidebar-link">9.9 动态存储器分配</a></li><li class="sidebar-sub-header"><a href="/note-pages/computer-systems/09-虚拟存储器.html#_9-10-垃圾收集" class="sidebar-link">9.10 垃圾收集</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第3章-程序的机器级表示"><a href="#第3章-程序的机器级表示" class="header-anchor">#</a> 第3章 程序的机器级表示</h1> <h2 id="_3-1-程序编码"><a href="#_3-1-程序编码" class="header-anchor">#</a> 3.1 程序编码</h2> <h3 id="计算机抽象模型"><a href="#计算机抽象模型" class="header-anchor">#</a> 计算机抽象模型</h3> <p>计算机利用更简单的抽象模型来隐藏实现的细节。对于机器级编程来说，其中两种抽象尤为重要。</p> <p>第一种是由指令集体系结构或指令集架构（Instruction Set Architecture, ISA）来定义机器级程序的格式和行为，它定义了处理器状态、指令的格式，以及每条指令对状态的影响。大多数 ISA，包括 x86-64，将程序的行为描述成好像每条指令都是按顺序执行的，一条指令结束后，下一条再开始。处理器的硬件远比描述的精细复杂，它们并发地执行许多指令，但是可以采取措施保证整体行为与 ISA 指定的顺序执行的行为完全一致。</p> <p>第二种抽象是，机器级程序使用的内存地址是虚拟地址，提供的内存模型看上去是一个非常大的字节数组。存储器系统的实际实现是将多个硬件存储器和操作系统软件组合起来。</p> <h2 id="_3-2-访问信息"><a href="#_3-2-访问信息" class="header-anchor">#</a> 3.2 访问信息</h2> <h3 id="操作数指示符"><a href="#操作数指示符" class="header-anchor">#</a> 操作数指示符</h3> <p>不同位的寄存器名字不同，使用的时候要注意。</p> <p><img src="/note-pages/assets/img/image-20220605152922656.cfc4a5ff.png" alt="image-20220605152922656"></p> <p>三种类型的操作数：</p> <ul><li><p>立即数（Immediate），用来表示常数值，比如 $0x1f。不同的指令允许的立即数值范围不同，汇编器会自动选择最紧凑的方式进行数值编码。</p></li> <li><p>寄存器（Register），它表示某个寄存器的内容，16 个寄存器的低位 1 字节、2 字节、4 字节或 8 字节中的一个作为操作数，这些字节数分别对应于 8 位、16 位、32 位或 64 位。</p></li> <li><p>内存地址（Memory），它会根据计算出来的地址（通常称为有效地址）访问某个内存位置。</p></li></ul> <h3 id="数据传送指令"><a href="#数据传送指令" class="header-anchor">#</a> 数据传送指令</h3> <table><thead><tr><th>指令</th> <th>效果</th> <th>描述</th></tr></thead> <tbody><tr><td>MOV S,D</td> <td>D←S</td> <td>传送</td></tr> <tr><td>movb</td> <td></td> <td>传送字节</td></tr> <tr><td>movw</td> <td></td> <td>传送字</td></tr> <tr><td>movl</td> <td></td> <td>传输双字</td></tr> <tr><td>movq</td> <td></td> <td>传送四字</td></tr> <tr><td>movabsq I, R</td> <td>R←I</td> <td>传送绝对的四字</td></tr></tbody></table> <p><strong>操作数组合</strong></p> <p><img src="/note-pages/assets/img/image-20220605154932649.83d5fefd.png" alt="image-20220605154932649"></p> <p><strong>注意</strong>：传送指令的两个操作数不能都指向内存位置。将一个值从一个内存位置复制到另一个内存位置需要两条指令 —— 第一条指令将源值加载到寄存器中，第二条将该寄存器值写入目的位置。</p> <p><strong>压入和弹出栈数据</strong></p> <p><img src="/note-pages/assets/img/image-20220605165116798.3010dca7.png" alt="image-20220605165116798"></p> <p><strong>内存寻址</strong></p> <p>格式：<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">m</mi></mrow><mo stretchy="false">(</mo><msub><mi>E</mi><mi>b</mi></msub><mo separator="true">,</mo><mi>E</mi><mi>i</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{\rm Imm}(E_b,Ei,s)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mclose">)</span></span></span></span></span></p> <p>规则：<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>A</mi><mo>=</mo><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">m</mi></mrow><mo>+</mo><mo stretchy="false">[</mo><msub><mi>E</mi><mi>b</mi></msub><mo>+</mo><msub><mi>E</mi><mi>i</mi></msub><mo>∗</mo><mi>s</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">EA={\rm Imm}+[E_b+E_i*s]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mclose">]</span></span></span></span></span></p> <ul><li><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">m</mi></mrow><annotation encoding="application/x-tex">{\rm Imm}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span></span> : 常数 1, 2, or 4 bytes</li> <li><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">E_b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>: 基址寄存器</li> <li><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">E_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>：变址寄存器</li> <li><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span></span>：比例因子 1, 2, 4, or 8</li></ul> <p>举例：</p> <table><thead><tr><th>Expression</th> <th>Address Computation</th> <th>Address</th></tr></thead> <tbody><tr><td><code>0x8(%edx)</code></td> <td>0xf000 + 0x8</td> <td>0xf008</td></tr> <tr><td><code>(%edx, %ecx)</code></td> <td>0xf000 + 0x100</td> <td>0xf100</td></tr> <tr><td><code>(%edx, %ecx, 4)</code></td> <td>0xf000 + 4*0x100</td> <td>0xf400</td></tr> <tr><td><code>0x80(, %edx, 2)</code></td> <td>2*0xf000 + 0x80</td> <td>0x1e080</td></tr></tbody></table> <p><strong>lea 寻址</strong></p> <p>格式：leal Src, Dest</p> <p>计算内存地址值本身（不取内存里的值）</p> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">mul12</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">12</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>leal (%eax,%eax,2), %eax 	;t &lt;- x + x * 2
sall $2, %eax 				;return t &lt;&lt; 2
</code></pre></div><h2 id="_3-3-算术和逻辑操作"><a href="#_3-3-算术和逻辑操作" class="header-anchor">#</a> 3.3 算术和逻辑操作</h2> <h3 id="双操作数指令"><a href="#双操作数指令" class="header-anchor">#</a> 双操作数指令</h3> <div class="table-column-50-50-container"><table><thead><tr><th>格式</th> <th>计算</th></tr></thead> <tbody><tr><td><strong>addl</strong> Src,Dest</td> <td>Dest = Dest + Src</td></tr> <tr><td><strong>subl</strong> Src,Dest</td> <td>Dest = Dest - Src</td></tr> <tr><td><strong>imull</strong> Src,Dest</td> <td>Dest = Dest * Src</td></tr> <tr><td><strong>sall</strong> Src,Dest</td> <td>Dest = Dest &lt;&lt; Src（Arithmetic）</td></tr> <tr><td><strong>shll</strong> Src,Dest</td> <td>Dest = Dest &lt;&lt; Src（Logical）</td></tr> <tr><td><strong>sarl</strong> Src,Dest</td> <td>Dest = Dest &gt;&gt; Src（Arithmetic）</td></tr> <tr><td><strong>shrl</strong> Src,Dest</td> <td>Dest = Dest &gt;&gt; Src（Logical）</td></tr> <tr><td><strong>xorl</strong> Src,Dest</td> <td>Dest = Dest ^ Src</td></tr> <tr><td><strong>andl</strong> Src,Dest</td> <td>Dest = Dest &amp; Src</td></tr> <tr><td><strong>orl</strong> Src,Dest</td> <td>Dest = Dest | Src</td></tr></tbody></table></div><h3 id="单操作数指令"><a href="#单操作数指令" class="header-anchor">#</a> 单操作数指令</h3> <div class="table-column-50-50-container"><table><thead><tr><th>格式</th> <th>计算</th></tr></thead> <tbody><tr><td><strong>incl</strong> Dest</td> <td>Dest = Dest + 1</td></tr> <tr><td><strong>decl</strong> Dest</td> <td>Dest = Dest - 1</td></tr> <tr><td><strong>negl</strong> Dest</td> <td>Dest = -Dest（取补 = 各位取反后 + 1）</td></tr> <tr><td><strong>notl</strong> Dest</td> <td>Dest = ~Dest（取反=各位取反）</td></tr></tbody></table></div><h3 id="算术指令示例"><a href="#算术指令示例" class="header-anchor">#</a> 算术指令示例</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">arith</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">,</span><span class="token keyword">int</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> t1 <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    <span class="token keyword">int</span> t2 <span class="token operator">=</span> z <span class="token operator">+</span> t1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> t3 <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> t4 <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token number">48</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> t5 <span class="token operator">=</span> t3 <span class="token operator">+</span> t4<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rval <span class="token operator">=</span> t2 <span class="token operator">*</span> t5<span class="token punctuation">;</span>
    <span class="token keyword">return</span> rval<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>arith:
pushl %ebp
movl %esp, %ebp

movl 8(%ebp), %ecx			#ecx = x
movl 12(%ebp), %edx			#edx = y
leal (%edx,%edx,2),%eax		#eax = y + y * 2
sall $4, %eax				#eax *= 16 (t4)
leal 4(%ecx,%eax), %eax		#eax = 4 + x + t4 (t5)
addl %ecx, %edx				#edx = y + x (t1)
addl 16(%ebp), %edx			#edx += z (t2)
imull %edx, %eax			#eax = t5 * t2 (rval)

popl %ebp
ret
</code></pre></div><p>汇编指令与 C 语言代码有不同的执行顺序。有些代码对应多条指令，有些指令一次性完成多行代码。</p> <h3 id="特殊算术操作"><a href="#特殊算术操作" class="header-anchor">#</a> 特殊算术操作</h3> <table><thead><tr><th>指令</th> <th>效果</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>imull</strong> S</td> <td>(%edx : %eax ) ← S × %eax</td> <td>有符号全64位乘法</td></tr> <tr><td><strong>mull</strong> S</td> <td>(%edx : %eax ) ← S × %eax</td> <td>无符号全64位乘法</td></tr> <tr><td><strong>cltd</strong></td> <td>(%edx : %eax) ← SignExtend(%eax)</td> <td>转为四字</td></tr> <tr><td><strong>idivl</strong> S</td> <td>%edx ← (%edx : %eax) mod S<br>%eax ← (%edx : %eax ) ÷ S</td> <td>有符号除法</td></tr> <tr><td><strong>divl</strong> S</td> <td>%edx ← (%edx : %eax) mod S<br>%eax ← (%edx : %eax) ÷ S</td> <td>无符号除法</td></tr></tbody></table> <h2 id="_3-4-控制"><a href="#_3-4-控制" class="header-anchor">#</a> 3.4 控制</h2> <h3 id="条件码"><a href="#条件码" class="header-anchor">#</a> 条件码</h3> <p>每个条件码占一个 bit。</p> <table><thead><tr><th>条件码</th> <th>含义</th> <th>描述</th></tr></thead> <tbody><tr><td>CF</td> <td>进位标志</td> <td>最近的操作使最高位产生了进位。可以用来检查无符号操作数的溢出。</td></tr> <tr><td>ZF</td> <td>零标志</td> <td>最近的操作得出的结果为 0 。</td></tr> <tr><td>SF</td> <td>符号标志</td> <td>最近的操作得到的结果为负数。</td></tr> <tr><td>OF</td> <td>溢出标志</td> <td>最近的操作导致一个补码溢出——正溢出或负溢出。</td></tr></tbody></table> <p><strong>设置条件码</strong></p> <p><code>cmpl Src, Dest</code>：Dest – Src。影响标志位。</p> <p><code>testl Src, Dest</code>：Dest &amp; Src。影响标志位。</p> <p><strong>setX 指令</strong>：根据条件码的组合将一个字节设置为 0 或 1。</p> <table><thead><tr><th>setX</th> <th>Condition</th> <th>Description</th></tr></thead> <tbody><tr><td>sete/setz</td> <td>ZF</td> <td>Equal / Zero</td></tr> <tr><td>setne/setnz</td> <td>~ZF</td> <td>Not Equal / Not Zero</td></tr> <tr><td>sets</td> <td>SF</td> <td>Negative</td></tr> <tr><td>setns</td> <td>~SF</td> <td>Nonnegative</td></tr> <tr><td>setg</td> <td>~(SF ^ OF) &amp; ~ZF</td> <td>Greater (Signed)</td></tr> <tr><td>setge</td> <td>~(SF ^ OF)</td> <td>Greater or Equal (Signed)</td></tr> <tr><td>setl</td> <td>(SF ^ OF)</td> <td>Less (Signed)</td></tr> <tr><td>setle</td> <td>(SF ^ OF) | ZF</td> <td>Less or Equal (Signed)</td></tr> <tr><td>seta</td> <td>~CF &amp; ~ZF</td> <td>Above (unsigned)</td></tr> <tr><td>setb</td> <td>CF</td> <td>Below (unsigned)</td></tr></tbody></table> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">gt</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">&gt;</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>movl 	12(%ebp), %eax 		# eax = y
cmpl 	%eax, 8(%ebp)		# compare x : y
setg 	%al 				# al = x &gt; y
movzbl 	%al, %eax 			# zero rest of %eax
</code></pre></div><h3 id="翻译条件分支"><a href="#翻译条件分支" class="header-anchor">#</a> 翻译条件分支</h3> <p><strong>jX 指令（跳转指令）</strong>：根据不同的条件跳转到某条指令处执行</p> <table><thead><tr><th>jX</th> <th>Condition</th> <th>Description</th></tr></thead> <tbody><tr><td>jmp</td> <td>1</td> <td>无条件跳转</td></tr> <tr><td>je/jz</td> <td>ZF</td> <td>Equal / Zero</td></tr> <tr><td>Jne/jnz</td> <td>~ZF</td> <td>Not Equal / Not Zero</td></tr> <tr><td>js</td> <td>SF</td> <td>Negative</td></tr> <tr><td>jns</td> <td>~SF</td> <td>Nonnegative</td></tr> <tr><td>jg</td> <td>~(SF ^ OF) &amp; ~ZF</td> <td>Greater (Signed)</td></tr> <tr><td>jge</td> <td>~(SF ^ OF)</td> <td>Greater or Equal (Signed)</td></tr> <tr><td>jl</td> <td>(SF ^ OF)</td> <td>Less (Signed)</td></tr> <tr><td>jle</td> <td>(SF ^ OF) | ZF</td> <td>Less or Equal (Signed)</td></tr> <tr><td>ja</td> <td>~CF &amp; ~ZF</td> <td>Above (unsigned)</td></tr> <tr><td>jb</td> <td>CF</td> <td>Below (unsigned)</td></tr></tbody></table> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">absdiff</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> y <span class="token operator">-</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>absdiff:
	pushl 	%ebp
	movl	%esp, %ebp
	movl	8(%ebp), %edx
	movl 	12(%ebp), %eax
	cmpl 	%eax, %edx
	jle 	.L6
	subl 	%eax, %edx
	movl 	%edx, %eax
	jmp 	.L7
.L6:
	subl 	%edx, %eax
.L7:
	popl %ebp
	ret
</code></pre></div><h3 id="循环"><a href="#循环" class="header-anchor">#</a> 循环</h3> <p><strong>do-while 循环</strong></p> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">dw_loop</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        x <span class="token operator">+=</span> n<span class="token punctuation">;</span>
        y <span class="token operator">*=</span> n<span class="token punctuation">;</span>
        n<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>	movl 	8(%ebp), %eax
	movl 	12(%ebp), %ecx
	movl 	16(%ebp), %edx
.L2:
	addl	%edx, %eax
	imull 	%edx, %ecx
	subl 	$1, %edx
	testl 	%edx, %edx
	jle 	.L5
	cmpl 	%edx, %ecx
	jl 	.L2
.L5:
</code></pre></div><p><strong>while 循环</strong></p> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">loop_while</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">*=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>	movl 	8(%ebp), %ecx
	movl 	12(%ebp), %ebx
	movl 	$1, %eax
	cmpl 	%ebx, %ecx
	jge. 	.L11
	leal 	(%ebx, %ecx), %edx
	movl 	$1, %eax
.L12:
	imull	%edx, %eax
	addl	$1, %ecx
	addl	$1, %edx
	cmpl	%ecx, %ebx
	jg		.L12
.L11:
</code></pre></div><p><strong>for 循环</strong></p> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fact_for</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">*=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>	movl	8(%ebp), %ecx
	movl 	$2, %edx
	movl	$1, %eax
	cmpl 	$1, %ecx
	jle 	.L14
.L17: 
	imull 	%edx, %eax
	addl 	$1, %edx 
	cmpl 	%edx, %ecx
	jge 	.L17 
.L14:
</code></pre></div><h3 id="条件传送指令"><a href="#条件传送指令" class="header-anchor">#</a> 条件传送指令</h3> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">absdiff</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">&lt;</span> b <span class="token operator">?</span> b <span class="token operator">-</span> a <span class="token operator">:</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>非优化编译：gcc -S absdiff.c</strong></p> <div class="language- extra-class"><pre class="language-text"><code>absdiff:
	pushl 	%ebp
	movl 	%esp, %ebp
	movl 	8(%ebp), %edx
	movl 	12(%ebp), %eax 
	cmpl 	%eax, %edx
	jge 	.L2
	subl 	%edx, %eax
	jmp 	.L4
.L2:
	subl 	%eax, %edx
	movl 	%edx, %eax
.L4
    popl 	%ebp
    ret
</code></pre></div><p>汇编代码出现 jge 这样的跳转指令。对于使用了流水线的 CPU，这样的跳转是存在隐患的，分支预测失败就会刷新掉所有流水线中取到而未执行的指令， 影响运行性能。</p> <p><strong>优化编译：gcc -S O1 absdiff.c</strong></p> <div class="language- extra-class"><pre class="language-text"><code>absdiff:
    pushl 	%ebp
    movl 	%esp, %ebp
    pushl 	%ebx
    movl 	8(%ebp), %ecx	# ecx = a
    movl 	12(%ebp), %edx	# edx = b
    movl 	%edx, %ebx		# ebx = b
    subl 	%ecx, %ebx		# ebx = b - a
    movl 	%ecx, %eax 		# eax = a
    subl 	%edx, %eax		# eax = a - b
    cmpl 	%edx, %ecx		# compare a : b
    cmovl 	%ebx, %eax 		# if a &lt; b, eax = ebx = b - a
    popl 	%ebx
    popl 	%ebp
    ret
</code></pre></div><h3 id="switch-语句"><a href="#switch-语句" class="header-anchor">#</a> switch 语句</h3> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">long</span> <span class="token function">switch_eg</span><span class="token punctuation">(</span><span class="token keyword">long</span> x<span class="token punctuation">,</span> <span class="token keyword">long</span> y<span class="token punctuation">,</span> <span class="token keyword">long</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> w <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            w <span class="token operator">=</span> y <span class="token operator">*</span> z<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            w <span class="token operator">=</span> y <span class="token operator">/</span> z<span class="token punctuation">;</span>
            <span class="token comment">/* Fall Through */</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            w <span class="token operator">+=</span> z<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
            w <span class="token operator">-=</span> z<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            w <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> w<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>跳转表：</p> <div class="language- extra-class"><pre class="language-text"><code>.section .rodata
	.align 4
.L4:
	.long .L8 # x = 0
	.long .L3 # x = 1
	.long .L5 # x = 2
	.long .L9 # x = 3
	.long .L8 # x = 4
	.long .L7 # x = 5
	.long .L7 # x = 6
</code></pre></div><p>开始：</p> <div class="language- extra-class"><pre class="language-text"><code>long switch_eg(long x, long y, long z) {
    long w = 1;
    switch (x) {
        ...
    }
    return w;
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>switch_eg:
	pushl 	%ebp
	movl 	%esp, %ebp
	movl	8(%ebp), %eax
	cmpl 	$6, %eax 		# compare x : 6
	ja 		.L8				# if unsigned '&gt;' goto default
	jmp 	*.L4(, %eax, 4)
</code></pre></div><p>代码块1：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">switch</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// .L3</span>
        w <span class="token operator">=</span> y <span class="token operator">*</span> z<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>.L3: 						# x == 1
	movl 	12(%ebp), %eax	# eax = y
	imull 	16(%ebp), %eax	# eax = y * z
	jmp		.L2 			# goto done
</code></pre></div><p>代码块 2 和 3：Fall Through</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        w <span class="token operator">=</span> y <span class="token operator">/</span> z<span class="token punctuation">;</span>
        <span class="token comment">/* Fall Through */</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        w <span class="token operator">+=</span> z<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>.L5: 						# x == 2
	movl 	12(%ebp), %eax 	# eax = y
	cltd
	idivl 	16(%ebp) 		# y / z
	jmp .L6
.L9: 						# x == 3
	movl 	$1, %eax 		# w = 1
.L6: # merge:
	addl 	16(%ebp), %eax 	# w += z
	jmp		.L2 			# goto done
</code></pre></div><p>代码块 5、6 和 default：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
        w <span class="token operator">-=</span> z<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        w <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>.L7:						# x == 5,6
	movl	$1, %eax		# w = 1
	subl 	16(%ebp), %eax 	# w = 1 - z
	jmp 	.L2 			# goto done
.L8: 						# default
	movl 	$2, %eax 		# w = 2
.L2: 						# done
</code></pre></div><p>结束：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">return</span> w<span class="token punctuation">;</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>.L2: 						# done
	popl %ebp
	ret
</code></pre></div><p>使用跳转表是一种非常有效的实现多重分支的方法。</p> <h2 id="_3-5-过程"><a href="#_3-5-过程" class="header-anchor">#</a> 3.5 过程</h2> <p>过程的调用包括将数据和控制从代码的一部分传递到另一部分。在进入时为过程的局部变量分配空间，在退出时释放空间。大多数机器，只提供转移控制到过程和从过程中转移出控制这种简单指令。数据传递和局部变量的分配释放都是通过程序栈来实现。</p> <h3 id="栈帧结构"><a href="#栈帧结构" class="header-anchor">#</a> 栈帧结构</h3> <p>机器用栈来<strong>传递过程参数</strong>、<strong>存储返回信息</strong>、<strong>保存寄存器</strong>用于以后恢复，以及<strong>本地存储</strong>。而为单个过程分配的那部分栈称为<strong>栈帧</strong>（stack frame）。</p> <p><img src="/note-pages/assets/img/image-20220608094605837.34724509.png" alt="image-20220608094605837"></p> <p>当前函数或过程的栈顶地址保存在 %esp 中，栈底地址保存在 %ebp 中。</p> <p>栈向低地址方向增长，或者说是向地址 0x0 处增加的，因此 %esp 中的值小于或等于 %ebp 中的值。</p> <p>栈帧是内存中一段连续的内存空间。被调用者的栈帧紧挨着调用者的栈帧。</p> <h3 id="转移控制"><a href="#转移控制" class="header-anchor">#</a> 转移控制</h3> <p>支待过程调用和返回的指令：</p> <table><thead><tr><th>指令</th> <th>描述</th></tr></thead> <tbody><tr><td>call Label</td> <td>过程调用</td></tr> <tr><td>call *Operand</td> <td>过程调用</td></tr> <tr><td>leave</td> <td>为返回准备栈</td></tr> <tr><td>ret</td> <td>从过程调用中返回</td></tr></tbody></table> <p>call 指令有一个目标，指明被调用过程起始的指令地址。同跳转一样，调用可以是直接的，也可以是间接的。在汇编代码中，直接调用的目标是一个标号，而间接调用的目标是 <code>*</code> 后面跟一个操作数指示符。</p> <p>call 指令的效果是将返回地址入栈，并跳转到被调用过程的起始处。返回地址是在程序中紧跟在 call 后面的那条指令的地址，这样当被调用过程返回时，执行会从此处继续。 ret 指令从栈中弹出地址，并跳转到这个位置。正确使用这条指令，可以使栈做好准备，栈指针要指向前面 call 指令存储返回地址的位置。</p> <h3 id="寄存器使用惯例"><a href="#寄存器使用惯例" class="header-anchor">#</a> 寄存器使用惯例</h3> <p>程序寄存器组是唯一能被所有过程共享的资源。虽然在给定时刻只能有一个过程是活动的，但是我们必须保证当一个过程（调用者）调用另一个过程（被调用者）时，被调用者不会覆盖某个调用者稍后会使用的寄存器的值。</p> <p>为此， IA32 采用了一组统一的寄存器使用惯例，所有的过程都必须遵守，包括程序库中的过程。</p> <p>%eax、%edx 和 %ecx 被划分为<strong>调用者保存寄存器</strong>。过程 P 调用 Q 时， Q 可以覆盖这些寄存器，而不会破坏任何 P 所需要的数据。</p> <p>%ebx、%esi 和 %edi 被划分为<strong>被调用者保存寄存器</strong>。这意味着 Q 必须在覆盖这些寄存器的值之前，先把它们保存到栈中，并在返回前恢复它们，因为 P  或某更高层次的过程可能会在今后的计算中需要这些值。</p> <p>此外，根据这里描述的惯例，必须保持寄存器 %ebp 和 %esp 。</p> <h3 id="过程示例"><a href="#过程示例" class="header-anchor">#</a> 过程示例</h3> <p>考虑下面中定义的 C 过程，其中函数 caller 包括一个对函数 swap_add 的调用。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">swap_add</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>xp<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>yp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">*</span>xp<span class="token punctuation">;</span>
    <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token operator">*</span>yp<span class="token punctuation">;</span>

    <span class="token operator">*</span>xp <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token operator">*</span>yp <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> arg1 <span class="token operator">=</span> <span class="token number">534</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> arg2 <span class="token operator">=</span> <span class="token number">1057</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token function">swap_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arg1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> diff <span class="token operator">=</span> arg1 <span class="token operator">-</span> arg2<span class="token punctuation">;</span>

    <span class="token keyword">return</span> sum <span class="token operator">*</span> diff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下图给出了 caller 调用函数 swap_add 之前和 swap_add 正在运行时的栈帧结构。有些指令访问的栈位置是相对于栈指针 %esp 的，而另一些访问的栈位置是相对于基地址指针 %ebp 的。这些偏移量由相对于这两个指针的线来表示。</p> <p><img src="/note-pages/assets/img/image-20220608103726323.51d37695.png" alt="image-20220608103726323"></p> <p>caller 的栈帧包括局部变量 arg1 和 arg2 的存储，其位置相对于帧指针是 -4 和 -8 。这些变量必须存在栈中，因为我们必须为它们生成地址。</p> <p>caller 编译过的代码：</p> <div class="language- extra-class"><pre class="language-text"><code>caller:
	pushl 	%ebp				# savo old %ebp
	movl 	%esp, %ebp 			# set %ebp as frame pointer
	subl 	$24, %esp 			# allocate 24 bytes on stack
	movl 	$534, -4(%ebp) 		# set arg1 to 534
	movl 	$1057, -8(%ebp)		# set arg2 to 1057
	leal	-8(%ebp), %eax 		# compute &amp;arg2
	movl	%eax, 4(%esp) 		# store on stack
	leal 	-4(%ebp), %eax		# compute &amp;arg1
	movl 	%eax, (%esp) 		# store on stack
	call 	swap_add 			# call the swap_add function
</code></pre></div><p>保存 %ebp 的一个副本，将 %ebp 设置为栈帧的开始位置。然后将栈指针减去 24，从而在栈上分配 24 个字节。将 arg1 和 arg2 初始化为 534 和 1057，计算 &amp;arg2 和 &amp;arg1 并存储到栈上，形成函数 swap_add 的参数。将参数存储到相对于栈指针偏移量 0 和 +4 的地方，待 swap_add 访问。然后调用 swap_add。</p> <p>分配给栈帧的 24 个字节中， 8 个用于局部变量，8 个用于向 swap_add 传递参数，还有 8 个未使用。</p> <p>swap_add 编译过的代码有三个部分：</p> <ul><li>“建立” 部分，初始化栈帧；</li> <li>“主体” 部分，执行过程的实际计算；</li> <li>“结束” 部分，恢复栈的状态，以及过程返回。</li></ul> <p>下面是 swap_add 的建立代码。在到达代码的这个部分之前， call 指令已经将返回地址压入栈中。</p> <div class="language- extra-class"><pre class="language-text"><code>swap_add:
	pushl 	%ebp				# save old %ebp
	movl 	%esp, %ebp			# set %ebp as frame pointer
	pushl 	%ebx				# save %ebx
</code></pre></div><p>函数 swap_add 需要用寄存器 %ebx作为临时存储。因为这是一个被调用者保存寄存器，它会将旧值压入栈中，这是栈帧建立的一部分。</p> <p>下面是 swap_add 的主体代码：</p> <div class="language- extra-class"><pre class="language-text"><code>	movl	8(%ebp), %edx 		# get xp
	movl	12(%ebp), %ecx		# get yp
	movl	(%edx), %ebx		# get x
	movl	(%ecx), %eax		# get y
	movl	%eax, (%edx)		# store y at xp
	movl	%ebx, (%ecx)		# store x at yp
	addl	%ebx, %eax			# return value = x + y
</code></pre></div><p>这段代码从 caller 的栈帧中取出它的参数。因为帧指针已经移动，参数的位置也从相对于 %esp 的旧值 +4 和 0 的位置移到了相对于 %ebp 的新值 +12 和 +8 的位置。</p> <p>变量 x 和 y 的和存放在寄存器 %eax 中作为返回值传递。</p> <p>下面是 swap_add 的结束代码：</p> <div class="language- extra-class"><pre class="language-text"><code>	popl	%ebx				# restore %ebx
	popl	%ebp				# restore %ebp
	ret							# return
</code></pre></div><p>这段代码恢复寄存器 %ebx 和 %ebp 的值，同时也重新设定栈指针使它指向存储的返回值，这样 ret 指令就可以将控制转移回 caller 。</p> <p>下面的 caller 中的代码紧跟在调用 swap_add 的指令后面：</p> <div class="language- extra-class"><pre class="language-text"><code>	movl	-4(%ebp), %edx
	subl	-8(%ebp), %edx
	imull	%edx, %eax
	leave
	ret
</code></pre></div><p>为了计算 diff，这段代码从栈中取出 arg1 和 arg2 的值，并将寄存器 %eax 当作从 swap_add 的返回值。可以观察到，leave 指令的使用在返回前，既重置了栈指针，也重置了帧指针。</p> <p>我们在代码示例中已经看到， GCC 产生的代码有时候会使用 leave 指令来释放栈帧，而有时会使用一个或者两个 popl 指令。两种方法都可行，对于哪一种更好 Intel 和 AMD 的指导意见也在不断变化。</p> <h3 id="递归过程"><a href="#递归过程" class="header-anchor">#</a> 递归过程</h3> <p>上文栈和链接惯例使得过程能够递归地调用它们自身。因为每个调用在栈中都有它自己的私有空间，多个未完成调用的局部变量不会相互影响。此外，栈的原则很自然地提供了适当的策略，当过程被调用时分配局部存储，当返回时释放存储。</p> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">rfact</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        result <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token function">rfact</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>rfact:
	pushl	%ebp				# save old %ebp
	movl	%esp, %ebp			# set %ebp as frame pointer
	pushl	%ebx				# save callee save register %ebx
	subl	$4, %esp			# allocate 4 bytes on stack
	movl	8(%ebp), %ebx		# get n
	movl	$1, %eax			# result = 1
	cmpl 	$1, %ebx			# compare n:1
	jle		.L53				# if n &lt;= 1, goto done
	leal	-1(%ebx), %eax 		# compute n - 1
	movl	%eax, (%esp)		# store at top of stack
	call	rfact				# call rfact(n - 1)
	imull	%ebx, %eax			# compute result = return value * n
.L53:							# done:
	addl	$4, %esp			# deallocate 4 bytes from stack
	popl	%ebx				# restore %ebx
	popl	%ebp				# restore %ebp
	ret							# return result
</code></pre></div><h2 id="_3-6-数组分配和访问"><a href="#_3-6-数组分配和访问" class="header-anchor">#</a> 3.6 数组分配和访问</h2> <h3 id="基本原则"><a href="#基本原则" class="header-anchor">#</a> 基本原则</h3> <p>T A[L]：type T，length L。</p> <ul><li>在内存中连续分配 L * sizeof(T) 个字节。</li> <li>标识符 A 可用于表示数组的首地址，也可以通过 Type T* 转换成数组首地址。</li></ul> <p>例如，假设 E 是一个 int 型的数组，并且我们想计算 E[i]，在此，E 的地址存放在寄存器 %edx 中，而 i 存放在寄存器 %ecx 中。然后，指令</p> <div class="language- extra-class"><pre class="language-text"><code>movl (&amp;edx, &amp;ecx, 4), &amp;eax
</code></pre></div><p>会执行地址计算 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>E</mi></msub><mo>+</mo><mn>4</mn><mi>i</mi></mrow><annotation encoding="application/x-tex">X_E+ 4i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord mathdefault">i</span></span></span></span></span>, 读这个存储器位置的值，并将结果存放到寄存器 %eax 中。允许的缩放因子 1、2、4 和 8 覆盖了所有基本简单数据类型的大小。</p> <h3 id="指针运算"><a href="#指针运算" class="header-anchor">#</a> 指针运算</h3> <p>C 语言允许对指针进行运算，而计算出来的值会根据该指针引用的数据类型的大小进行伸缩。也就是说，如果 p 是一个指向类型为 T 的数据的指针， p 的值为 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">x_p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span>，那么表达式 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>+</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">p+i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></span> 的值为 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub><mo>+</mo><mi>L</mi><mo>×</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">x_p+L\times i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></span> 。这里 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span></span> 是数据类型 T 的大小</p> <p>假设整型数组 E 的起始地址和整数索引 i 分别存放在寄存器 %edx 和 %ecx 中。一些与 E 有关的表达式：</p> <table><thead><tr><th>表达式</th> <th>类型</th> <th>值</th> <th>汇编代码</th></tr></thead> <tbody><tr><td>E</td> <td>int *</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>E</mi></msub></mrow><annotation encoding="application/x-tex">x_E</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></td> <td>movl %edx, %eax</td></tr> <tr><td>E[0]</td> <td>int</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo stretchy="false">[</mo><msub><mi>x</mi><mi>E</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">M[x_E]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></span></td> <td>movl (%edx), %eax</td></tr> <tr><td>E[i]</td> <td>int</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo stretchy="false">[</mo><msub><mi>x</mi><mi>E</mi></msub><mo>+</mo><mn>4</mn><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">M[x_E+4i]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mord mathdefault">i</span><span class="mclose">]</span></span></span></span></span></td> <td>movl (%edx, %ecx, 4) , %eax</td></tr> <tr><td>&amp;E[2]</td> <td>int *</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>E</mi></msub><mo>+</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">x_E+8</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span></span></td> <td>leal 8(%edx), %eax</td></tr> <tr><td>E+i-1</td> <td>int *</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>E</mi></msub><mo>+</mo><mn>4</mn><mi>i</mi><mo>−</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">x_E+4i-4</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span></span></td> <td>leal -4(%edx, %ecx, 4), %eax</td></tr> <tr><td>*(E + i - 3)</td> <td>int *</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>E</mi></msub><mo>+</mo><mn>4</mn><mi>i</mi><mo>−</mo><mn>12</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M(x_E+4i-12)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></td> <td>movl -12(%edx, %ecx, 4), %eax</td></tr> <tr><td>&amp;E[i] - E</td> <td>int</td> <td><span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></span></td> <td>movl %ecx, %eax</td></tr></tbody></table> <h3 id="嵌套数组"><a href="#嵌套数组" class="header-anchor">#</a> 嵌套数组</h3> <p>当我们创建数组的数组时，数组分配和引用的一般原则也是成立的。</p> <p>要访问多维数组的元素，编译器会以数组起始为基地址，偏移量为索引，产生计算期望的元素的偏移量，然后使用某种 MOV 指令。通常来说，对于一个数组声明：<code>T D[R][C]</code>，数组元素 D[i][j] 的存储器地址为  <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&amp;</mi><mi>D</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><msub><mi>x</mi><mi>D</mi></msub><mo>+</mo><mi>L</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">⋅</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\&amp;D[i][j] = x_D+L(C·i + j)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">&amp;</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span></span>。</p> <p>这里，<span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span></span> 是数据类型 T 以字节为单位的大小。</p> <p>作为一个示例，考虑的 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">5\times 3</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span></span> 的整型数组 A。假设 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">x_A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>、 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span></span> 和 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span></span> 分别位于相对于 %ebp 偏移量为 8 、 12 和 16 的地方。然后，可以用下面的代码将数组元素 A[i][j] 复制到寄存器 %eax 中：</p> <div class="language- extra-class"><pre class="language-text"><code>movl 12(%ebp), %eax				# get i
leal (%eax,%eax,2), %eax		# compute 3 * i
movl 16(%ebp), %edx				# get j
sall $2, %edx					# compute j * 4
addl 8(%ebp), %edx				# compute x_A + 4j
movl (%edx,%eax,4), %eax		# Read from M[x_A + 4(j + 3i)]
</code></pre></div><h2 id="_3-7-异质的数据结构"><a href="#_3-7-异质的数据结构" class="header-anchor">#</a> 3.7 异质的数据结构</h2> <h3 id="结构"><a href="#结构" class="header-anchor">#</a> 结构</h3> <p>C 语言的 struct 声明创建一个数据类型，将可能不同类型的对象聚合到一个对象中。结构的各个组成部分用名字来引用。结构的所有组成部分都存放在存储器中一段连续的区城内，而指向结构的指针就是结构第一个字节的地址。编译器维护关于每个结构类型的信息，指示每个字段 (field) 的字节偏移。它以这些偏移作为存储器引用指令中的位移，从而产生对结构元素的引用。</p> <p>举例：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">rec</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> j<span class="token punctuation">;</span>
    <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个结构有4 个字段 —— 2 个 4 字节 int、1 个由 3 个 4 字节 int 组成的数组和 1 个 4 字节的整型指针，总共是 24 个字节：</p> <p><img src="/note-pages/assets/img/image-20220608164852075.eaf55374.png" alt="image-20220608164852075"></p> <p>为访问结构的字段，编译器产生的代码要将结构的地址加上适当的偏移。例如，假设 <code>struct rec*</code> 类型的变量 r 放在寄存器 %edx 中。然后，下面的代码将元素 <code>r-&gt;i</code> 复制到元素 <code>r-&gt;j</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>movl 	(%edx), %eax			# get r -&gt; i
movl	%eax, 4(%edx) 			# store in r -&gt; j
</code></pre></div><p>要产生一个指向结构内部对象的指针，我们只需将结构的地址加上该字段的偏移量。例如，只要加上偏移量 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>+</mo><mn>4</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">8+4\times 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span>，就可以得到指针 <code>&amp;(r-&gt;a[i])</code>。对于在寄存器 %edx 中的指针 r 和在寄存器 %eax 中的整数变量 i，我们可以用一条指令产生指针 <code>&amp;(r-&gt;a[i])</code> 的值：</p> <div class="language- extra-class"><pre class="language-text"><code>leal 	8(%edx,%eax,4), %eax	# set %eax to &amp;r-&gt;a[i]
</code></pre></div><p>再举一个例子，下面的代码实现的是语句：<code>r-&gt;p = &amp;r-&gt;a[r-&gt;i + r-&gt;j]</code></p> <p>开始时 r 在寄存器 %edx 中：</p> <div class="language- extra-class"><pre class="language-text"><code>movl 	4(%edx), %eax 			# get r-&gt;j
addl 	(%edx), %eax 			# add r-&gt;i
leal 	8(%edx,%eax,4), %eax 	# compute &amp;r-&gt;a[r-&gt;i + r-&gt;j]
movl 	%eax, 20(%edx) 			# store in r-&gt;p
</code></pre></div><p>综上，结构的各个字段的选取完全是在编译时处理的。机器代码不包含关于字段声明或字段名字的信息。</p> <h3 id="联合"><a href="#联合" class="header-anchor">#</a> 联合</h3> <p>联合提供了一种方式，能够规避 C 语言的类型系统，允许以多种类型来引用一个对象。联合声明的语法与结构的语法一样，只不过语义相差比较大。它们是用不同的字段来引用相同的存储器块。</p> <p>当用联合将各种不同大小的数据类型结合到一起时，字节顺序问题就变得很重要了。例如，假设我们写了一个过程，它以两个 4 字节的 unsigned 的位的形式，创建一个 8 字节的 double:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">double</span> <span class="token function">bit2double</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> wordO<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> word1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">union</span> <span class="token punctuation">{</span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
        <span class="token keyword">unsigned</span> u<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> temp<span class="token punctuation">;</span>

    temp<span class="token punctuation">.</span>u<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordO<span class="token punctuation">;</span>
    temp<span class="token punctuation">.</span>u<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> word1<span class="token punctuation">;</span>
    <span class="token keyword">return</span> temp<span class="token punctuation">.</span>d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 IA32 这样的小端法机器上，参数 word0 是 d 的低位 4 个字节，而 word1 是高位 4 个字节。在大端法机器上，这两个参数的角色刚好相反。</p> <h3 id="数据对齐"><a href="#数据对齐" class="header-anchor">#</a> 数据对齐</h3> <p>许多计算机系统对基本数据类型合法地址做了一些限制，要求某种类型对象的地址必须是某个值 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span></span>（通常是 2、 4 或 8）的倍数。这种对齐限制简化了形成处理器和存储器系统之间接口的硬件设计。例如，假设一个处理器总是从存储器中取出 8 个字节，则地址必须为 8 的倍数。如果我们能保证将所有的 double 类型数据的地址对齐成 8 的倍数，那么就可以用一个存储器操作来读或者写值了。否则，我们可能需要执行两次存储器访问，因为对象可能被分放在两个 8 字节存储器块中。</p> <p>Linux 沿用的对齐策略是， 2 字节数据类型（例如 short）的地址必须是 2 的倍数，而较大的数据类型（例如 int 、int* 、float 和 double）的地址必须是 4 的倍数。注意，这意味着一个 short 类型对象的地址最低位必须等于 0。类似地，任何 int 类型的对象或指针的地址的最低两位必须都是 0 。</p> <p>分配存储器的库例程（例如 malloc）的设计必须使它们返回的指针满足运行机器最糟糕情况的对齐限制，通常是 4 或者 8。对于包含结构的代码，编译器可能需要在字段的分配中插入间隙，以保证每个结构元素都满足它的对齐要求。而结构本身对它的起始地址也有一些对齐要求。</p> <p>比如说，考虑下面的结构声明：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">S1</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token keyword">int</span> j<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>为了满足 i 和  j 的 4 字节对齐要求。编译器在字段 c 和 j 之间插入一个 3 字节的间隙（用阴影表示）：</p> <p><img src="/note-pages/assets/img/image-20220609164620905.727ef4bf.png" alt="image-20220609164620905"></p> <p>结果， j 的偏移量为 8，而整个结构的大小为 12 字节。此外，编译器必须保证任何 <code>struct S1*</code> 类型的指针 p 都满足 4 字节对齐。指针 p 的值 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">x_p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span> 必须是 4 的倍数。这保证了 <code>p-&gt;i</code> (地址 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">x_p</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span>）和 <code>p-&gt;j</code> (地址 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub><mo>+</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">x_p+8</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span></span>）都满足它们的 4 字节对齐要求。</p> <p>另外，编译器结构的末尾可能需要一些填充，这样结构数组中的每个元素都会满足它的对齐要求。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-pages/computer-systems/5de00f/" class="prev">
        第2章 信息的表示和处理
      </a></span> <span class="next"><a href="/note-pages/computer-systems/04-处理器体系结构.html">
        第4章 处理器体系结构
      </a>
      →
    </span></p></div> </main> <aside items="[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]" class="right-sidebar"><div style="margin-left:20px; margin-bottom: 10px; text-align: center; font-size:16px;font-weight:bold;">此页内容</div> <div class="right-sidebar-wrap"><ul class="right-sidebar-links"><li id="tab-item0" class="right-sidebar-item active"><a href="#_3-1-程序编码" class="right-sidebar-item-level2">
          3.1 程序编码
        </a></li><li id="tab-item1" class="right-sidebar-item"><a href="#计算机抽象模型" class="right-sidebar-item-level3">
          计算机抽象模型
        </a></li><li id="tab-item2" class="right-sidebar-item"><a href="#_3-2-访问信息" class="right-sidebar-item-level2">
          3.2 访问信息
        </a></li><li id="tab-item3" class="right-sidebar-item"><a href="#操作数指示符" class="right-sidebar-item-level3">
          操作数指示符
        </a></li><li id="tab-item4" class="right-sidebar-item"><a href="#数据传送指令" class="right-sidebar-item-level3">
          数据传送指令
        </a></li><li id="tab-item5" class="right-sidebar-item"><a href="#_3-3-算术和逻辑操作" class="right-sidebar-item-level2">
          3.3 算术和逻辑操作
        </a></li><li id="tab-item6" class="right-sidebar-item"><a href="#双操作数指令" class="right-sidebar-item-level3">
          双操作数指令
        </a></li><li id="tab-item7" class="right-sidebar-item"><a href="#单操作数指令" class="right-sidebar-item-level3">
          单操作数指令
        </a></li><li id="tab-item8" class="right-sidebar-item"><a href="#算术指令示例" class="right-sidebar-item-level3">
          算术指令示例
        </a></li><li id="tab-item9" class="right-sidebar-item"><a href="#特殊算术操作" class="right-sidebar-item-level3">
          特殊算术操作
        </a></li><li id="tab-item10" class="right-sidebar-item"><a href="#_3-4-控制" class="right-sidebar-item-level2">
          3.4 控制
        </a></li><li id="tab-item11" class="right-sidebar-item"><a href="#条件码" class="right-sidebar-item-level3">
          条件码
        </a></li><li id="tab-item12" class="right-sidebar-item"><a href="#翻译条件分支" class="right-sidebar-item-level3">
          翻译条件分支
        </a></li><li id="tab-item13" class="right-sidebar-item"><a href="#循环" class="right-sidebar-item-level3">
          循环
        </a></li><li id="tab-item14" class="right-sidebar-item"><a href="#条件传送指令" class="right-sidebar-item-level3">
          条件传送指令
        </a></li><li id="tab-item15" class="right-sidebar-item"><a href="#switch-语句" class="right-sidebar-item-level3">
          switch 语句
        </a></li><li id="tab-item16" class="right-sidebar-item"><a href="#_3-5-过程" class="right-sidebar-item-level2">
          3.5 过程
        </a></li><li id="tab-item17" class="right-sidebar-item"><a href="#栈帧结构" class="right-sidebar-item-level3">
          栈帧结构
        </a></li><li id="tab-item18" class="right-sidebar-item"><a href="#转移控制" class="right-sidebar-item-level3">
          转移控制
        </a></li><li id="tab-item19" class="right-sidebar-item"><a href="#寄存器使用惯例" class="right-sidebar-item-level3">
          寄存器使用惯例
        </a></li><li id="tab-item20" class="right-sidebar-item"><a href="#过程示例" class="right-sidebar-item-level3">
          过程示例
        </a></li><li id="tab-item21" class="right-sidebar-item"><a href="#递归过程" class="right-sidebar-item-level3">
          递归过程
        </a></li><li id="tab-item22" class="right-sidebar-item"><a href="#_3-6-数组分配和访问" class="right-sidebar-item-level2">
          3.6 数组分配和访问
        </a></li><li id="tab-item23" class="right-sidebar-item"><a href="#基本原则" class="right-sidebar-item-level3">
          基本原则
        </a></li><li id="tab-item24" class="right-sidebar-item"><a href="#指针运算" class="right-sidebar-item-level3">
          指针运算
        </a></li><li id="tab-item25" class="right-sidebar-item"><a href="#嵌套数组" class="right-sidebar-item-level3">
          嵌套数组
        </a></li><li id="tab-item26" class="right-sidebar-item"><a href="#_3-7-异质的数据结构" class="right-sidebar-item-level2">
          3.7 异质的数据结构
        </a></li><li id="tab-item27" class="right-sidebar-item"><a href="#结构" class="right-sidebar-item-level3">
          结构
        </a></li><li id="tab-item28" class="right-sidebar-item"><a href="#联合" class="right-sidebar-item-level3">
          联合
        </a></li><li id="tab-item29" class="right-sidebar-item"><a href="#数据对齐" class="right-sidebar-item-level3">
          数据对齐
        </a></li></ul></div></aside></div><div class="global-ui"></div></div>
    <script src="/note-pages/assets/js/app.05dcbd87.js" defer></script><script src="/note-pages/assets/js/3.4a2f67fd.js" defer></script><script src="/note-pages/assets/js/2.ab82720e.js" defer></script><script src="/note-pages/assets/js/27.ca60e875.js" defer></script>
  </body>
</html>
