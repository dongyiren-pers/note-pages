<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置管理 | 后端技术栈笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/jquery/3.4.0/jquery.min.js"></script>
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" href="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">
    <meta name="description" content="BackEnd Notes">
    
    <link rel="preload" href="/note-pages/assets/css/0.styles.167a34c7.css" as="style"><link rel="preload" href="/note-pages/assets/js/app.05dcbd87.js" as="script"><link rel="preload" href="/note-pages/assets/js/3.4a2f67fd.js" as="script"><link rel="preload" href="/note-pages/assets/js/2.ab82720e.js" as="script"><link rel="preload" href="/note-pages/assets/js/17.9daf0c47.js" as="script"><link rel="prefetch" href="/note-pages/assets/js/10.e11a80d9.js"><link rel="prefetch" href="/note-pages/assets/js/100.489cf69a.js"><link rel="prefetch" href="/note-pages/assets/js/101.560e37ea.js"><link rel="prefetch" href="/note-pages/assets/js/102.baaa4f6a.js"><link rel="prefetch" href="/note-pages/assets/js/103.262b6423.js"><link rel="prefetch" href="/note-pages/assets/js/104.ac33d7ce.js"><link rel="prefetch" href="/note-pages/assets/js/105.5e6ce18f.js"><link rel="prefetch" href="/note-pages/assets/js/106.a69322ef.js"><link rel="prefetch" href="/note-pages/assets/js/107.6cdb78ee.js"><link rel="prefetch" href="/note-pages/assets/js/108.1d720289.js"><link rel="prefetch" href="/note-pages/assets/js/109.58f7297c.js"><link rel="prefetch" href="/note-pages/assets/js/11.241a46da.js"><link rel="prefetch" href="/note-pages/assets/js/110.9cef761d.js"><link rel="prefetch" href="/note-pages/assets/js/111.c782138c.js"><link rel="prefetch" href="/note-pages/assets/js/112.40cb3b1a.js"><link rel="prefetch" href="/note-pages/assets/js/113.c367e40a.js"><link rel="prefetch" href="/note-pages/assets/js/114.a4a75db5.js"><link rel="prefetch" href="/note-pages/assets/js/115.a73cd469.js"><link rel="prefetch" href="/note-pages/assets/js/116.ad853155.js"><link rel="prefetch" href="/note-pages/assets/js/117.a82b2649.js"><link rel="prefetch" href="/note-pages/assets/js/118.8f896dd0.js"><link rel="prefetch" href="/note-pages/assets/js/119.374482b1.js"><link rel="prefetch" href="/note-pages/assets/js/12.ebe220d5.js"><link rel="prefetch" href="/note-pages/assets/js/120.89698284.js"><link rel="prefetch" href="/note-pages/assets/js/121.cbe50685.js"><link rel="prefetch" href="/note-pages/assets/js/122.7de2ac51.js"><link rel="prefetch" href="/note-pages/assets/js/123.a2d16009.js"><link rel="prefetch" href="/note-pages/assets/js/124.e1ba7cbe.js"><link rel="prefetch" href="/note-pages/assets/js/125.4e1e6d6a.js"><link rel="prefetch" href="/note-pages/assets/js/126.3db22af3.js"><link rel="prefetch" href="/note-pages/assets/js/127.937f4ffc.js"><link rel="prefetch" href="/note-pages/assets/js/128.0bad2e20.js"><link rel="prefetch" href="/note-pages/assets/js/129.75a99d25.js"><link rel="prefetch" href="/note-pages/assets/js/13.5ee7bef5.js"><link rel="prefetch" href="/note-pages/assets/js/130.599b6d3d.js"><link rel="prefetch" href="/note-pages/assets/js/131.687214bf.js"><link rel="prefetch" href="/note-pages/assets/js/132.8295c067.js"><link rel="prefetch" href="/note-pages/assets/js/133.854d61c0.js"><link rel="prefetch" href="/note-pages/assets/js/134.f3fc20e1.js"><link rel="prefetch" href="/note-pages/assets/js/135.2a5a690d.js"><link rel="prefetch" href="/note-pages/assets/js/136.6ba30378.js"><link rel="prefetch" href="/note-pages/assets/js/137.80d7c511.js"><link rel="prefetch" href="/note-pages/assets/js/138.0a25898e.js"><link rel="prefetch" href="/note-pages/assets/js/139.fb3c377f.js"><link rel="prefetch" href="/note-pages/assets/js/14.a561f8b3.js"><link rel="prefetch" href="/note-pages/assets/js/140.cbfdbe32.js"><link rel="prefetch" href="/note-pages/assets/js/141.c09f054f.js"><link rel="prefetch" href="/note-pages/assets/js/142.723bd973.js"><link rel="prefetch" href="/note-pages/assets/js/143.b31785f9.js"><link rel="prefetch" href="/note-pages/assets/js/144.69d3d121.js"><link rel="prefetch" href="/note-pages/assets/js/145.c4ee6aa0.js"><link rel="prefetch" href="/note-pages/assets/js/146.7f836a1c.js"><link rel="prefetch" href="/note-pages/assets/js/147.d4a57976.js"><link rel="prefetch" href="/note-pages/assets/js/148.b15e75eb.js"><link rel="prefetch" href="/note-pages/assets/js/149.94085ddc.js"><link rel="prefetch" href="/note-pages/assets/js/15.4ed118f1.js"><link rel="prefetch" href="/note-pages/assets/js/150.6751d41b.js"><link rel="prefetch" href="/note-pages/assets/js/151.bd60e322.js"><link rel="prefetch" href="/note-pages/assets/js/152.15caf78f.js"><link rel="prefetch" href="/note-pages/assets/js/153.131128fc.js"><link rel="prefetch" href="/note-pages/assets/js/154.b8ee2e7d.js"><link rel="prefetch" href="/note-pages/assets/js/155.8fa1e2e0.js"><link rel="prefetch" href="/note-pages/assets/js/156.25e2a796.js"><link rel="prefetch" href="/note-pages/assets/js/157.7137c9c3.js"><link rel="prefetch" href="/note-pages/assets/js/158.fdc18c40.js"><link rel="prefetch" href="/note-pages/assets/js/159.0dadb745.js"><link rel="prefetch" href="/note-pages/assets/js/16.818fc8bf.js"><link rel="prefetch" href="/note-pages/assets/js/160.05f7541c.js"><link rel="prefetch" href="/note-pages/assets/js/161.2a8c62a2.js"><link rel="prefetch" href="/note-pages/assets/js/162.5b9983b7.js"><link rel="prefetch" href="/note-pages/assets/js/163.b51a5538.js"><link rel="prefetch" href="/note-pages/assets/js/164.06c9f20a.js"><link rel="prefetch" href="/note-pages/assets/js/165.c25063f4.js"><link rel="prefetch" href="/note-pages/assets/js/166.6c570da5.js"><link rel="prefetch" href="/note-pages/assets/js/167.12fb6fb6.js"><link rel="prefetch" href="/note-pages/assets/js/168.d7dd27bc.js"><link rel="prefetch" href="/note-pages/assets/js/169.27f575fe.js"><link rel="prefetch" href="/note-pages/assets/js/170.ba4295ef.js"><link rel="prefetch" href="/note-pages/assets/js/171.3fb54078.js"><link rel="prefetch" href="/note-pages/assets/js/18.086ed162.js"><link rel="prefetch" href="/note-pages/assets/js/19.adca670c.js"><link rel="prefetch" href="/note-pages/assets/js/20.2e9ff004.js"><link rel="prefetch" href="/note-pages/assets/js/21.07830947.js"><link rel="prefetch" href="/note-pages/assets/js/22.609929cb.js"><link rel="prefetch" href="/note-pages/assets/js/23.d83b832f.js"><link rel="prefetch" href="/note-pages/assets/js/24.592e8014.js"><link rel="prefetch" href="/note-pages/assets/js/25.9d28bb6f.js"><link rel="prefetch" href="/note-pages/assets/js/26.fd4195d5.js"><link rel="prefetch" href="/note-pages/assets/js/27.ca60e875.js"><link rel="prefetch" href="/note-pages/assets/js/28.c2cd75e6.js"><link rel="prefetch" href="/note-pages/assets/js/29.4213d132.js"><link rel="prefetch" href="/note-pages/assets/js/30.c6ee0ead.js"><link rel="prefetch" href="/note-pages/assets/js/31.eea6a542.js"><link rel="prefetch" href="/note-pages/assets/js/32.1ffdceaf.js"><link rel="prefetch" href="/note-pages/assets/js/33.0425748b.js"><link rel="prefetch" href="/note-pages/assets/js/34.5dd0d81d.js"><link rel="prefetch" href="/note-pages/assets/js/35.773df14e.js"><link rel="prefetch" href="/note-pages/assets/js/36.5db32ea2.js"><link rel="prefetch" href="/note-pages/assets/js/37.1106162c.js"><link rel="prefetch" href="/note-pages/assets/js/38.793ba7d0.js"><link rel="prefetch" href="/note-pages/assets/js/39.488fb9a5.js"><link rel="prefetch" href="/note-pages/assets/js/4.550e6883.js"><link rel="prefetch" href="/note-pages/assets/js/40.9c05b0ae.js"><link rel="prefetch" href="/note-pages/assets/js/41.ae198526.js"><link rel="prefetch" href="/note-pages/assets/js/42.d815456e.js"><link rel="prefetch" href="/note-pages/assets/js/43.1808aff8.js"><link rel="prefetch" href="/note-pages/assets/js/44.c26d9bde.js"><link rel="prefetch" href="/note-pages/assets/js/45.fae5f755.js"><link rel="prefetch" href="/note-pages/assets/js/46.703057c9.js"><link rel="prefetch" href="/note-pages/assets/js/47.ed3a23ce.js"><link rel="prefetch" href="/note-pages/assets/js/48.c5a46ee8.js"><link rel="prefetch" href="/note-pages/assets/js/49.b04c1681.js"><link rel="prefetch" href="/note-pages/assets/js/5.869d288f.js"><link rel="prefetch" href="/note-pages/assets/js/50.249fc2a7.js"><link rel="prefetch" href="/note-pages/assets/js/51.cab74632.js"><link rel="prefetch" href="/note-pages/assets/js/52.e2f231b3.js"><link rel="prefetch" href="/note-pages/assets/js/53.6241e308.js"><link rel="prefetch" href="/note-pages/assets/js/54.7d29c5c0.js"><link rel="prefetch" href="/note-pages/assets/js/55.a9050f95.js"><link rel="prefetch" href="/note-pages/assets/js/56.75828a09.js"><link rel="prefetch" href="/note-pages/assets/js/57.b3f75d67.js"><link rel="prefetch" href="/note-pages/assets/js/58.0cf3bd1c.js"><link rel="prefetch" href="/note-pages/assets/js/59.19f18f1f.js"><link rel="prefetch" href="/note-pages/assets/js/6.d879438f.js"><link rel="prefetch" href="/note-pages/assets/js/60.61940d92.js"><link rel="prefetch" href="/note-pages/assets/js/61.bc890bb0.js"><link rel="prefetch" href="/note-pages/assets/js/62.f487437c.js"><link rel="prefetch" href="/note-pages/assets/js/63.4a91369b.js"><link rel="prefetch" href="/note-pages/assets/js/64.1b0770e4.js"><link rel="prefetch" href="/note-pages/assets/js/65.b56e2b22.js"><link rel="prefetch" href="/note-pages/assets/js/66.dd49594c.js"><link rel="prefetch" href="/note-pages/assets/js/67.22efede4.js"><link rel="prefetch" href="/note-pages/assets/js/68.0d22a8a4.js"><link rel="prefetch" href="/note-pages/assets/js/69.aec9bfeb.js"><link rel="prefetch" href="/note-pages/assets/js/7.e3626849.js"><link rel="prefetch" href="/note-pages/assets/js/70.0c53c20d.js"><link rel="prefetch" href="/note-pages/assets/js/71.6d6db7d6.js"><link rel="prefetch" href="/note-pages/assets/js/72.fdcfb985.js"><link rel="prefetch" href="/note-pages/assets/js/73.a390b48d.js"><link rel="prefetch" href="/note-pages/assets/js/74.e817987f.js"><link rel="prefetch" href="/note-pages/assets/js/75.f144cf4f.js"><link rel="prefetch" href="/note-pages/assets/js/76.7be2f5f1.js"><link rel="prefetch" href="/note-pages/assets/js/77.6568d596.js"><link rel="prefetch" href="/note-pages/assets/js/78.4ff63ca8.js"><link rel="prefetch" href="/note-pages/assets/js/79.daaf791e.js"><link rel="prefetch" href="/note-pages/assets/js/8.f9f716a1.js"><link rel="prefetch" href="/note-pages/assets/js/80.a0605696.js"><link rel="prefetch" href="/note-pages/assets/js/81.ecb125f5.js"><link rel="prefetch" href="/note-pages/assets/js/82.b64b1c42.js"><link rel="prefetch" href="/note-pages/assets/js/83.d13b7f19.js"><link rel="prefetch" href="/note-pages/assets/js/84.c584da75.js"><link rel="prefetch" href="/note-pages/assets/js/85.7992353f.js"><link rel="prefetch" href="/note-pages/assets/js/86.17ad6399.js"><link rel="prefetch" href="/note-pages/assets/js/87.289f9f2f.js"><link rel="prefetch" href="/note-pages/assets/js/88.3496d6e2.js"><link rel="prefetch" href="/note-pages/assets/js/89.0d0c778d.js"><link rel="prefetch" href="/note-pages/assets/js/9.3209071f.js"><link rel="prefetch" href="/note-pages/assets/js/90.245b9fda.js"><link rel="prefetch" href="/note-pages/assets/js/91.806af5f2.js"><link rel="prefetch" href="/note-pages/assets/js/92.8a10f401.js"><link rel="prefetch" href="/note-pages/assets/js/93.ea90ae18.js"><link rel="prefetch" href="/note-pages/assets/js/94.98cc66ef.js"><link rel="prefetch" href="/note-pages/assets/js/95.836e96c5.js"><link rel="prefetch" href="/note-pages/assets/js/96.d4dd3eee.js"><link rel="prefetch" href="/note-pages/assets/js/97.e4275cb9.js"><link rel="prefetch" href="/note-pages/assets/js/98.0e320d92.js"><link rel="prefetch" href="/note-pages/assets/js/99.e6f77650.js">
    <link rel="stylesheet" href="/note-pages/assets/css/0.styles.167a34c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-pages/" class="home-link router-link-active"><!----> <span class="site-name">后端技术栈笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link router-link-active">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link router-link-active">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring 的核心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web 中的 Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>云原生 Spring</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note-pages/spring/云原生Spring/服务发现.html" class="sidebar-link">服务发现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/服务发现.html#深入思考微服务" class="sidebar-link">深入思考微服务</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/服务发现.html#配置服务注册" class="sidebar-link">配置服务注册</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/服务发现.html#注册并发现服务" class="sidebar-link">注册并发现服务</a></li></ul></li><li><a href="/note-pages/spring/云原生Spring/配置管理.html" class="active sidebar-link">配置管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/配置管理.html#独立配置和集中式配置" class="sidebar-link">独立配置和集中式配置</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/配置管理.html#运行配置服务器" class="sidebar-link">运行配置服务器</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/配置管理.html#消费共享的配置" class="sidebar-link">消费共享的配置</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/配置管理.html#消费特定的配置" class="sidebar-link">消费特定的配置</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/配置管理.html#为配置的属性加密" class="sidebar-link">为配置的属性加密</a></li><li class="sidebar-sub-header"><a href="/note-pages/spring/云原生Spring/配置管理.html#远程刷新配置属性" class="sidebar-link">远程刷新配置属性</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring 揭秘</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="配置管理"><a href="#配置管理" class="header-anchor">#</a> 配置管理</h1> <p>许多应用程序都有某种形式的配置。通常，你设置的属性对于应用程序可能是唯一的，并且很容易在 <code>application.properties</code> 或 <code>application.yml</code> 中指定。</p> <p>然而，当应用程序采用微服务架构时，配置的属性通常在多个服务中是通用的。就像以前那样单调乏味的、重复手工填写表单很容易出错一样，重复配置多个相同服务可能会产生一些错误。</p> <p>在本章中，我们将介绍 Spring Cloud Config Server，它是为给定应用中的所有服务，提供集中配置服务的。通过 Config Server，你可以在一个地方管理应用程序的所有配置，而不需要手工复制配置。</p> <p>在开始之前，让我们简单地考虑一下，独立配置微服务的不足，以及集中式配置的优点。</p> <h2 id="独立配置和集中式配置"><a href="#独立配置和集中式配置" class="header-anchor">#</a> 独立配置和集中式配置</h2> <p>你可以在几个不同的属性配置来源中，通过设置具体属性字段来配置 Spring 应用程序。如果配置的属性需要更改，或在不同运行时环境有不同值，使用 Java 系统属性或操作系统的环境变量，是比较合适的。对于不太可能改变的属性，或特定于应用程序的值，将这些属性放置在 <code>application.properties</code> 或 <code>application.yml</code> 中，然后与应用程序一起打包部署，也是个不错的选择。</p> <p>对于简单的应用程序，这些选择是可以的。但是当设置系统环境变量或 Java 系统属性时，你必须接受：要更改这些属性将需要重新启动应用程序。如果你选择将属性配置打包到 JAR 或 WAR 文件中，一旦这些属性需要更改，则必须重新打包部署应用程序。如果你需要回滚对配置的更改，也会受到上述约束。</p> <p>这些限制在某些应用中是可以接受的。在其他情况下，仅仅为了更改一个简单的属性而重启应用程序，是不方便的，也是有缺陷的。此外，在微服务架构的应用程序中，属性管理分布在多个代码库和部署实例中，使得要在多个服务的每个实例中，重复进行相同的更改是不合理的。</p> <p>某些属性还可能是敏感信息，例如：数据库密码和其他类型的机密值。尽管这些值在写入单个应用程序属性时可以加密，但应用程序在能够被调用前必须包含解密能力。即使这样，有些属性可能需要对应用程序开发人员保密，因此在环境变量中设置它们，或者使用与其他程序相同的版本控制系统来管理它们，都是非常不可取的。</p> <p>相反，在集中式配置管理时，请考虑这些场景是如何运行的：</p> <ul><li>配置不再与应用程序代码一起打包和部署，使更改或回滚配置成为可能，而无需重建或重新部署应用程序。配置可以随时更改，而无需重新启动应用程序。</li> <li>共享公共配置的微服务不需要管理自己的配置副本，可以共享相同的属性。如果需要更改属性，可以在单个位置修改，修改会适用于所有微服务。</li> <li>敏感配置信息可以加密，并与应用程序代码解耦。未加密的值可以按需提供给应用程序，而不是要求应用程序携带解密代码。</li></ul> <p>Spring Cloud Config Server 提供了一个集中式配置服务，让微服务可以依赖于它们。因为它是集中式、一站式配置，在所有服务中都能用，而且也能够提供特定于服务的单独配置。</p> <h2 id="运行配置服务器"><a href="#运行配置服务器" class="header-anchor">#</a> 运行配置服务器</h2> <p>Spring Cloud Config Server 为配置数据提供了一个集中存储的地方。像 Eureka 那样，Config Server 可以被认为只是一个微服务，它在更大的应用程序中扮演的角色是，为其他服务提供配置数据服务。</p> <p>Config Server 公开了一个 REST API，客户端（也就是其他微服务）可以通过 API 使用配置服务。Config Server 提供的配置信息存储在服务外部，通常位于版本控制系统中，如 Git。</p> <p><img src="/note-pages/assets/img/image-20221227161224624.ecb9c5d7.png" alt="image-20221227161224624"></p> <p>通过将配置存储在代码版本控制系统（如 Git）中，配置可以进行版本控制、分支、标记、还原和追责，就像管理应用程序源代码一样。通过把配置与使用它的服务分离，配置就可以独立于应用程序进行修改和版本控制。</p> <p>你可能还注意到上图中包含 HashiCorp Vault。保险库（Vault）非常有用，特别是在你希望提供的配置属性完全保密，直到需要时才放开的情况。</p> <h3 id="启动配置服务器"><a href="#启动配置服务器" class="header-anchor">#</a> 启动配置服务器</h3> <p>作为一个更大的应用系统中的一个微服务，Config Server 被部署为一个独立的应用。因此，需要为 Config Server 新建一个工程。最简单的方法是，使用 Spring Initializr 或其他客户端（例如 Spring Tool Suite 中的 New Spring Starter Project 向导）。</p> <p>将新项目命名为“config-server”。最重要的事情是，通过选中 Config Server 复选框来指定 Config Server 依赖关系。这将导致以下内容被添加到生成项目的 pom.xm 文件中：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Config Server 的版本最终由 Spring Cloud 发布系列版本决定。这个值是必须在 pom.xml 文件中配置的。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>Finchley.SR1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

...

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>尽管 Config Server 依赖项将 Spring Cloud 添加到了项目的类路径中，但这不会通过自动配置来启用它。你需要对配置类添加 <code>@EnableConfigServer</code> 注解。顾名思义，此注解用来启用 Config Server。我通常只在主类上添加 <code>@EnableConfigServer</code>，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableConfigServer</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigServerApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConfigServerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在启动应用程序之前，只需再做一件事：你必须告诉它，那些它要提供服务的配置属性在哪里可以找到。首先，要使用 Git 存储库提供的配置，需要在 <code>spring.cloud.config.server.git.uri</code> 属性中，设置配置存储库的 URL ：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/tacocloud/tacocloud<span class="token punctuation">-</span>config
</code></pre></div><p>你将在下一节中看到如何用属性填充 Git 存储库。</p> <p>不过，你可能还需要为本地开发环境设置另一个属性。在本地测试你的服务时，最终将在本地主机的不同端口上运行多个服务。作为一个典型的 Spring Boot 应用程序，在默认情况下，Config Server 将侦听端口 8080。为了避免端口冲突，你可以设置 <code>server.port</code> 属性:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span>
</code></pre></div><p>这里把服务端口设为 8888，因为这是配置客户端尝试检索配置的默认端口。你可以将其设置为任何其他值，但你需要确保，配置客户端使用相同的端口来获取配置。</p> <p>重要的是要认识到，到目前为止你在本节中编写的配置，是 Config Server 本身的配置。这些配置属性不是 Config Server 提供给其他服务的。Config Server 将提供的是它从 Git 或 Vault 拉取的配置。</p> <p>此时，如果启动应用程序，Config Server 会侦听 8888 端口的请求，但它不会提供任何配置属性。虽然你还没有任何配置服务客户端，但可以使用 curl 命令行（或你选择的等效 HTTP 工具）发送请求：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:8888/application/default
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;application&quot;</span>,
  <span class="token string">&quot;profiles&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;default&quot;</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;label&quot;</span><span class="token builtin class-name">:</span> null,
  <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ca791b15df07ce41d30c24937eece4ec4b208f4d&quot;</span>,
  <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> null,
  <span class="token string">&quot;propertySources&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里是使用 HTTP GET 请求，对 Config Server 上的 <code>/application/default</code> 路径发送请求。此路径由两个或三个部分组成，如图所示：</p> <p><img src="/note-pages/assets/img/image-20221227165908445.b42e9ce5.png" alt="image-20221227165908445"></p> <p>路径的第一部分 <code>application</code> 表示，发送请求的应用程序的名称。</p> <p>路径的第二部分表示，发送请求的应用程序当前正在使用的 <code>profile</code> 名称。</p> <p>路径的第三部分（可选）表示，从后端 Git 存储库获取配置的标签或分支名称。如果未指定，则默认为 <code>master</code> 分支。</p> <p>这个请求的响应值会给我们一些关于 Conffig Server 服务的基本信息，包括它后面配置的 Git 提交的版本和标签。当然，现在明显缺少任何实际的配置属性。正常情况下，你可以在 <code>propertySources</code> 属性中看到它们，但是现在这个属性是空的。这是因为还没有用实际属性填充 Git 存储库。</p> <h3 id="填写配置库"><a href="#填写配置库" class="header-anchor">#</a> 填写配置库</h3> <p>Config Server 提供服务的属性资源，有几种方法可以进行设置。最基本、简单的选择是，提交 <code>application.properties</code> 或 <code>application.yml</code>到 Git 存储库的根路径。</p> <p>假设推送了一个名为 <code>application.yml</code> 的文件到 Git 存储库中。这个配置文件与上一节中的配置不同，它是将由 Config Server 来提供配置服务的。假设在 <code>application.yml</code> 中配置了以下属性：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka1<span class="token punctuation">:</span>8761/eureka/
</code></pre></div><p>虽然 <code>application.yml</code> 中的属性不多，但它所做的配置是相当重要的。<code>application.yml</code> 告诉应用程序中的每个服务两个重要信息：一个是 Eureka 的注册地址，另一个是随机选择可用端口。这意味着，当调整服务以适配使用 Config Server 时，你可以在服务中删除 Eureka 的配置了。</p> <p>作为 Config Server 的客户机，可以在命令行中使用 curl 查看 Config Server 提供的新配置数据：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:8888/someapp/someconfig
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;someapp&quot;</span>,
  <span class="token string">&quot;profiles&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;someconfig&quot;</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;label&quot;</span><span class="token builtin class-name">:</span> null,
  <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;95df0cbc3bca106199bd804b27a1de7c3ef5c35e&quot;</span>,
  <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> null,
  <span class="token string">&quot;propertySources&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;http://localhost:10080/habuma/tacocloudconfig/application.yml&quot;</span>,
      <span class="token string">&quot;source&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;server.port&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;eureka.client.service-url.defaultZone&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;http://eureka1:8761/eureka/&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>属性 <code>propertySources</code> 数组中，<code>name</code> 属性指明引用的 Git 存储库，<code>source</code> 属性包含推入 Git 存储库的那些具体属性。</p> <div class="subtitle"><p>在 Git 子路径存储配置</p></div><p>依据你的实际情况，你可以选择将配置存储在 Git 存储库子路径而不是根路径中。例如，假设你要将配置存储在名为 “config” 的子目录中，你需对 <code>spring.cloud.config.server.git.search-paths</code> 属性进行设置，以告诉 Config Server 从 <code>/config</code> 而不是从根目录获取配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span> config
</code></pre></div><p>请注意 <code>spring.cloud.config.server.git.search-paths</code> 可设置多个值。你可以设置用逗号分隔的多个路径，以便让 Config Server 从多个路径中获取属性配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span> config<span class="token punctuation">,</span>moreConfig
</code></pre></div><p>这将设置 Config Server 从 <code>/config</code> 和 <code>/moreConfig</code> 中获取配置。</p> <p>指定搜索路径时，可以使用通配符：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
          <span class="token key atrule">search-paths</span><span class="token punctuation">:</span> config<span class="token punctuation">,</span>more*
</code></pre></div><p>在这里，Config Server 将从 <code>/config</code> 以及任何名称以 <code>more</code> 开头的子目录中获取配置。</p> <div class="subtitle"><p>从分支或标签获取配置</p></div><p>默认情况下，Config Server 从 Git 的 <code>master</code> 分支获取配置。从客户机上发送请求时，可以指定特定分支或标签。但你可能会发现，修改 Config Server 的默认行为，改为从某个特定 Git 标签或分支获取配置，可能会很有用。这可以在 <code>spring.cloud.config.server.git.default-label</code> 属性中指定具体分支或标签，以覆盖默认值。</p> <p>例如，以下设置将 Config Server 设为从“sidework” 的分支（或标签）中获取配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
          <span class="token key atrule">default-label</span><span class="token punctuation">:</span> sidework
</code></pre></div><p>配置将从“sidework” 分支获取，除非客户端在请求中指定了其他分支。</p> <div class="subtitle"><p>Git 存储库的授权校验</p></div><p>Config Server 使用的 Git 存储库，很可能需要使用用户名和密码进行权限验证。那样的话，你就需要为 Config Server 指定 Git 存储库的身份凭据信息。</p> <p>属性 <code>spring.cloud.config.server.git.username</code> 以及 <code>spring.cloud.config.server.git.password</code> 可以设置 Git 存储库的用户名和密码。如下配置展示了如何设置这些属性：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
          <span class="token key atrule">username</span><span class="token punctuation">:</span> tacocloud
          <span class="token key atrule">password</span><span class="token punctuation">:</span> s3cr3tP455w0rd
</code></pre></div><h2 id="消费共享的配置"><a href="#消费共享的配置" class="header-anchor">#</a> 消费共享的配置</h2> <p>Spring Cloud Config server 还提供了一个客户端库。只要 Spring Boot 应用程序中包含这个库，就可以作为 Config Server 的客户端。将一个 Spring Boot 应用程序转换为 Config Server 客户端的最简单方法是，将以下依赖项添加到项目的 Maven 依赖中：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用 Spring Initializr 中也可添加此依赖项，只需勾选 <code>Config Client</code> 复选框。应用程序运行时自动配置将启动，会自动指定属性来源，以便从 Config Server 中获取属性。默认情况下，会假设 Config Server 正在本地主机上运行，并侦听端口 8888。 如果不是这样，可以通过设置 <code>spring.cloud.config.uri</code> 属性，来配置 Config Server 的位置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//config.tacocloud.com<span class="token punctuation">:</span><span class="token number">8888</span>
</code></pre></div><p>需要澄清一点，这个属性必须设置在，要成为 Config Server 客户端的应用程序的本地。比如在 <code>application.yml</code> 或者 <code>application.properties</code> 文件中，并与微服务一起打包和部署。</p> <p>现在你有了一个集中式的 Config Server，几乎所有的配置都将从那里得到。每个微服务不需要携带太多自己的配置。通常，你只需设置 <code>spring.cloud.config.uri</code> 来指定 Config Server 的位置，以及 <code>spring.application.name</code> 让 Config Server 进行应用识别。</p> <p>当应用程序启动时，Config Server 客户端指定属性源，并向 Config Server 发出请求。不管它收到什么属性，都会设置到应用程序环境变量中。更重要的是，这些属性将被缓存；即使 Config Server 关闭了，它们也可用。</p> <h2 id="消费特定的配置"><a href="#消费特定的配置" class="header-anchor">#</a> 消费特定的配置</h2> <p>到目前为止，你让 Config Server 提供的配置还相当简单，这些配置指定给所有微服务。但有时你需要对某个应用程序启用特定配置，或者只有在应用程序使用特定的 profile 时才有效。让我们再来看看 Config Server 更多的使用方式，看看如何提供特定于应用程序或 profile 的配置。</p> <h3 id="特定于应用程序的属性"><a href="#特定于应用程序的属性" class="header-anchor">#</a> 特定于应用程序的属性</h3> <p>正如我们所讨论的，使用 Config Server 的好处之一，是能够跨应用程序，为所有微服务提供共享的公共配置。尽管如此，通常也存在一些服务所特有的属性，是不需要（或不应该）在所有服务中共享的。</p> <p>除了共享配置之外，Config Server 还能够管理针对特定应用程序的配置。诀窍是将配置文件的名称，与应用程序的 <code>spring.application.name</code> 属性，配置成一样的值。</p> <p>在上一章中，你使用 <code>spring.application.name</code> 属性配置了微服务名称，用于在 Eureka 中注册。同样，这个属性在客户端访问 Config Server 时，也用于标识自己，以便 Config Server 可以提供特定于该应用程序的配置。</p> <p>例如，在 Taco Cloud 应用程序中，你将应用程序拆分成一些微服务，比如 ingredient-service、order-service、taco-service 和 user-service，你应该在每个服务中通过设置 <code>spring.application.name</code> 属性，指定这些服务的名称。然后就可以在 Config Server 的后端 Git 存储库上分别创建 YAML 配置文件。如：ingredient-service.yml、order-service.yml、taco-service.yml 和 user-service.yml。下图展示了 Gogs web 应用程序的配置库。</p> <p><img src="/note-pages/assets/img/image-20221228150837845.3ee54f4a.png" alt="image-20221228150837845"></p> <p>无论应用程序的名称是什么，所有应用程序都将接收来自 application.yml 文件的配置。但每个应用程序的 <code>spring.application.name</code> 属性设置的名称，将在请求 Config Server 时发送出去（作为请求路径的一部分）。如果有匹配的配置文件，那这些配置也将被返回。如果同样的属性在 <code>application.yml</code> 中，以及特定于应用程序的配置文件中，被重复定义了，那么特定于应用程序的配置中的属性将优先。</p> <h3 id="特定于-profile-的属性"><a href="#特定于-profile-的属性" class="header-anchor">#</a> 特定于 profile 的属性</h3> <p>我们已经知道如何利用 Spring Profile，使某些属性仅在给定 profile 激活时才能够使用。Spring Cloud Config Server 支持特定于 profile 的属性配置。这与在单个 Spring Boot 应用程序中的使用方式完全相同。这包括：</p> <ul><li>提供特定于 profile 的 <code>.properties</code> 或 YAML 文件，比如 application-production.yml。</li> <li>在单个 YAML 文件中包含多个 profile 配置组，使用 3 个中划线 <code>---</code> 和 <code>spring.profiles</code> 进行分隔。</li></ul> <p>例如，假设你现在通过 Config Server 为应用程序的所有微服务共享 Eureka 的配置。按目前的情况，它只指定了一个 Eureka 实例，这非常适合开发环境。但是，如果你的服务要在生产环境中运行，你可能希望对其进行配置，以便指定多个 Eureka 节点。</p> <p>更重要的是，在开发环境中你把 <code>server.port</code> 属性设定为 0。一旦服务投入生产，它们就会在各自的容器中运行，并将容器内的端口 8080 映射到外部端口上，因此会要求所有应用程序都在端口 8080 上侦听。</p> <p>使用 profile ，可以声明多个配置。除了把默认的 <code>application.yml</code> 文件推入 Config Server 的 Git 后端，你可以推送另一个名为 <code>application-production.yml</code> 的 YAML 文件，看起来是这样的：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka1<span class="token punctuation">:</span>8761/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka2<span class="token punctuation">:</span>8761/eureka/
</code></pre></div><p>当应用程序从 Config Server 获取配置时，它将标识出当前激活的 profile（在请求路径的第二部分）。如果当前激活的 profile 是 <code>production</code>，两套属性 <code>application.yml</code> 和 <code>application-production.yml</code> 将一起返回。<code>application-production.yml</code> 中的属性优先于 <code>application.yml</code> 中的属性。下图显示了后端 Git 存储库可能的情况。</p> <p><img src="/note-pages/assets/img/image-20221228154702274.7c1cb6e5.png" alt="image-20221228154702274"></p> <p>还可以指定同时特定于应用程序和 profile 的配置文件，和前面使用相同的命名约定。<strong>配置文件分为三部分：应用名、中划线、profile 名称。</strong></p> <p>例如，假设你需要为名为 <code>ingredient-service</code> 的应用程序设置属性，并且仅当激活的 profile 为 <code>production</code> 时才适用。这种情况下，你的配置文件名应该为 <code>ingredient-service-production.yml</code>。里边可以包含特定于应用程序和特定于 profile 的属性，如图所示。</p> <p><img src="/note-pages/assets/img/image-20221228160840030.a9eb14d5.png" alt="image-20221228160840030"></p> <h2 id="为配置的属性加密"><a href="#为配置的属性加密" class="header-anchor">#</a> 为配置的属性加密</h2> <p>Config Server 提供的配置大多数是不需要加密的。但一些敏感信息（如密码）最好在后端存储库中以加密的形式存储。</p> <p>Config Server 提供两种方式处理加密配置：</p> <ul><li>在 Git 存储的配置文件中，写入加密值</li> <li>使用 HashiCorp 的保险库作为 Config Server 的后端存储，以代替 Git。</li></ul> <p>让我们看看 Config Server 为保持配置属性的机密性，是如何使用这两种方式的。我们先看一下将加密属性写入 Git 后端存储库。</p> <h3 id="在-git-中加密属性"><a href="#在-git-中加密属性" class="header-anchor">#</a> 在 Git 中加密属性</h3> <p>除了使用未加密的值外，Config Server 还支持在 Git 存储的配置文件中使用加密值。在 Git 存储中使用加密值的关键，实际上是一个密钥，一个用于加密的密钥。</p> <p>要启用对属性加密，需要使用加密密钥。在将值传到客户端之前，使用密钥对加密值进行解密。Config Server 支持对称加密和非对称加密。设置对称加密的密钥，可在 Config Server 自身的配置中设置 <code>encrypt.key</code> 属性值。这个值可以用作加密和解密：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">encrypt</span><span class="token punctuation">:</span>
  <span class="token key atrule">key</span><span class="token punctuation">:</span> s3cr3t
</code></pre></div><p>在启动配置（例如 <code>bootstrap.properties</code> 或 <code>bootstrap.yml</code> 中）中设置此属性非常重要。这样使 Config Server 对外提供服务之前，可以通过自动配置加载此属性。</p> <p>为了提高安全性，你可以选择使用非对称加密密钥，如 RSA 密钥对或对 keystore 的引用。要创建这样的密钥对，可以使用 keytool 命令行工具：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ keytool -genkeypair -alias tacokey -keyalg RSA <span class="token punctuation">\</span>
-dname <span class="token string">&quot;CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US&quot;</span> <span class="token punctuation">\</span>
-keypass s3cr3t -keystore keystore.jks -storepass l3tm31n
</code></pre></div><p>生成的 keystore 将写入名为 <code>keystore.jks</code> 的文件中，可以选择把 keystore 文件保存在文件系统上，或将其放置在应用程序本身中。无论哪种情况，你都需要在 Config Server 的 <code>bootstrap.yml</code> 文件中，指定 keystore 文件的位置以及授权信息。</p> <p>假设你选择将 keystore 打包到应用程序中，并放在类路径的根目录。然后就可以通过配置 Config Server 的以下属性使用 keystore：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">encrypt</span><span class="token punctuation">:</span>
  <span class="token key atrule">key-store</span><span class="token punctuation">:</span>
    <span class="token key atrule">alias</span><span class="token punctuation">:</span> tacokey
    <span class="token key atrule">location</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/keystore.jks
    <span class="token key atrule">password</span><span class="token punctuation">:</span> l3tm31n
    <span class="token key atrule">secret</span><span class="token punctuation">:</span> s3cr3t
</code></pre></div><p>有了密钥或 keystore，你现在需要一些加密的数据。Config Server 提供了 <code>/encrypt</code> 加密接口。所要做的就是通过 POST 请求，把一些要加密的数据发送到 <code>/encrypt</code> 接口。例如，假设你要加密 MongoDB 数据库的密码。使用 curl 可以这样加密这个密码：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:8888/encrypt -d <span class="token string">&quot;s3cr3tP455w0rd&quot;</span>
93912a660a7f3c04e811b5df9a3cf6e1f63850cdcd4aa092cf5a3f7e1662fab7
</code></pre></div><p>提交 POST 请求后，你将收到一个加密值作为响应。剩下的就是复制该值，并将其粘贴到在 Git 存储库中保存的配置文件中。</p> <p>要设置 MongoDB 密码，请在 <code>application.yml</code> 中添加 <code>spring.data.mongodb.password</code> 属性：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">'{cipher}93912a660a7f3c04e811b5df9a3cf6e1f63850...'</span>
</code></pre></div><p>请注意，给 <code>spring.data.mongodb.password</code> 设置的值是用单引号（<code>'</code>）引起来的，前缀为 <code>{cipher}</code>。这会让 Config Server 识别到，这是一个加密值，而不是普通的未加密值。</p> <p>对 <code>application.yml</code> 的修改提交并推送到到 Git 存储库后，Config Server 准备好了提供加密属性服务。要查看它的运行情况，可使用 curl 模拟客户端调用：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:8888/application/default <span class="token operator">|</span> jq
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;app&quot;</span>,
  <span class="token string">&quot;profiles&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;prof&quot;</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;label&quot;</span><span class="token builtin class-name">:</span> null,
  <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;464adfd43485182e4e0af08c2aaaa64d2f78c4cf&quot;</span>,
  <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> null,
  <span class="token string">&quot;propertySources&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;http://localhost:10080/tacocloud/tacocloudconfig/application.yml&quot;</span>,
      <span class="token string">&quot;source&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;spring.data.mongodb.password&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;s3cr3tP455w0rd&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如你所见，属性 <code>spring.data.mongodb.password</code> 的值是解密的形式。默认情况下，Config Server 提供的任何加密值，在后端 Git 存储库中都是加密的；它们在被使用之前会被解密。这意味着使用 Config Server 的客户端应用程序，不需要任何特殊的代码或配置来接收在 Git 中加密的属性。</p> <p>如果你希望 Config Server 提供仍然加密的属性，你可以设置 <code>spring.cloud.config.server.encrypt.enabled</code> 属性为 false:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
        <span class="token key atrule">encrypt</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><p>这将导致 Config Server 提供的所有属性值，包括加密属性值，与 Git 存储库中设置的值完全相同。再次使用 curl 命令模拟客户端调用，以显示禁用解密后的效果：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>$ curl localhost<span class="token punctuation">:</span>8888/application/default <span class="token punctuation">|</span> jq
<span class="token punctuation">{</span>
  <span class="token punctuation">...</span>
  <span class="token key atrule">&quot;propertySources&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://localhost:10080/tacocloud/tacocloudconfig/application.yml&quot;</span><span class="token punctuation">,</span>
        <span class="token key atrule">&quot;source&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;spring.data.mongodb.password&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;{cipher}AQA4JeVhf2cRXW...&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，如果客户端接收到加密后的属性值，那么客户端现在就负责自行解密了。</p> <p>尽管可以将加密的属性存储在 Git 中，再由 Config Server 提供服务。但我们已经看到加密并不是 Git 原生的能力，这需要你做一些工作，以便使用任何写入 Git 存储库的数据。而且，除非你的应用程序自行解密，否则使用 Config Server API 能够让任何人获取解密后的信息。让我们看看另一种配置 Config Server 的选择，它只为那些有权看到他们的使用方提供服务。</p> <h3 id="在-vault-中存储密码"><a href="#在-vault-中存储密码" class="header-anchor">#</a> 在 Vault 中存储密码</h3> <p><code>HashiCorp Vault</code> 是一个机密管理工具。与 Git 相比，Vault 的核心功能是以本机方式来处理机密信息的。所以对于配置机密信息来说，使用 Vault 作为 Config Server 的后端存储，是一种更好的选择。</p> <p>要开始使用 Vault，请参照 Vault 网站上的安装说明 <a href="https://www.vaultproject.io/intro/getting-started/install.html" target="_blank" rel="noopener noreferrer">https://learn.hashicorp.com/tutorials/vault/getting-started-install<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>， 下载并安装 Vault 命令行工具。在本节中，将同时使用 vault 命令用于管理机密配置，以及启动 Vault 服务器。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ vault server -dev -dev-root-token-id<span class="token operator">=</span>roottoken
$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span><span class="token string">'http://127.0.0.1:8200'</span>
$ vault status
</code></pre></div><p>第一个命令使用根令牌 （ID 是 roottoken）在开发模式下启动 Vault 服务器。开发模式，顾名思义，是一种简单但并不完全安全的模式。它不应该在生产环境中使用，但是在开发时使用非常有用，也更方便。</p> <blockquote><p>注意，Vault 服务器是一个功能强大，且非常健壮的机密管理服务器。本章没有足够的空间来详细讨论所有功能，只涉及在开发模式下简单使用 Vault 服务器。在将 Vault 投入生产环境之前，我强烈建议你通过阅读 Vault 文档，以了解 Vault 的详细信息 <a href="https://www.vaultproject.io/docs/index.html" target="_blank" rel="noopener noreferrer">https://www.vaultproject.io/docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <p>对 Vault 服务器的所有访问都需要向服务器提供令牌。根令牌是一种管理令牌，它允许你创建更多令牌。它也可以用来读写机密信息。在开发模式下启动服务器时，如果没有指定根令牌，将自动生成一个并在启动时写入日志文件中。为了方便使用，建议把根令牌设置为一个易于记忆的值，如 roottoken。</p> <p>Vault 服务器以开发模式启动以后，它将侦听本地端口 8200。也可以设置 <code>VAULT_ADDR</code> 环境变量，如前面的代码段中第二个命令所展示的那样，以修改配置。</p> <p>最后，<code>vault status</code> 命令验证前两个命令是否按预期工作了。你应该收到一个列表，其中包含大约六个属性，描述 Vault 服务器的配置，以及 Vault 是否被封存。（Valulte 不应在开发模式下被封存。）</p> <p>如果使用 Vault 0.10.0 或更高版本，你需要执行一些其他操作，以便适配 Vault 与 Config Server 一起工作。因为高版本的 Vault 工作方式有一些更改，会导致与 Config Server 标准机密后端存储不兼容。以下两个命令重新创建名称为 <code>secrets</code> 的后端存储，这样就和 Config Server 兼容了：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ vault secrets disable secret
$ vault secrets <span class="token builtin class-name">enable</span> -path<span class="token operator">=</span>secret kv
</code></pre></div><p>如果使用旧版本的 Vault，则以上这些步骤不需要执行。</p> <div class="subtitle"><p>保存机密信息到 Vault 中</p></div><p>使用 Vault 命令可以轻松地将机密写入 Vault。例如，假设你想将 MongoDB 的密码使用属性 <code>spring.data.MongoDB.password</code>，保存到 Vault 而不是 Git 中。使用 vault 命令，可以像下面这样操作：</p> <p><img src="/note-pages/assets/img/image-20221228173657721.b6ea4ab4.png" alt="image-20221228173657721"></p> <p>目前重要的是要注意这三个部分的信息：机密信息的路径、键和值。路径非常类似于文件系统路径，允许你对相关的秘密使用相同路径进行分组。路径的前缀 <code>secret/</code> 标识 Vault 后端（在本例中是名为“secret”的后端）</p> <p>机密信息的键和值，是你正在向 Vault 写入的实际机密信息。当设置由 Config Server 提供服务的机密信息时，重要的是要使机密信息的键与配置属性的键完全一样。</p> <p>你可以使用读取命令，验证写入的机密：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ vault <span class="token builtin class-name">read</span> secret/application
Key                             Value
---                             -----
refresh_interval                768h
spring.data.mongodb.password    s3cr3t
</code></pre></div><p>在向给定路径写入机密时，请注意，对给定路径的每次写入都将覆盖以前写入该路径的所有机密。例如，假设你又希望将 MongoDB 用户名写入到与前面的例子相同的 Vault 路径中。你不能简单地写入 <code>spring.data.mongodb.username</code>，这样做会导致原来的 <code>spring.data.mongodb.password</code> 信息丢失。你必须将它们同时写入：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>% vault <span class="token function">write</span> secret/application <span class="token punctuation">\</span>
        spring.data.mongodb.password<span class="token operator">=</span>s3cr3t <span class="token punctuation">\</span>
        spring.data.mongodb.username<span class="token operator">=</span>tacocloud
</code></pre></div><p>现在你已经在 Vault 中存储了一些机密信息，让我们看看如何将 Vault 配置为 Config Server 的后端存储。</p> <div class="subtitle"><p>在 Config Server 中配置 Vault 后端存储</p></div><p>要将 Vault 添加为 Config Server 的后端存储，你需要做的是添加 vault 到当前激活的 profile 中。在 Config Server 的 <code>application.yml</code> 文件中，可以这样做：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> vault
    <span class="token punctuation">-</span> git
</code></pre></div><p>如上所示，vault 和 git 都处于活动状态，这允许 Config Server 可以从 Vault 和 Git 获取属性配置。通常，你只需要将机密信息写入 Valult，对不需要保密的信息可以继续使用 Git。但如果你希望将所有配置写入 Vault，而不再使用 Git，你可以在 <code>spring.profiles.active</code> 中去除 Git，只设置为 vault。</p> <p>默认情况下，Config Server 将假定 Vault 在本地主机上运行，并侦听 8200 端口。你可以在 Config Server 的配置中做更改：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10080/tacocloud/tacocloud<span class="token punctuation">-</span>config
          <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token key atrule">vault</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> vault.tacocloud.com
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8200</span>
          <span class="token key atrule">scheme</span><span class="token punctuation">:</span> https
          <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><p><code>spring.cloud.config.server.vault.*</code> 属性允许你覆盖 Config Server 使用 Vault 的默认值。在这里告诉 Config Server, Vault 的 API 地址为 <a href="https://vault.tacocloud.com/:8200%E3%80%82" target="_blank" rel="noopener noreferrer">https://vault.tacocloud.com:8200。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>注意，上述配置中仍然保存了 Git，这假设 Vault 和 Git 分担了提供配置的责任。order 属性指定了 Vault 提供的机密信息将优先于Git 提供的属性。Config Server 配置为使用 Vault 后端后，你可以通过 curl 命令模拟客户端调用：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>habuma:habuma<span class="token punctuation">]</span>% <span class="token function">curl</span> localhost:8888/application/default <span class="token operator">|</span> jq
<span class="token punctuation">{</span>
  <span class="token string">&quot;timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2018-04-29T23:33:22.275+0000&quot;</span>,
  <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token number">400</span>,
  <span class="token string">&quot;error&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Bad Request&quot;</span>,
  <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Missing required header: X-Config-Token&quot;</span>,
  <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/application/default&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不好！看起来像是出了什么问题！事实上，此错误表明 Config Server 正在从 Vault 中提供机密信息，但请求未包含 Vault 令牌。</p> <p>所有 Vault 请求都应包含 <code>X-Vault-Token</code> 请求头。这不是在 Config Server 中配置该令牌，而是 Config Server 的客户端，在向 Config Server 发送请求时，要在请求头中包含 <code>X-Config-token</code>。然后 Config Server 会使用这个令牌，对 Vault 发出请求，同样将令牌放在请求头 <code>X-Config-Token</code> 中。</p> <p>如你所见，由于请求中缺少令牌，Config Server 将拒绝提供配置服务，即使是来自 Git 的属性也不行。这是一个有趣的副作用，同时使用Vault 与 Git时，除非提供有效的令牌，否则 Git 属性都会被 Config Server 间接隐藏起来。</p> <p>再次尝试一下，这次在请求头中添加 <code>X-Config-Token</code>：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:8888/application/default
      -H<span class="token string">&quot;X-Config-Token: roottoken&quot;</span> <span class="token operator">|</span> jq
</code></pre></div><p>请求中的 <code>X-Config-Token</code> 应该会得到很好的结果，包括 Vault 中的机密令牌。此处给出的令牌是你在开发模式下启动 Vault 服务器时指定的根令牌。它可以是任何在 Vault 服务器中创建的，未过期且已授予该权限访问 Vault 机密的令牌。</p> <div class="subtitle"><p>在 Config Server 客户端中设置 Vault 令牌</p></div><p>显然，你无法在每个微服务中使用 curl 来指定从 Config Server 中请求配置时所使用的令牌。你需要添加对每个应用程序的本地配置进行一点配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">token</span><span class="token punctuation">:</span> roottoken
</code></pre></div><p><code>spring.cloud.config.token</code> 属性告诉 Config Server 客户端，它向 Config Server 发出请求时所使用的令牌值。此属性必须在应用程序的本地配置中设置（不存储在 Config Server 的 Git 或 Vault 后端），以便 Config Server 可以将其值传递到 Vault。</p> <div class="subtitle"><p>写入特定于应用程序和 profile 的机密</p></div><p>当 Config Server 提供服务时，写入 <code>application</code> 路径的机密会服务于所有应用程序，无论其名称如何。如果只需要对某些应用程序使用机密令牌，可将路径的 <code>application</code> 部分替换为具体的应用程序名称。例如，以下 Vault 写入命令将写入只特定服务于 <code>ingredient-service</code> 应用程序的机密。（名称由 <code>spring.application.name</code> 指定）：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ vault <span class="token function">write</span> secret/ingredient-service <span class="token punctuation">\</span>
              spring.data.mongodb.password<span class="token operator">=</span>s3cr3t
</code></pre></div><p>同样，如果你没有指定 profile，写入 Vault 的机密将服务于默认 profile。也就是说，客户将接收这些秘密，而不管当前激活的 profile 是什么。你可以向特定的 profile 写入机密，像下面这样：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>% vault <span class="token function">write</span> secret/application,production <span class="token punctuation">\</span>
              spring.data.mongodb.password<span class="token operator">=</span>s3cr3t <span class="token punctuation">\</span>
              spring.data.mongodb.username<span class="token operator">=</span>tacocloud
</code></pre></div><p>这样写入的机密信息，将只提供给当前激活的 profile 是 <code>production</code> 的应用程序。</p> <h2 id="远程刷新配置属性"><a href="#远程刷新配置属性" class="header-anchor">#</a> 远程刷新配置属性</h2> <p>传统上，应用程序维护（包括配置更改）需要重新部署或至少重新启动应用程序。但这对云原生应用来说是不可接受的。我们希望能够动态更改配置属性，甚至应用程序都不需要下线停机。</p> <p>幸运的是，Spring Cloud Config Server 支持零停机刷新应用程序属性配置的能力。一旦配置修改被推送到后端 Git 存储库或 Vault 加密存储库，每个微服务应用程序都可以立即使用下面的两种方式刷新配置：</p> <ul><li>手动 —— Config Server 客户端暴露接口 <code>/actuator/refresh</code>。通过对些接口发送 HTTP POST 请求，强制客户端从 Config Server 后端检索最新的配置。</li> <li>自动 —— 通过 Git 存储库中的提交钩子触发 Config Server 的所有客户端进行刷新。这涉及到另一个 Spring Cloud Bus 的项目，用于在 Config Server 以及它的客户端之间进行通信。</li></ul> <p>每种选择都有其利弊。手动刷新可以更精确地控制哪些服务更新为新的配置，但它需要单独的向每个微服务的每个实例发出 HTTP 请求。自动刷新将更新的配置立即应用到所有微服务，这是由配置存储库的提交触发的（可能对某些项目来说这有点不适合）。</p> <h3 id="手动刷新配置属性"><a href="#手动刷新配置属性" class="header-anchor">#</a> 手动刷新配置属性</h3> <p>在之后的章节中，我们将介绍 Spring Boot Actuator，它是一个 Spring Boot 基础组件，它支持观察和有限操作应用程序的运行时信息，例如修改日志记录级别。但现在，我们将看一个具体的 Actuator 特征，仅在配置为 Spring Cloud Config Server 客户端时才启用。</p> <p>每当你配置一个应用程序使用 Config Server 的配置服务，自动配置还可以配置一个 Actuator 接口以用于刷新配置。要使用此接口，你需要添加 Actuator 依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>你可能已经猜到的，这个依赖项也可以从 Spring Initializr 中获得，通过勾选 <code>Actuator</code> 复选框。</p> <p>有了 Actuator，你就可以任何时候对 <code>/actuator/refresh</code> 接口发送 HTTP POST 请求，强制从后端存储中获取最新配置。</p> <p>要看到是如何实际操作的，先假设你有一个类 <code>GreetingProps</code>，并添加了 @ConfigurationProperties 注解：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;greeting&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingProps</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此外，你还有一个 Controller 类，它注入了 GreetingProps，对 GET 请求简单返回消息属性的值：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">GreetingProps</span> props<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">GreetingController</span><span class="token punctuation">(</span><span class="token class-name">GreetingProps</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> props<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>同时，在 Git 配置存储库中，有一个 <code>application.yml</code> 文件，其中有以下属性：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">greeting</span><span class="token punctuation">:</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Hello World<span class="token tag">!</span>
</code></pre></div><p>有了 Config Server 和这个简单的配置客户端，对接口 <code>/hello</code> 的 HTTP GET 请求将产生以下响应：</p> <div class="language-java extra-class"><pre class="language-java"><code>$ curl localhost<span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>hello
<span class="token class-name">Hello</span> <span class="token class-name">World</span><span class="token operator">!</span>
</code></pre></div><p>现在，在不重启 Config Server 和应用程序的情况下，更改 <code>application.yml</code> 文件中的 <code>greeting.message</code> 属性值，并将其推入后端 Git 存储库：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">greeting</span><span class="token punctuation">:</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Hiya folks<span class="token tag">!</span>
</code></pre></div><p>如果你对应用程序发出同样的 GET 请求，你仍然会得到同样的“ Hello World!” 响应，即使 Git 中的配置已更改。但是，你可以通过发送 POST 请求来强制刷新：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:53419/actuator/refresh -X POST
<span class="token punctuation">[</span><span class="token string">&quot;config.client.version&quot;</span>,<span class="token string">&quot;greeting.message&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>请注意，响应是一个 JSON 数组，其中含了已经更改的属性的名称 。该数组中包含 <code>greeting.message</code> 属性。还包括 <code>config.client.version</code> 属性，这个属性保存的是 Git 提交的哈希值。因为现在的配置是基于一个新的 Git 提交，每当文件中有任何更改时，这个属性都会更改。</p> <p>POST 请求的响应告诉你 <code>greeting.message</code> 已更改。再次向 <code>/hello</code> 路径发出 GET 请求来验证一下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> localhost:8080/hello
Hiya folks<span class="token operator">!</span>
</code></pre></div><h3 id="自动刷新配置属性"><a href="#自动刷新配置属性" class="header-anchor">#</a> 自动刷新配置属性</h3> <p>除了手动刷新应用程序配置以外，通过另一个名为 Spring Cloud Bus 的 Spring Cloud 项目，Config Server 可以自动通知所有客户端进行配置更改。下图展示了自动刷新配置的工作原理。</p> <p><img src="/note-pages/assets/img/image-20221228183030439.b020bd40.png" alt="image-20221228183030439"></p> <p>图示属性刷新过程可以概括如下：</p> <ul><li>在配置 Git 存储库上创建一个 webhook，用来通知 Config Server 任何 Git 存储库的更改（如：push）。Webhooks 支持很多 Git 实现，包括 GitHub、GitLab、Bitbucket、Gogs。</li> <li>Config Server 通过广播消息来响应 webhook POST 请求，通过消息代理（如 RabbitMQ 或 Kafka）广播更改。</li> <li>订阅通知的各个 Config Server 客户端应用程序，响应通知消息，使用来自 Config Server 的属性值刷新应用配置。</li></ul> <p>其效果是，所有使用 Config Server 的客户端应用程序都将始终具有最新配置，配置更改被推送到后端 Git 存储库后，各应用程序紧跟着进行刷新。</p> <p>使用自动属性刷新时，需要几个部分同步工作。让我们整体看一下你将要进行的更改，以有一个更直观的理解：</p> <ul><li>你将需要一个消息代理来处理 Config Server 及其客户端之间的消息传递。比如选择 RabbitMQ 或 Kafka。</li> <li>需要在后端 Git 存储库中创建一个 webhook 来通知 Config Server 相关修改。</li> <li>需要使用 Config Server 监视器依赖项（它提供了接口，以处理来自 Git 存储库的调用请求），启用 Config Server 和 RabbitMQ 或 Kafka Spring Cloud Stream 依赖关系（用于向消息代理发布属性更改消息）。</li> <li>除非消息代理以默认设置在本地运行，否则需要在 Config Server 及其客户端中，配置连接消息代理的详细信息。</li> <li>每个 Config Server 客户端应用程序都需要 Spring Cloud Bus 依赖。</li></ul> <p>我将假设必备的消息代理（RabbitMQ 或 Kafka 等等）已经运行，并准备传递属性更改消息了。你要开始对配置进行修改，以触发 webhook 更新请求。</p> <div class="subtitle"><p>创建 WEBHOOK</p></div><p>许多 Git 服务器实现都支持创建 webhook。一旦对 Git 存储库进行更改（包括推送），就可以使用 webhook 来通知应用程序。 设置 webhook 的细节，会因为 Git 服务器实现不同而不同。下面通过在 Gogs 上配置 webhook 以让你了解整个过程。</p> <p>首先，在 web 浏览器中访问配置存储库，并单击设置链接，如图所示。</p> <p><img src="/note-pages/assets/img/image-20221228184234213.fbca999d.png" alt="image-20221228184234213"></p> <p>这将带你进入存储库的设置页面，左侧是分类设置菜单。从菜单中选择 Webhooks 将显示类似于下图的页面。</p> <p><img src="/note-pages/assets/img/image-20221228184323604.75b33e33.png" alt="image-20221228184323604"></p> <p>在 webhooks 设置页面中，单击 add webhook 按钮。在 Gogs，这将打开一个下拉列表，用于新建不同类型的 webhook。选择 Gogs 选项。然后，你将看到一个表单用来来创建一个新的webhook，如图所示：</p> <p><img src="/note-pages/assets/img/image-20221228184425465.d7cd17bf.png" alt="image-20221228184425465"></p> <p>新建 webhook 表单有几个字段，最重要的两个字段是 <code>Payload URL</code> 和 <code>Content Type</code> 。因此，<code>Payload URL</code> 字段应设置为指向 Config Server 的 <code>/monitor</code> 接口的 URL。</p> <p>我们还将 <code>Content Type</code> 字段设置为 <code>application/json</code>。这很重要，因为 Config Server 的 <code>/monitor</code> 接口不支持 <code>application/x-www-formurlencoded</code> 等其他选项。</p> <p>如果设置了 <code>Secret</code> 字段，将在 webhook POST 请求中包含一个名为 <code>X-Gogs-Signature</code>（如果是 GitHub，则为 <code>X-Hub-Signature</code>）的请求头，值为 <code>HMAC-SHA256</code> 数字摘要（如果是 GitHub，则为 <code>HMAC-SHA1</code> 摘要）。现在，Config Server 的 <code>/monitor</code> 接口还无法识别这个签名头信息，因此你可以将此字段留空。</p> <p>最后，你只关心将配置推送到配置存储库，并且希望 webhook 处于激活状态，所以你要确保事件单选按钮 <code>Just the Push Event</code> 和 <code>Active</code> 复选框被选中。单击 <code>Add Webhook</code> 按钮，webhook 将被创建。每当向存储库推送进行配置推送时，webhook 就会向 Config Server 发送 POST 请求。</p> <p>现在你必须在 Config Server 中启用 <code>/monitor</code> 接口来处理这些请求。</p> <div class="subtitle"><p>在 Config Server 中处理 WEBHOOK 更新</p></div><p>在 Config Server 中启用 <code>/monitor</code> 接口，只需在工程中添加 <code>spring-cloud-config-monitor</code> 依赖。在 pom.xml 文件中添加以下内容：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-config-monitor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>有了这个依赖，自动配置将启动 <code>/monitor</code> 接口。但是这还不够，除非 Config Sever 也有一种广播更改的能力。你还需要为 Spring 添加另一个依赖 <code>Spring Cloud Stream</code>。</p> <p><code>Spring Cloud Stream</code> 是 Spring Cloud 的又一个组件：它使各服务通过某种底层机制（比如：RabbitMQ 或 Kafka）进行通信。 这些服务编写的时候，并不知道他们是如何被使用的。他们从流中接收数据，然后进行处理。处理结束将处理结果返回到流，以供下游服务处理。或将接收的数据和处理结果都返回到流中。</p> <p><code>/monitor</code> 接口使用 <code>Spring Cloud Stream</code> 发送通知消息到相关的 Config Server 客户端。为了避免硬编码任何特定的消息实现，monitor 充当 <code>Spring Cloud Stream</code> 发布消息入口，并让底层实现来具体处理发送消息的细节。</p> <p>如果你使用的是 RabbitMQ，则需要在 Config Server 中包含 <code>Spring Cloud Stream RabbitMQ</code> 依赖：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-stream-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果你更喜欢 Kafka，就需要 Spring Cloud Stream Kafka 依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-stream-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>有了这些依赖项，Config Server 就差不多可以参与自动刷新配置属性了。事实上，如果 RabbitMQ 或 Kafka 的代理，使用默认配置运行在本地， Config Server 现在就可以很好的运行。但是如果代理运行在其他主机上，并且使用了某个非默认端口，或者你已经更改了访问代理的凭据，则需要在 Config Server 中设置一些配置属性。</p> <p>使用 RabbitMQ 时，可以在 application.yml 中设置以下属性替代默认值：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>
    <span class="token key atrule">bootstrap-servers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> kafka.tacocloud.com<span class="token punctuation">:</span><span class="token number">9092</span>
    <span class="token punctuation">-</span> kafka.tacocloud.com<span class="token punctuation">:</span><span class="token number">9093</span>
    <span class="token punctuation">-</span> kafka.tacocloud.com<span class="token punctuation">:</span><span class="token number">9094</span>
</code></pre></div><div class="subtitle"><p>创建 GOGS 通知提取程序</p></div><p>每个 Git 实现在处理 webhook POST 请求时，都有自己的特性。所以 <code>/monitor</code> 接口要能够理解 webhook POST 请求时的不同数据格式。在 <code>/monitor</code> 接口底层是一组组件，它检查 POST 请求，尝试确定请求来自哪种 Git 服务器，并将请求数据映射到一种公共的数据类型中，以发送给每个客户端。</p> <p>Config Server 提供了对几种流行 Git 实现的支持，比如 GitHub、GitLab 和 Bitbucket。如果你用的是这些 Git 实现，就不需要任何特殊处理。当我写这篇文章时，Gogs 还没有正式发布。因此，如果你使用 Gogs 作为 Git 实现，你需要一个特定于 Gogs 的通知提取程序。</p> <p>这个清单显示了为 Taco Cloud 实现的 Gogs 通知提取器。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">tacos<span class="token punctuation">.</span>gogs</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span></span><span class="token class-name">PropertyPathNotification</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span></span><span class="token class-name">PropertyPathNotificationExtractor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MultiValueMap</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span>LOWEST_PRECEDENCE <span class="token operator">-</span> <span class="token number">300</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GogsPropertyPathNotificationExtractor</span>
    <span class="token keyword">implements</span> <span class="token class-name">PropertyPathNotificationExtractor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PropertyPathNotification</span> <span class="token function">extract</span><span class="token punctuation">(</span>
        <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers<span class="token punctuation">,</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;push&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;X-Gogs-Event&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;commits&quot;</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> paths <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
                <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> commits <span class="token operator">=</span>
                    <span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;commits&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> commit <span class="token operator">:</span> commits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">addAllPaths</span><span class="token punctuation">(</span>paths<span class="token punctuation">,</span> commit<span class="token punctuation">,</span> <span class="token string">&quot;added&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">addAllPaths</span><span class="token punctuation">(</span>paths<span class="token punctuation">,</span> commit<span class="token punctuation">,</span> <span class="token string">&quot;removed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">addAllPaths</span><span class="token punctuation">(</span>paths<span class="token punctuation">,</span> commit<span class="token punctuation">,</span> <span class="token string">&quot;modified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>paths<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PropertyPathNotification</span><span class="token punctuation">(</span>
                        paths<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addAllPaths</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> paths<span class="token punctuation">,</span>
                             <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> commit<span class="token punctuation">,</span>
                             <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> commit<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>files <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            paths<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>GogsPropertyPathNotificationExtractor</code> 的实现细节和我们要讨论的内容不是太相关。一旦 Spring Cloud Config Server 内置支持了 Gogs 时，就更不需要关注了。</p> <div class="subtitle"><p>在 Config Server 客户端中启用自动刷新</p></div><p>在 Config Server 客户端中启用自动属性刷新非常简单，只需要一个依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bus-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这会将 AMQP（例如，RabbitMQ） <code>Spring Cloud Bus</code> 添加到项目中。如果你使用的是 Kafka，则应改用以下依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bus-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>项目中有了 <code>Spring Cloud Bus</code> 以后，应用程序在启动时自动配置将会触发，会自动绑定到本地运行的 RabbitMQ 或 Kafka 群集的 Broker 上。如果你的 RabbitMQ 或 Kafka 在其他地方运行，那么你将需要在 Config Server 的客户端进行适当的配置，就像在 Config Server 上配置时那样。</p> <p>现在，Config Server 及其客户端都配置为自动刷新了。启动所有工程，通过修改 <code>application.yml</code> （任何修改）让它运转起来。当你把修改推到 Git 存储库时，你将立即在客户端应用程序中发现修改生效。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-pages/spring/云原生Spring/服务发现.html" class="prev">
        服务发现
      </a></span> <span class="next"><a href="/note-pages/spring/Spring揭秘/Spring框架.html">
        Spring 框架
      </a>
      →
    </span></p></div> </main> <aside items="[object Object],[object Object],[object Object],[object Object]" class="right-sidebar"><div style="margin-left:20px; margin-bottom: 10px; text-align: center; font-size:16px;font-weight:bold;">此页内容</div> <div class="right-sidebar-wrap"><ul class="right-sidebar-links"><li id="tab-item0" class="right-sidebar-item active"><a href="#独立配置和集中式配置" class="right-sidebar-item-level2">
          独立配置和集中式配置
        </a></li><li id="tab-item1" class="right-sidebar-item"><a href="#运行配置服务器" class="right-sidebar-item-level2">
          运行配置服务器
        </a></li><li id="tab-item2" class="right-sidebar-item"><a href="#启动配置服务器" class="right-sidebar-item-level3">
          启动配置服务器
        </a></li><li id="tab-item3" class="right-sidebar-item"><a href="#填写配置库" class="right-sidebar-item-level3">
          填写配置库
        </a></li><li id="tab-item4" class="right-sidebar-item"><a href="#消费共享的配置" class="right-sidebar-item-level2">
          消费共享的配置
        </a></li><li id="tab-item5" class="right-sidebar-item"><a href="#消费特定的配置" class="right-sidebar-item-level2">
          消费特定的配置
        </a></li><li id="tab-item6" class="right-sidebar-item"><a href="#特定于应用程序的属性" class="right-sidebar-item-level3">
          特定于应用程序的属性
        </a></li><li id="tab-item7" class="right-sidebar-item"><a href="#特定于-profile-的属性" class="right-sidebar-item-level3">
          特定于 profile 的属性
        </a></li><li id="tab-item8" class="right-sidebar-item"><a href="#为配置的属性加密" class="right-sidebar-item-level2">
          为配置的属性加密
        </a></li><li id="tab-item9" class="right-sidebar-item"><a href="#在-git-中加密属性" class="right-sidebar-item-level3">
          在 Git 中加密属性
        </a></li><li id="tab-item10" class="right-sidebar-item"><a href="#在-vault-中存储密码" class="right-sidebar-item-level3">
          在 Vault 中存储密码
        </a></li><li id="tab-item11" class="right-sidebar-item"><a href="#远程刷新配置属性" class="right-sidebar-item-level2">
          远程刷新配置属性
        </a></li><li id="tab-item12" class="right-sidebar-item"><a href="#手动刷新配置属性" class="right-sidebar-item-level3">
          手动刷新配置属性
        </a></li><li id="tab-item13" class="right-sidebar-item"><a href="#自动刷新配置属性" class="right-sidebar-item-level3">
          自动刷新配置属性
        </a></li></ul></div></aside></div><div class="global-ui"></div></div>
    <script src="/note-pages/assets/js/app.05dcbd87.js" defer></script><script src="/note-pages/assets/js/3.4a2f67fd.js" defer></script><script src="/note-pages/assets/js/2.ab82720e.js" defer></script><script src="/note-pages/assets/js/17.9daf0c47.js" defer></script>
  </body>
</html>
