<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第3章 Map | 后端技术栈笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/jquery/3.4.0/jquery.min.js"></script>
    <script src="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" href="/note-pages//s0.pstatp.com/cdn/expire-1-M/fancybox/3.5.7/jquery.fancybox.min.css">
    <meta name="description" content="BackEnd Notes">
    
    <link rel="preload" href="/note-pages/assets/css/0.styles.167a34c7.css" as="style"><link rel="preload" href="/note-pages/assets/js/app.05dcbd87.js" as="script"><link rel="preload" href="/note-pages/assets/js/3.4a2f67fd.js" as="script"><link rel="preload" href="/note-pages/assets/js/2.ab82720e.js" as="script"><link rel="preload" href="/note-pages/assets/js/24.592e8014.js" as="script"><link rel="prefetch" href="/note-pages/assets/js/10.e11a80d9.js"><link rel="prefetch" href="/note-pages/assets/js/100.489cf69a.js"><link rel="prefetch" href="/note-pages/assets/js/101.560e37ea.js"><link rel="prefetch" href="/note-pages/assets/js/102.baaa4f6a.js"><link rel="prefetch" href="/note-pages/assets/js/103.262b6423.js"><link rel="prefetch" href="/note-pages/assets/js/104.ac33d7ce.js"><link rel="prefetch" href="/note-pages/assets/js/105.5e6ce18f.js"><link rel="prefetch" href="/note-pages/assets/js/106.a69322ef.js"><link rel="prefetch" href="/note-pages/assets/js/107.6cdb78ee.js"><link rel="prefetch" href="/note-pages/assets/js/108.1d720289.js"><link rel="prefetch" href="/note-pages/assets/js/109.58f7297c.js"><link rel="prefetch" href="/note-pages/assets/js/11.241a46da.js"><link rel="prefetch" href="/note-pages/assets/js/110.9cef761d.js"><link rel="prefetch" href="/note-pages/assets/js/111.c782138c.js"><link rel="prefetch" href="/note-pages/assets/js/112.40cb3b1a.js"><link rel="prefetch" href="/note-pages/assets/js/113.c367e40a.js"><link rel="prefetch" href="/note-pages/assets/js/114.a4a75db5.js"><link rel="prefetch" href="/note-pages/assets/js/115.a73cd469.js"><link rel="prefetch" href="/note-pages/assets/js/116.ad853155.js"><link rel="prefetch" href="/note-pages/assets/js/117.a82b2649.js"><link rel="prefetch" href="/note-pages/assets/js/118.8f896dd0.js"><link rel="prefetch" href="/note-pages/assets/js/119.374482b1.js"><link rel="prefetch" href="/note-pages/assets/js/12.ebe220d5.js"><link rel="prefetch" href="/note-pages/assets/js/120.89698284.js"><link rel="prefetch" href="/note-pages/assets/js/121.cbe50685.js"><link rel="prefetch" href="/note-pages/assets/js/122.7de2ac51.js"><link rel="prefetch" href="/note-pages/assets/js/123.a2d16009.js"><link rel="prefetch" href="/note-pages/assets/js/124.e1ba7cbe.js"><link rel="prefetch" href="/note-pages/assets/js/125.4e1e6d6a.js"><link rel="prefetch" href="/note-pages/assets/js/126.3db22af3.js"><link rel="prefetch" href="/note-pages/assets/js/127.937f4ffc.js"><link rel="prefetch" href="/note-pages/assets/js/128.0bad2e20.js"><link rel="prefetch" href="/note-pages/assets/js/129.75a99d25.js"><link rel="prefetch" href="/note-pages/assets/js/13.5ee7bef5.js"><link rel="prefetch" href="/note-pages/assets/js/130.599b6d3d.js"><link rel="prefetch" href="/note-pages/assets/js/131.687214bf.js"><link rel="prefetch" href="/note-pages/assets/js/132.8295c067.js"><link rel="prefetch" href="/note-pages/assets/js/133.854d61c0.js"><link rel="prefetch" href="/note-pages/assets/js/134.f3fc20e1.js"><link rel="prefetch" href="/note-pages/assets/js/135.2a5a690d.js"><link rel="prefetch" href="/note-pages/assets/js/136.6ba30378.js"><link rel="prefetch" href="/note-pages/assets/js/137.80d7c511.js"><link rel="prefetch" href="/note-pages/assets/js/138.0a25898e.js"><link rel="prefetch" href="/note-pages/assets/js/139.fb3c377f.js"><link rel="prefetch" href="/note-pages/assets/js/14.a561f8b3.js"><link rel="prefetch" href="/note-pages/assets/js/140.cbfdbe32.js"><link rel="prefetch" href="/note-pages/assets/js/141.c09f054f.js"><link rel="prefetch" href="/note-pages/assets/js/142.723bd973.js"><link rel="prefetch" href="/note-pages/assets/js/143.b31785f9.js"><link rel="prefetch" href="/note-pages/assets/js/144.69d3d121.js"><link rel="prefetch" href="/note-pages/assets/js/145.c4ee6aa0.js"><link rel="prefetch" href="/note-pages/assets/js/146.7f836a1c.js"><link rel="prefetch" href="/note-pages/assets/js/147.d4a57976.js"><link rel="prefetch" href="/note-pages/assets/js/148.b15e75eb.js"><link rel="prefetch" href="/note-pages/assets/js/149.94085ddc.js"><link rel="prefetch" href="/note-pages/assets/js/15.4ed118f1.js"><link rel="prefetch" href="/note-pages/assets/js/150.6751d41b.js"><link rel="prefetch" href="/note-pages/assets/js/151.bd60e322.js"><link rel="prefetch" href="/note-pages/assets/js/152.15caf78f.js"><link rel="prefetch" href="/note-pages/assets/js/153.131128fc.js"><link rel="prefetch" href="/note-pages/assets/js/154.b8ee2e7d.js"><link rel="prefetch" href="/note-pages/assets/js/155.8fa1e2e0.js"><link rel="prefetch" href="/note-pages/assets/js/156.25e2a796.js"><link rel="prefetch" href="/note-pages/assets/js/157.7137c9c3.js"><link rel="prefetch" href="/note-pages/assets/js/158.fdc18c40.js"><link rel="prefetch" href="/note-pages/assets/js/159.0dadb745.js"><link rel="prefetch" href="/note-pages/assets/js/16.818fc8bf.js"><link rel="prefetch" href="/note-pages/assets/js/160.05f7541c.js"><link rel="prefetch" href="/note-pages/assets/js/161.2a8c62a2.js"><link rel="prefetch" href="/note-pages/assets/js/162.5b9983b7.js"><link rel="prefetch" href="/note-pages/assets/js/163.b51a5538.js"><link rel="prefetch" href="/note-pages/assets/js/164.06c9f20a.js"><link rel="prefetch" href="/note-pages/assets/js/165.c25063f4.js"><link rel="prefetch" href="/note-pages/assets/js/166.6c570da5.js"><link rel="prefetch" href="/note-pages/assets/js/167.12fb6fb6.js"><link rel="prefetch" href="/note-pages/assets/js/168.d7dd27bc.js"><link rel="prefetch" href="/note-pages/assets/js/169.27f575fe.js"><link rel="prefetch" href="/note-pages/assets/js/17.9daf0c47.js"><link rel="prefetch" href="/note-pages/assets/js/170.ba4295ef.js"><link rel="prefetch" href="/note-pages/assets/js/171.3fb54078.js"><link rel="prefetch" href="/note-pages/assets/js/18.086ed162.js"><link rel="prefetch" href="/note-pages/assets/js/19.adca670c.js"><link rel="prefetch" href="/note-pages/assets/js/20.2e9ff004.js"><link rel="prefetch" href="/note-pages/assets/js/21.07830947.js"><link rel="prefetch" href="/note-pages/assets/js/22.609929cb.js"><link rel="prefetch" href="/note-pages/assets/js/23.d83b832f.js"><link rel="prefetch" href="/note-pages/assets/js/25.9d28bb6f.js"><link rel="prefetch" href="/note-pages/assets/js/26.fd4195d5.js"><link rel="prefetch" href="/note-pages/assets/js/27.ca60e875.js"><link rel="prefetch" href="/note-pages/assets/js/28.c2cd75e6.js"><link rel="prefetch" href="/note-pages/assets/js/29.4213d132.js"><link rel="prefetch" href="/note-pages/assets/js/30.c6ee0ead.js"><link rel="prefetch" href="/note-pages/assets/js/31.eea6a542.js"><link rel="prefetch" href="/note-pages/assets/js/32.1ffdceaf.js"><link rel="prefetch" href="/note-pages/assets/js/33.0425748b.js"><link rel="prefetch" href="/note-pages/assets/js/34.5dd0d81d.js"><link rel="prefetch" href="/note-pages/assets/js/35.773df14e.js"><link rel="prefetch" href="/note-pages/assets/js/36.5db32ea2.js"><link rel="prefetch" href="/note-pages/assets/js/37.1106162c.js"><link rel="prefetch" href="/note-pages/assets/js/38.793ba7d0.js"><link rel="prefetch" href="/note-pages/assets/js/39.488fb9a5.js"><link rel="prefetch" href="/note-pages/assets/js/4.550e6883.js"><link rel="prefetch" href="/note-pages/assets/js/40.9c05b0ae.js"><link rel="prefetch" href="/note-pages/assets/js/41.ae198526.js"><link rel="prefetch" href="/note-pages/assets/js/42.d815456e.js"><link rel="prefetch" href="/note-pages/assets/js/43.1808aff8.js"><link rel="prefetch" href="/note-pages/assets/js/44.c26d9bde.js"><link rel="prefetch" href="/note-pages/assets/js/45.fae5f755.js"><link rel="prefetch" href="/note-pages/assets/js/46.703057c9.js"><link rel="prefetch" href="/note-pages/assets/js/47.ed3a23ce.js"><link rel="prefetch" href="/note-pages/assets/js/48.c5a46ee8.js"><link rel="prefetch" href="/note-pages/assets/js/49.b04c1681.js"><link rel="prefetch" href="/note-pages/assets/js/5.869d288f.js"><link rel="prefetch" href="/note-pages/assets/js/50.249fc2a7.js"><link rel="prefetch" href="/note-pages/assets/js/51.cab74632.js"><link rel="prefetch" href="/note-pages/assets/js/52.e2f231b3.js"><link rel="prefetch" href="/note-pages/assets/js/53.6241e308.js"><link rel="prefetch" href="/note-pages/assets/js/54.7d29c5c0.js"><link rel="prefetch" href="/note-pages/assets/js/55.a9050f95.js"><link rel="prefetch" href="/note-pages/assets/js/56.75828a09.js"><link rel="prefetch" href="/note-pages/assets/js/57.b3f75d67.js"><link rel="prefetch" href="/note-pages/assets/js/58.0cf3bd1c.js"><link rel="prefetch" href="/note-pages/assets/js/59.19f18f1f.js"><link rel="prefetch" href="/note-pages/assets/js/6.d879438f.js"><link rel="prefetch" href="/note-pages/assets/js/60.61940d92.js"><link rel="prefetch" href="/note-pages/assets/js/61.bc890bb0.js"><link rel="prefetch" href="/note-pages/assets/js/62.f487437c.js"><link rel="prefetch" href="/note-pages/assets/js/63.4a91369b.js"><link rel="prefetch" href="/note-pages/assets/js/64.1b0770e4.js"><link rel="prefetch" href="/note-pages/assets/js/65.b56e2b22.js"><link rel="prefetch" href="/note-pages/assets/js/66.dd49594c.js"><link rel="prefetch" href="/note-pages/assets/js/67.22efede4.js"><link rel="prefetch" href="/note-pages/assets/js/68.0d22a8a4.js"><link rel="prefetch" href="/note-pages/assets/js/69.aec9bfeb.js"><link rel="prefetch" href="/note-pages/assets/js/7.e3626849.js"><link rel="prefetch" href="/note-pages/assets/js/70.0c53c20d.js"><link rel="prefetch" href="/note-pages/assets/js/71.6d6db7d6.js"><link rel="prefetch" href="/note-pages/assets/js/72.fdcfb985.js"><link rel="prefetch" href="/note-pages/assets/js/73.a390b48d.js"><link rel="prefetch" href="/note-pages/assets/js/74.e817987f.js"><link rel="prefetch" href="/note-pages/assets/js/75.f144cf4f.js"><link rel="prefetch" href="/note-pages/assets/js/76.7be2f5f1.js"><link rel="prefetch" href="/note-pages/assets/js/77.6568d596.js"><link rel="prefetch" href="/note-pages/assets/js/78.4ff63ca8.js"><link rel="prefetch" href="/note-pages/assets/js/79.daaf791e.js"><link rel="prefetch" href="/note-pages/assets/js/8.f9f716a1.js"><link rel="prefetch" href="/note-pages/assets/js/80.a0605696.js"><link rel="prefetch" href="/note-pages/assets/js/81.ecb125f5.js"><link rel="prefetch" href="/note-pages/assets/js/82.b64b1c42.js"><link rel="prefetch" href="/note-pages/assets/js/83.d13b7f19.js"><link rel="prefetch" href="/note-pages/assets/js/84.c584da75.js"><link rel="prefetch" href="/note-pages/assets/js/85.7992353f.js"><link rel="prefetch" href="/note-pages/assets/js/86.17ad6399.js"><link rel="prefetch" href="/note-pages/assets/js/87.289f9f2f.js"><link rel="prefetch" href="/note-pages/assets/js/88.3496d6e2.js"><link rel="prefetch" href="/note-pages/assets/js/89.0d0c778d.js"><link rel="prefetch" href="/note-pages/assets/js/9.3209071f.js"><link rel="prefetch" href="/note-pages/assets/js/90.245b9fda.js"><link rel="prefetch" href="/note-pages/assets/js/91.806af5f2.js"><link rel="prefetch" href="/note-pages/assets/js/92.8a10f401.js"><link rel="prefetch" href="/note-pages/assets/js/93.ea90ae18.js"><link rel="prefetch" href="/note-pages/assets/js/94.98cc66ef.js"><link rel="prefetch" href="/note-pages/assets/js/95.836e96c5.js"><link rel="prefetch" href="/note-pages/assets/js/96.d4dd3eee.js"><link rel="prefetch" href="/note-pages/assets/js/97.e4275cb9.js"><link rel="prefetch" href="/note-pages/assets/js/98.0e320d92.js"><link rel="prefetch" href="/note-pages/assets/js/99.e6f77650.js">
    <link rel="stylesheet" href="/note-pages/assets/css/0.styles.167a34c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-pages/" class="home-link router-link-active"><!----> <span class="site-name">后端技术栈笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link router-link-active">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-pages/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/algorithm/5e022a/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          计算机网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/network/a918ca/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/note-pages/http/" class="nav-link">
  HTTP
</a></li><li class="dropdown-subitem"><a href="/note-pages/tcp-ip/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/note-pages/socket/" class="nav-link">
  Socket
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/operating-system/knuk3x/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/linux/" class="nav-link">
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/database-system/fyl5c1/" class="nav-link">
  数据库系统
</a></li><li class="dropdown-subitem"><a href="/note-pages/computer-systems/" class="nav-link">
  计算机系统
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程语言" class="mobile-dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/java/5ddf72/" class="nav-link">
  Java基础
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-collection/" class="nav-link router-link-active">
  Java集合
</a></li><li class="dropdown-subitem"><a href="/note-pages/java-concurrency/" class="nav-link">
  Java并发
</a></li><li class="dropdown-subitem"><a href="/note-pages/jvm/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          C/C++
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/cpp/" class="nav-link">
  C++基础
</a></li></ul></li><li class="dropdown-item"><h4>
          Go
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/go/" class="nav-link">
  Go基础
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/assembly/" class="nav-link">
  Assembly
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发框架" class="dropdown-title"><span class="title">开发框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发框架" class="mobile-dropdown-title"><span class="title">开发框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/spring/" class="nav-link">
  Spring
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/mysql/1dh29a/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/note-pages/redis/" class="nav-link">
  Redis
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构设计" class="dropdown-title"><span class="title">架构设计</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构设计" class="mobile-dropdown-title"><span class="title">架构设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/distributed-system/01-理论基础/" class="nav-link">
  分布式系统
</a></li></ul></li><li class="dropdown-item"><h4>
          微服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/micro-service-in-action/" class="nav-link">
  微服务实战
</a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/kafka/" class="nav-link">
  Kafka
</a></li><li class="dropdown-subitem"><a href="/note-pages/rocket-mq/" class="nav-link">
  RocketMQ
</a></li></ul></li><li class="dropdown-item"><h4>
          注册中心
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-pages/zookeeper/" class="nav-link">
  ZooKeeper
</a></li><li class="dropdown-subitem"><a href="/note-pages/eureka/" class="nav-link">
  Eureka
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发工具" class="mobile-dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/docker/34kd5q/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="理论方法" class="dropdown-title"><span class="title">理论方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="理论方法" class="mobile-dropdown-title"><span class="title">理论方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-pages/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/note-pages/software-engineering/n4r1lx/" class="nav-link">
  软件工程
</a></li></ul></div></div><div class="nav-item"><a href="/note-pages/interview/f05h67/" class="nav-link">
  面试通关
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note-pages/java-collection/d6hlx9/" class="sidebar-link">第1章 集合框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/java-collection/d6hlx9/#_1-1-collection" class="sidebar-link">1.1 Collection</a></li><li class="sidebar-sub-header"><a href="/note-pages/java-collection/d6hlx9/#_1-2-map" class="sidebar-link">1.2 Map</a></li></ul></li><li><a href="/note-pages/java-collection/02-Collection.html" class="sidebar-link">第2章 Collection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/java-collection/02-Collection.html#_2-1-arraylist" class="sidebar-link">2.1 ArrayList</a></li><li class="sidebar-sub-header"><a href="/note-pages/java-collection/02-Collection.html#_2-2-linkedlist" class="sidebar-link">2.2 LinkedList</a></li></ul></li><li><a href="/note-pages/java-collection/nj28vk/" aria-current="page" class="active sidebar-link">第3章 Map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-pages/java-collection/nj28vk/#_3-1-hashmap-jdk-1-7" class="sidebar-link">3.1 HashMap（JDK 1.7）</a></li><li class="sidebar-sub-header"><a href="/note-pages/java-collection/nj28vk/#_3-2-hashmap-jdk-1-8" class="sidebar-link">3.2 HashMap（JDK 1.8）</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第3章-map"><a href="#第3章-map" class="header-anchor">#</a> 第3章 Map</h1> <h2 id="_3-1-hashmap-jdk-1-7"><a href="#_3-1-hashmap-jdk-1-7" class="header-anchor">#</a> 3.1 HashMap（JDK 1.7）</h2> <p>HashMap 采用 <strong>链地址法</strong> 处理哈希冲突。</p> <p><img src="/note-pages/assets/img/image-20230217231223541.c1499751.png" alt="image-20230217231223541"></p> <h3 id="put-方法"><a href="#put-方法" class="header-anchor">#</a> put 方法</h3> <p><code>put(K key，V value)</code> 方法是将指定的 <code>key, value</code> 对添加到 map 里。</p> <p>该方法首先会对 map 做一次查找，看是否包含该元组，如果已经包含则直接返回，查找过程类似于 getEntry() 方法；如果没有找到，则会通过 <code>addEntry(int hash，K key，V value，int bucketIndex)</code> 方法插入新的 entry，插入方式为 <strong>头插法</strong>。</p> <p><img src="/note-pages/assets/img/image-20230217232549574.ea80c3bc.png" alt="image-20230217232549574"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 自动扩容，并重新哈希</span>
        hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> key<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        bucketIndex <span class="token operator">=</span> hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>table<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hash % table.length</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 在冲突链表头部插入新的 entry</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="多线程下链表成环"><a href="#多线程下链表成环" class="header-anchor">#</a> 多线程下链表成环</h3> <p><strong>成环的时机</strong>：多线程环境下、扩容时。</p> <p>当多个线程同时对这个 HashMap 进行 put 操作，而察觉到内存容量不够，需要进行扩容时，多个线程会同时执行 resize 操作，而这就出现问题了。</p> <p>在 HashMap 扩容时，会改变链表中的元素的顺序，将元素从链表头部插入。</p> <p>重点就在 transfer() 中：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Transfers all entries from current table to newTable.
 */</span>
<span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> rehash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">:</span> table<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历原表中的每一个元素</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 当该元素不为空时，遍历每个元素下方链表中的每一个元素</span>
            <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rehash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token operator">==</span> e<span class="token punctuation">.</span>key <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
            e <span class="token operator">=</span> next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>经过这几步，我们会发现转移的时候是逆序的。</p> <p>假设原来 oldTable 里存放 a、b 的 hash 值是一样的，那么 entry 链表顺序是：</p> <div style="text-align:center;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqwAAABUCAYAAABHnGVtAAAAAXNSR0IArs4c6QAABa50RVh0bXhmaWxlACUzQ214ZmlsZSUyMGhvc3QlM0QlMjJFbGVjdHJvbiUyMiUyMG1vZGlmaWVkJTNEJTIyMjAyMy0wMy0zMFQxNSUzQTI4JTNBNTAuOTkwWiUyMiUyMGFnZW50JTNEJTIyNS4wJTIwKFdpbmRvd3MlMjBOVCUyMDEwLjAlM0IlMjBXaW42NCUzQiUyMHg2NCklMjBBcHBsZVdlYktpdCUyRjUzNy4zNiUyMChLSFRNTCUyQyUyMGxpa2UlMjBHZWNrbyklMjBkcmF3LmlvJTJGMjAuOC4xNiUyMENocm9tZSUyRjEwNi4wLjUyNDkuMTk5JTIwRWxlY3Ryb24lMkYyMS40LjAlMjBTYWZhcmklMkY1MzcuMzYlMjIlMjBldGFnJTNEJTIyRUJ6ME9DaDM0aW40WGlTdmJSTEolMjIlMjBzY2FsZSUzRCUyMjIlMjIlMjBib3JkZXIlM0QlMjIwJTIyJTIwdmVyc2lvbiUzRCUyMjIwLjguMTYlMjIlMjB0eXBlJTNEJTIyZGV2aWNlJTIyJTNFJTNDZGlhZ3JhbSUyMG5hbWUlM0QlMjIlRTclQUMlQUMlMjAxJTIwJUU5JUExJUI1JTIyJTIwaWQlM0QlMjJMVi1jaGM3Mk1PWjFJZ09vdUY5MSUyMiUzRTNWaE5jNXN3RVAwMUhKUGhRMkJ6VEd6SFByU1R6cmpUdEVmRktLQVdFQkhDeHY3MVhaQkFFQ2VPTSUyRkhYeEFkYiUyQjNZbExmdDJueE1iemlncHB4eG4wWGNXa05pd3phQTBuTEZoMjhoMzRMMEMxaEt3ZlZzQ0lhZUJoQ3dOek9tR0tOQlVhRUVEa3ZjQ0JXT3hvRmtmWExBMEpRdlJ3ekRuYk5VUGUySnglMkY5WU1oMlFMbUM5d3ZJMCUyQjBFQkVFaDNhQTQzUENBMmo1bWJMODZVbndVMndlcEk4d2dGYmRTQm5ZamdqenBpUXE2UWNrYmlxWFZNWHVlJTJGdURXJTJCYkdDZXAyR2ZEZElZMmVUbHg3emIlMkIlMkZlelhtRDRNdmVHVlltZUo0MEk5c0VwV3JKc0trQUFLb2t6R1JjUkNsdUo0b3RGYnpvbzBJTlUxSmxnNjVodGpHWUFXZ0glMkJKRUd2RkxpNEVBeWdTU2F5OFR5d1Z5bWtoc09HSiUyQlBxM09xODIlMkZsVEd0ZHVZNDdMckhLJTJCVnRTUmNVT0R1SnFaaENsaENnNkRPTUJlYyUyRldzSnRPcUR0dXVuU3BxemdpJTJGSWpxSTFmWWg1U01TT09DVGpxZ0oyTGxEc1RBbExDQ1FQQVp6RVdOQmx2JTJCT3dhdHl3ald1MyUyRm1BVVVyWk5OV1BPd0pWYm1oSHp6UDRSTWxHMVMzY0lMRHBwYUtqdW13JTJGMGtQVktEM214VUx6Mm1zbDdMbGpqdU1wcnhtOGd3RUpaV1RQUyUyQkdFVlZwOHdyVCUyRnhJMngyYjZuaGpwdHpJVTE1dEl6YWFsbmRrRlYzclNJcXlEekROYWNyVUtsJTJCOHgybWFhcFRTTG1UWnVXMUhiTlBGMUwyU3V1THI2Q29JeTNJZkxzeGVwUiUyQmxEJTJGdkVrYiUyQlJLT0w5aHhkOTlDaiUyQnltRyUyRkhNd1JFb3FXZzJHZFVlQ3dkSUtYQm1OQUw5azlTamtIVjFQdlJjRDZwblhscWRmQTNSU2VVWEhrMWY4SlFSMWk2OVhCQlZaSnhUVTRUbkgxZnJFdUo1SWhOMDlSWGh3VVNMc0htOE9INyUyRkVIQ0owWVhNNE9CNWphVkZkZjI3U0FweEg3Y0VIWU5DMTMyZlFQY3lmcG1EcWYzM2xWNlglMkIlMkZjQ1olMkZBYyUzRCUzQyUyRmRpYWdyYW0lM0UlM0MlMkZteGZpbGUlM0V+jIQHAAAci0lEQVR4Xu2dd5AU1RbGz4iimLOuWj72D9/qq6dUqaxZFvVp+QTMYg7ImjGXmHZJJsyKTxQQMyrmAn2FaO1SZQQtXS0DzwCWAUMZMQGu8+prtoc7vd3T4dyZ7p35uspSd+49t/t3vz7zze3b9+ak9HGkiBwvIvuHlOPHJFBJAv8VkftE5OFKNsq2hPmgWATUYWVvCuqP+qus4qK1lo9QLBehDOOEQAqC+C8RuUJEGiNAZhESSIvAXBG5XERmp3UCNdIu80HpjqYOy3sjUH/UX3kVVjp6k4gMEJEx+Xz+7yJymIjgb/8UkY1zuVyvsJPL58O9aC4X7mmrNY6IDBSR9jCOfoRaRGSst2L//v2lX79+UldXJ716hfZPWLv8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" alt="image-20230330211005576.drawio" style="zoom:67%;"></div><p>线程 P1 运行到 <code>for (Entry&lt;K,V&gt; e : table)</code> 时，<code>e = a</code>（<code>a.next = b</code>），继续运行到 <code>Entry&lt;K,V&gt; next = e.next;</code> 时，<code>next = b</code>。这个时候切换到线程 P2，线程 P2 执行完这个链表的循环。如果恰 a、b 在新的 table 中的 hash 值又是一样的，那么此时的链表顺序是：</p> <div style="text-align:center;"><img src="/note-pages/assets/img/image-20230330230126979.drawio.aacbd304.png" alt="image-20230330230126979.drawio" style="zoom:67%;"></div><p>注意这个时候，a、b 连接顺序已经反了。</p> <p>此时 CPU 重新切回 P1，执行 <code>e.next = newTable[i];</code> 以后，即</p> <div class="language-java extra-class"><pre class="language-java"><code>a<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// 即 a.next = b</span>
newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
e <span class="token operator">=</span> b<span class="token punctuation">;</span>
</code></pre></div><div style="text-align:center;"><img src="/note-pages/assets/img/image-20230330231919018.drawio.da33a4b4.png" alt="image-20230330231919018.drawio" style="zoom:67%;"></div><p>此时，<code>a.next = b</code> 且 <code>b.next = a</code>，形成回环。</p> <h3 id="get-方法"><a href="#get-方法" class="header-anchor">#</a> get 方法</h3> <p>get(Object key) 方法根据指定的 key 值返回对应的 value，该方法调用了 getEntry(Object key) 得到相应的 entry，然后返回 entry.getValue()。</p> <p>因此 getEntry() 是算法的核心：首先通过 hash() 函数得到对应 bucket 的下标，然后依次遍历冲突链表，通过 key.equals(k) 方法来判断是否是要找的那个 entry。</p> <p><img src="/note-pages/assets/img/image-20230217231602189.750a504c.png" alt="image-20230217231602189"></p> <p><code>hash(k) &amp; (table.length-1)</code> 等价于 <code>hash(k) % table.length</code>。因为 HashMap 要求 table.length 必须是 2 的指数，<code>table.length - 1</code> 的二进制低位全是 1，与 hash(k) 相 &amp; 会将哈希值的高位全抹掉，剩下的就是余数了。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>table<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 得到冲突链表</span>
         e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 依次遍历冲突链表中的每个 entry</span>
        <span class="token class-name">Object</span> k<span class="token punctuation">;</span>
        <span class="token comment">// 依据 equals() 方法判断是否相等</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-2-hashmap-jdk-1-8"><a href="#_3-2-hashmap-jdk-1-8" class="header-anchor">#</a> 3.2 HashMap（JDK 1.8）</h2> <p>Java 8 对 HashMap 进行了一些修改，最大的不同就是利用了红黑树，其由 <strong>数组+链表+红黑树</strong> 组成。</p> <p>根据 Java 7 HashMap 的介绍，我们知道，查找的时候，根据 hash 值能够快速定位到数组的具体下标，但是之后的话，需要顺着链表一个个比较下去才能找到我们需要的，时间复杂度取决于链表的长度。</p> <p>为了降低这部分的开销，在 Java 8 中，当链表中的元素达到了 8 个时，会将链表转换为红黑树，在这些位置进行查找的时候可以降低时间复杂度为 <span class="vuepress-eq"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log N)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span>。</p> <p><img src="/note-pages/assets/img/image-20230217233019515.afec38b5.png" alt="image-20230217233019515"></p> <p>Java 7 中使用 Entry 来代表每个 HashMap 中的数据节点，Java 8 中使用 Node，基本没有区别，都是 key、value、hash 和 next 这四个属性，不过，当链表升级为红黑树时使用 TreeNode。</p> <p>根据数组元素中，第一个节点数据类型是 Node 还是 TreeNode 来判断该位置下是链表还是红黑树。</p> <h3 id="put-方法-2"><a href="#put-方法-2" class="header-anchor">#</a> put 方法</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 第四个参数 onlyIfAbsent 如果是 true，那么只有在不存在该 key 时才会进行 put 操作，</span>
<span class="token comment">// 第五个参数 evict 我们这里不关心</span>
<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token comment">// 第一次 put 值的时候，会触发下面的 resize()，类似 java7 的第一次 put 也要初始化数组长度</span>
    <span class="token comment">// 第一次 resize 和后续的扩容有些不一样，因为这次是数组从 null 初始化到默认的 16 或自定义的初始容量</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// 找到具体的数组下标，如果此位置没有值，那么直接初始化一下 Node 并放置在这个位置就可以了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 数组该位置有数据</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
        <span class="token comment">// 首先，判断该位置的第一个数据和我们要插入的数据，key 是不是&quot;相等&quot;，如果是，取出这个节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token comment">// 如果该节点是代表红黑树的节点，调用红黑树的插值方法，本文不展开说红黑树</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 到这里，说明数组该位置上是一个链表</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 插入到链表的最后面（Java 8 是尾插法，Java 7 是头插法）</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// TREEIFY_THRESHOLD 为 8，所以，如果新插入的值是链表中的第 8 个</span>
                    <span class="token comment">// 会触发下面的 treeifyBin，也就是将链表转换为红黑树</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">&gt;=</span> TREEIFY_THRESHOLD <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 如果在该链表中找到了“相等”的 key（== 或 equals）</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment">// 此时 break，那么 e 为链表中 [与要插入的新值的 key “相等”] 的 node</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// e! = null 说明存在旧值的 key 与要插入的 key “相等”</span>
        <span class="token comment">// 对于我们分析的 put 操作，下面这个 if 其实就是进行 “值覆盖”，然后返回旧值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token comment">// 如果 HashMap 由于新插入这个值导致 size 已经超过了阈值，需要进行扩容</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">&gt;</span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="扩容机制-resize-方法"><a href="#扩容机制-resize-方法" class="header-anchor">#</a> 扩容机制（resize 方法）</h3> <p>resize() 方法用于初始化数组或数组扩容，每次扩容后，容量为原来的 2 倍，并进行数据迁移。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 对应数组扩容</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&gt;=</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 将数组大小扩大一倍</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span>
                 oldCap <span class="token operator">&gt;=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span>
            <span class="token comment">// 将阈值扩大一倍</span>
            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// double threshold</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 对应使用 new HashMap(int initialCapacity) 初始化后，第一次 put 时</span>
        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 对应使用 new HashMap() 初始化后，第一次 put 的时候</span>
        newCap <span class="token operator">=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DEFAULT_LOAD_FACTOR <span class="token operator">*</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>MAXIMUM_CAPACITY <span class="token operator">?</span>
                  <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span>

    <span class="token comment">// 用新的数组大小初始化新的数组</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span> <span class="token comment">// 如果是初始化数组，到这里就结束了，返回 newTab 即可</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开始遍历原数组，进行数据迁移。</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token comment">// 如果该数组位置上只有单个元素，那就简单了，简单迁移这个元素就可以了</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token comment">// 如果是红黑树，具体我们就不展开了</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span> 
                    <span class="token comment">// 这块是处理链表的情况，</span>
                    <span class="token comment">// 需要将此链表拆成两个链表，放到新的数组中，并且保留原来的先后顺序</span>
                    <span class="token comment">// loHead、loTail 对应一条链表，hiHead、hiTail 对应另一条链表</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next<span class="token punctuation">;</span>
                    <span class="token keyword">do</span> <span class="token punctuation">{</span>
                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                        <span class="token comment">// 判断元素是否需要移动到 原始位置 + 原容量/新增容量 的位置</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 停留在原始位置</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 移动到 原始位置 + 原容量/新增容量 的位置</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token comment">// 第一条链表 停留在原始位置</span>
                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token comment">// 第二条链表 移动到 原始位置 + 原容量/新增容量 的位置</span>
                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/note-pages/assets/img/image-20230826191742899.drawio.2a5f40e5.png" alt="image-20230826191742899.drawio"></p> <h3 id="get-方法-2"><a href="#get-方法-2" class="header-anchor">#</a> get 方法</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> first<span class="token punctuation">,</span> e<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>first <span class="token operator">=</span> tab<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断第一个节点是不是就是需要的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token comment">// always check first node</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> first<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> first<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 判断是否是红黑树</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTreeNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 链表遍历</span>
            <span class="token keyword">do</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-pages/java-collection/02-Collection.html" class="prev">
        第2章 Collection
      </a></span> <!----></p></div> </main> <aside items="[object Object],[object Object],[object Object]" class="right-sidebar"><div style="margin-left:20px; margin-bottom: 10px; text-align: center; font-size:16px;font-weight:bold;">此页内容</div> <div class="right-sidebar-wrap"><ul class="right-sidebar-links"><li id="tab-item0" class="right-sidebar-item active"><a href="#_3-1-hashmap-jdk-1-7" class="right-sidebar-item-level2">
          3.1 HashMap（JDK 1.7）
        </a></li><li id="tab-item1" class="right-sidebar-item"><a href="#put-方法" class="right-sidebar-item-level3">
          put 方法
        </a></li><li id="tab-item2" class="right-sidebar-item"><a href="#多线程下链表成环" class="right-sidebar-item-level3">
          多线程下链表成环
        </a></li><li id="tab-item3" class="right-sidebar-item"><a href="#get-方法" class="right-sidebar-item-level3">
          get 方法
        </a></li><li id="tab-item4" class="right-sidebar-item"><a href="#_3-2-hashmap-jdk-1-8" class="right-sidebar-item-level2">
          3.2 HashMap（JDK 1.8）
        </a></li><li id="tab-item5" class="right-sidebar-item"><a href="#put-方法-2" class="right-sidebar-item-level3">
          put 方法
        </a></li><li id="tab-item6" class="right-sidebar-item"><a href="#扩容机制-resize-方法" class="right-sidebar-item-level3">
          扩容机制（resize 方法）
        </a></li><li id="tab-item7" class="right-sidebar-item"><a href="#get-方法-2" class="right-sidebar-item-level3">
          get 方法
        </a></li></ul></div></aside></div><div class="global-ui"></div></div>
    <script src="/note-pages/assets/js/app.05dcbd87.js" defer></script><script src="/note-pages/assets/js/3.4a2f67fd.js" defer></script><script src="/note-pages/assets/js/2.ab82720e.js" defer></script><script src="/note-pages/assets/js/24.592e8014.js" defer></script>
  </body>
</html>
